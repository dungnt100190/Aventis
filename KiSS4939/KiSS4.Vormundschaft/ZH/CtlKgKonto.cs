#region Header

//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:2.0.50727.832
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#endregion

using System;
using System.Data;
using System.Drawing;
using Kiss.Interfaces.UI;
using KiSS4.Common;
using KiSS4.DB;
using KiSS4.Gui;
using DevExpress.XtraEditors.Repository;

namespace KiSS4.Vormundschaft.ZH
{
    public class CtlKgKonto : KiSS4.Gui.KissUserControl
    {
        #region Fields

        private int baPersonID = 0;
        private KiSS4.Gui.KissButton btnCollapse;
        private KiSS4.Gui.KissButton btnDown;
        private KiSS4.Gui.KissButton btnExpand;
        private KiSS4.Gui.KissButton btnLeft;
        private KiSS4.Gui.KissButton btnRight;
        private KiSS4.Gui.KissButton btnUp;
        private KiSS4.Gui.KissButton btnVorsaldoausgleich;
        private DevExpress.XtraGrid.Columns.GridColumn colBis;
        private DevExpress.XtraTreeList.Columns.TreeListColumn colKlasse;
        private DevExpress.XtraTreeList.Columns.TreeListColumn colKonto;
        private DevExpress.XtraTreeList.Columns.TreeListColumn colKontoart;
        private DevExpress.XtraGrid.Columns.GridColumn colSaldoTotal;
        private DevExpress.XtraGrid.Columns.GridColumn colStatus;
        private DevExpress.XtraTreeList.Columns.TreeListColumn colUebertragVermoegen;
        private DevExpress.XtraGrid.Columns.GridColumn colVon;
        private DevExpress.XtraTreeList.Columns.TreeListColumn colVorsaldo;
        private System.ComponentModel.IContainer components;
        private KiSS4.Gui.KissTextEdit edtAdresse;
        private KiSS4.Gui.KissTextEdit edtBaPersonID;
        private KiSS4.Gui.KissLookUpEdit edtKlasse;
        private KiSS4.Gui.KissLookUpEdit edtKontoart;
        private KiSS4.Gui.KissTextEdit edtKontoName;
        private KiSS4.Gui.KissTextEdit edtKontoNr;
        private KiSS4.Gui.KissButtonEdit edtMandant;
        private KiSS4.Gui.KissTextEdit edtMT;
        private KiSS4.Gui.KissCalcEdit edtVorsaldo;
        private int faLeistungID = 0;
        private KiSS4.Gui.KissGrid grdPeriode;
        private DevExpress.XtraGrid.Views.Grid.GridView gridView2;
        private int gruppeKontoID = -1;
        private System.Windows.Forms.ImageList imageList1;
        private bool isRefreshingTree = false;
        private KiSS4.Gui.KissLabel kissLabel2;
        private KiSS4.Gui.KissLabel kissLabel3;
        private KiSS4.Gui.KissLabel label1;
        private KiSS4.Gui.KissLabel label10;
        private KiSS4.Gui.KissLabel label40;
        private KiSS4.Gui.KissLabel lblKlasse;
        private KiSS4.Gui.KissLabel lblKontoart;
        private KiSS4.Gui.KissLabel lblKontoName;
        private KiSS4.Gui.KissLabel lblKontoNr;
        private KiSS4.Gui.KissLabel lblStandardKontenplan;
        private KiSS4.Gui.KissLabel lblTitel;
        private System.Windows.Forms.Panel panel1;
        private System.Windows.Forms.PictureBox picTitel;
        private KiSS4.DB.SqlQuery qryKgKonto;
        private KiSS4.DB.SqlQuery qryPeriode;
        private int sortKey = -1;
        private KiSS4.Gui.KissTree treKgKonto;

        #endregion

        #region Constructors

        public CtlKgKonto()
        {
            this.InitializeComponent();
        }

        #endregion

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject1 = new DevExpress.Utils.SerializableAppearanceObject();
            System.ComponentModel.ComponentResourceManager resources = new System.ComponentModel.ComponentResourceManager(typeof(CtlKgKonto));
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject3 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject2 = new DevExpress.Utils.SerializableAppearanceObject();
            this.edtMandant = new KiSS4.Gui.KissButtonEdit();
            this.grdPeriode = new KiSS4.Gui.KissGrid();
            this.qryPeriode = new KiSS4.DB.SqlQuery(this.components);
            this.gridView2 = new DevExpress.XtraGrid.Views.Grid.GridView();
            this.colVon = new DevExpress.XtraGrid.Columns.GridColumn();
            this.colBis = new DevExpress.XtraGrid.Columns.GridColumn();
            this.colStatus = new DevExpress.XtraGrid.Columns.GridColumn();
            this.colSaldoTotal = new DevExpress.XtraGrid.Columns.GridColumn();
            this.treKgKonto = new KiSS4.Gui.KissTree();
            this.colKonto = new DevExpress.XtraTreeList.Columns.TreeListColumn();
            this.colVorsaldo = new DevExpress.XtraTreeList.Columns.TreeListColumn();
            this.colUebertragVermoegen = new DevExpress.XtraTreeList.Columns.TreeListColumn();
            this.colKlasse = new DevExpress.XtraTreeList.Columns.TreeListColumn();
            this.colKontoart = new DevExpress.XtraTreeList.Columns.TreeListColumn();
            this.qryKgKonto = new KiSS4.DB.SqlQuery(this.components);
            this.imageList1 = new System.Windows.Forms.ImageList(this.components);
            this.edtKontoNr = new KiSS4.Gui.KissTextEdit();
            this.edtKontoName = new KiSS4.Gui.KissTextEdit();
            this.edtVorsaldo = new KiSS4.Gui.KissCalcEdit();
            this.edtKlasse = new KiSS4.Gui.KissLookUpEdit();
            this.edtKontoart = new KiSS4.Gui.KissLookUpEdit();
            this.btnVorsaldoausgleich = new KiSS4.Gui.KissButton();
            this.label40 = new KiSS4.Gui.KissLabel();
            this.edtAdresse = new KiSS4.Gui.KissTextEdit();
            this.edtBaPersonID = new KiSS4.Gui.KissTextEdit();
            this.edtMT = new KiSS4.Gui.KissTextEdit();
            this.label10 = new KiSS4.Gui.KissLabel();
            this.label1 = new KiSS4.Gui.KissLabel();
            this.lblStandardKontenplan = new KiSS4.Gui.KissLabel();
            this.lblKontoNr = new KiSS4.Gui.KissLabel();
            this.kissLabel3 = new KiSS4.Gui.KissLabel();
            this.lblKontoart = new KiSS4.Gui.KissLabel();
            this.lblKlasse = new KiSS4.Gui.KissLabel();
            this.btnRight = new KiSS4.Gui.KissButton();
            this.btnLeft = new KiSS4.Gui.KissButton();
            this.btnUp = new KiSS4.Gui.KissButton();
            this.btnDown = new KiSS4.Gui.KissButton();
            this.btnExpand = new KiSS4.Gui.KissButton();
            this.btnCollapse = new KiSS4.Gui.KissButton();
            this.panel1 = new System.Windows.Forms.Panel();
            this.picTitel = new System.Windows.Forms.PictureBox();
            this.lblTitel = new KiSS4.Gui.KissLabel();
            this.lblKontoName = new KiSS4.Gui.KissLabel();
            this.kissLabel2 = new KiSS4.Gui.KissLabel();
            ((System.ComponentModel.ISupportInitialize)(this.edtMandant.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.grdPeriode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryPeriode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.gridView2)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.treKgKonto)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryKgKonto)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoNr.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoName.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtVorsaldo.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKlasse)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKlasse.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoart)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoart.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.label40)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtAdresse.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBaPersonID.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtMT.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.label10)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.label1)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblStandardKontenplan)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKontoNr)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.kissLabel3)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKontoart)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKlasse)).BeginInit();
            this.panel1.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picTitel)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblTitel)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKontoName)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.kissLabel2)).BeginInit();
            this.SuspendLayout();
            //
            // edtMandant
            //
            this.edtMandant.Location = new System.Drawing.Point(153, 30);
            this.edtMandant.Name = "edtMandant";
            this.edtMandant.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtMandant.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtMandant.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtMandant.Properties.Appearance.Options.UseBackColor = true;
            this.edtMandant.Properties.Appearance.Options.UseBorderColor = true;
            this.edtMandant.Properties.Appearance.Options.UseFont = true;
            this.edtMandant.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject1.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject1.Options.UseBackColor = true;
            this.edtMandant.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Ellipsis, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, null, new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject1)});
            this.edtMandant.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtMandant.Properties.Name = "editMandant.Properties";
            this.edtMandant.SearchStringWhitelist = new string[] {
        ".",
        "*",
        "%"};
            this.edtMandant.Size = new System.Drawing.Size(214, 24);
            this.edtMandant.TabIndex = 0;
            this.edtMandant.UserModifiedFld += new KiSS4.Gui.UserModifiedFldEventHandler(this.edtMandant_UserModifiedFld);
            //
            // grdPeriode
            //
            this.grdPeriode.Anchor = ((System.Windows.Forms.AnchorStyles)(((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Left)
            | System.Windows.Forms.AnchorStyles.Right)));
            this.grdPeriode.DataSource = this.qryPeriode;
            //
            //
            //
            this.grdPeriode.EmbeddedNavigator.Name = "gridPeriode.EmbeddedNavigator";
            this.grdPeriode.GridStyle = KiSS4.Gui.GridStyleType.ReadOnly;
            this.grdPeriode.Location = new System.Drawing.Point(438, 30);
            this.grdPeriode.MainView = this.gridView2;
            this.grdPeriode.Name = "grdPeriode";
            this.grdPeriode.Size = new System.Drawing.Size(342, 85);
            this.grdPeriode.TabIndex = 1;
            this.grdPeriode.ViewCollection.AddRange(new DevExpress.XtraGrid.Views.Base.BaseView[] {
            this.gridView2});
            this.grdPeriode.Visible = false;
            //
            // qryPeriode
            //
            this.qryPeriode.HostControl = this;
            this.qryPeriode.SelectStatement = resources.GetString("qryPeriode.SelectStatement");
            this.qryPeriode.PositionChanged += new System.EventHandler(this.qryPeriode_PositionChanged);
            this.qryPeriode.PositionChanging += new System.EventHandler(this.qryPeriode_PositionChanging);
            //
            // gridView2
            //
            this.gridView2.Appearance.Empty.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.gridView2.Appearance.Empty.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridView2.Appearance.Empty.Options.UseBackColor = true;
            this.gridView2.Appearance.Empty.Options.UseFont = true;
            this.gridView2.Appearance.EvenRow.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(236)))), ((int)(((byte)(227)))), ((int)(((byte)(215)))));
            this.gridView2.Appearance.EvenRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridView2.Appearance.EvenRow.Options.UseBackColor = true;
            this.gridView2.Appearance.EvenRow.Options.UseFont = true;
            this.gridView2.Appearance.FocusedCell.BackColor = System.Drawing.SystemColors.Highlight;
            this.gridView2.Appearance.FocusedCell.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridView2.Appearance.FocusedCell.ForeColor = System.Drawing.Color.White;
            this.gridView2.Appearance.FocusedCell.Options.UseBackColor = true;
            this.gridView2.Appearance.FocusedCell.Options.UseFont = true;
            this.gridView2.Appearance.FocusedCell.Options.UseForeColor = true;
            this.gridView2.Appearance.FocusedRow.BackColor = System.Drawing.SystemColors.Highlight;
            this.gridView2.Appearance.FocusedRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridView2.Appearance.FocusedRow.ForeColor = System.Drawing.Color.White;
            this.gridView2.Appearance.FocusedRow.Options.UseBackColor = true;
            this.gridView2.Appearance.FocusedRow.Options.UseFont = true;
            this.gridView2.Appearance.FocusedRow.Options.UseForeColor = true;
            this.gridView2.Appearance.GroupPanel.BackColor = System.Drawing.Color.PeachPuff;
            this.gridView2.Appearance.GroupPanel.Options.UseBackColor = true;
            this.gridView2.Appearance.GroupRow.BackColor = System.Drawing.Color.PeachPuff;
            this.gridView2.Appearance.GroupRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel, ((byte)(0)));
            this.gridView2.Appearance.GroupRow.ForeColor = System.Drawing.SystemColors.WindowText;
            this.gridView2.Appearance.GroupRow.Options.UseBackColor = true;
            this.gridView2.Appearance.GroupRow.Options.UseFont = true;
            this.gridView2.Appearance.GroupRow.Options.UseForeColor = true;
            this.gridView2.Appearance.HeaderPanel.BackColor = System.Drawing.Color.Tan;
            this.gridView2.Appearance.HeaderPanel.BorderColor = System.Drawing.Color.Tan;
            this.gridView2.Appearance.HeaderPanel.Font = new System.Drawing.Font("Arial", 11F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel, ((byte)(0)));
            this.gridView2.Appearance.HeaderPanel.Options.UseBackColor = true;
            this.gridView2.Appearance.HeaderPanel.Options.UseBorderColor = true;
            this.gridView2.Appearance.HeaderPanel.Options.UseFont = true;
            this.gridView2.Appearance.HideSelectionRow.BackColor = System.Drawing.Color.PowderBlue;
            this.gridView2.Appearance.HideSelectionRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridView2.Appearance.HideSelectionRow.ForeColor = System.Drawing.SystemColors.WindowText;
            this.gridView2.Appearance.HideSelectionRow.Options.UseBackColor = true;
            this.gridView2.Appearance.HideSelectionRow.Options.UseFont = true;
            this.gridView2.Appearance.HideSelectionRow.Options.UseForeColor = true;
            this.gridView2.Appearance.HorzLine.BackColor = System.Drawing.Color.Silver;
            this.gridView2.Appearance.HorzLine.Options.UseBackColor = true;
            this.gridView2.Appearance.OddRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridView2.Appearance.OddRow.Options.UseFont = true;
            this.gridView2.Appearance.Row.BackColor = System.Drawing.Color.BlanchedAlmond;
            this.gridView2.Appearance.Row.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridView2.Appearance.Row.Options.UseBackColor = true;
            this.gridView2.Appearance.Row.Options.UseFont = true;
            this.gridView2.Appearance.SelectedRow.BackColor = System.Drawing.Color.AliceBlue;
            this.gridView2.Appearance.SelectedRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridView2.Appearance.SelectedRow.ForeColor = System.Drawing.Color.Black;
            this.gridView2.Appearance.SelectedRow.Options.UseBackColor = true;
            this.gridView2.Appearance.SelectedRow.Options.UseFont = true;
            this.gridView2.Appearance.SelectedRow.Options.UseForeColor = true;
            this.gridView2.Appearance.VertLine.BackColor = System.Drawing.Color.Silver;
            this.gridView2.Appearance.VertLine.Options.UseBackColor = true;
            this.gridView2.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.gridView2.Columns.AddRange(new DevExpress.XtraGrid.Columns.GridColumn[] {
            this.colVon,
            this.colBis,
            this.colStatus,
            this.colSaldoTotal});
            this.gridView2.FocusRectStyle = DevExpress.XtraGrid.Views.Grid.DrawFocusRectStyle.None;
            this.gridView2.GridControl = this.grdPeriode;
            this.gridView2.GroupPanelText = "zu gruppierende Kolonnen in diesen Bereich ziehen";
            this.gridView2.Name = "gridView2";
            this.gridView2.OptionsBehavior.Editable = false;
            this.gridView2.OptionsCustomization.AllowFilter = false;
            this.gridView2.OptionsFilter.AllowFilterEditor = false;
            this.gridView2.OptionsFilter.UseNewCustomFilterDialog = true;
            this.gridView2.OptionsMenu.EnableColumnMenu = false;
            this.gridView2.OptionsNavigation.AutoFocusNewRow = true;
            this.gridView2.OptionsNavigation.UseTabKey = false;
            this.gridView2.OptionsView.ColumnAutoWidth = false;
            this.gridView2.OptionsView.ShowFilterPanelMode = DevExpress.XtraGrid.Views.Base.ShowFilterPanelMode.Never;
            this.gridView2.OptionsView.ShowGroupPanel = false;
            this.gridView2.OptionsView.ShowIndicator = false;
            //
            // colVon
            //
            this.colVon.Caption = "Periode Von";
            this.colVon.FieldName = "PeriodeVon";
            this.colVon.Name = "colVon";
            this.colVon.Visible = true;
            this.colVon.VisibleIndex = 0;
            this.colVon.Width = 80;
            //
            // colBis
            //
            this.colBis.Caption = "Periode Bis";
            this.colBis.FieldName = "PeriodeBis";
            this.colBis.Name = "colBis";
            this.colBis.Visible = true;
            this.colBis.VisibleIndex = 1;
            this.colBis.Width = 80;
            //
            // colStatus
            //
            this.colStatus.Caption = "Status";
            this.colStatus.FieldName = "Status";
            this.colStatus.Name = "colStatus";
            this.colStatus.Visible = true;
            this.colStatus.VisibleIndex = 2;
            this.colStatus.Width = 98;
            //
            // colSaldoTotal
            //
            this.colSaldoTotal.Caption = "Saldototal";
            this.colSaldoTotal.DisplayFormat.FormatString = "N2";
            this.colSaldoTotal.DisplayFormat.FormatType = DevExpress.Utils.FormatType.Numeric;
            this.colSaldoTotal.FieldName = "SaldoTotal";
            this.colSaldoTotal.Name = "colSaldoTotal";
            this.colSaldoTotal.Visible = true;
            this.colSaldoTotal.VisibleIndex = 3;
            this.colSaldoTotal.Width = 70;
            //
            // treKgKonto
            //
            this.treKgKonto.AllowSortTree = true;
            this.treKgKonto.Anchor = ((System.Windows.Forms.AnchorStyles)((((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Bottom)
            | System.Windows.Forms.AnchorStyles.Left)
            | System.Windows.Forms.AnchorStyles.Right)));
            this.treKgKonto.Appearance.Empty.BackColor = System.Drawing.Color.Transparent;
            this.treKgKonto.Appearance.Empty.ForeColor = System.Drawing.Color.White;
            this.treKgKonto.Appearance.Empty.Options.UseBackColor = true;
            this.treKgKonto.Appearance.Empty.Options.UseForeColor = true;
            this.treKgKonto.Appearance.EvenRow.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(242)))), ((int)(((byte)(236)))), ((int)(((byte)(215)))));
            this.treKgKonto.Appearance.EvenRow.ForeColor = System.Drawing.Color.Black;
            this.treKgKonto.Appearance.EvenRow.Options.UseBackColor = true;
            this.treKgKonto.Appearance.EvenRow.Options.UseForeColor = true;
            this.treKgKonto.Appearance.FocusedCell.BackColor = System.Drawing.Color.Transparent;
            this.treKgKonto.Appearance.FocusedCell.ForeColor = System.Drawing.Color.White;
            this.treKgKonto.Appearance.FocusedCell.Options.UseBackColor = true;
            this.treKgKonto.Appearance.FocusedCell.Options.UseForeColor = true;
            this.treKgKonto.Appearance.FocusedRow.ForeColor = System.Drawing.Color.White;
            this.treKgKonto.Appearance.FocusedRow.Options.UseForeColor = true;
            this.treKgKonto.Appearance.FooterPanel.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(230)))), ((int)(((byte)(216)))), ((int)(((byte)(174)))));
            this.treKgKonto.Appearance.FooterPanel.Font = new System.Drawing.Font("Microsoft Sans Serif", 11F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.treKgKonto.Appearance.FooterPanel.ForeColor = System.Drawing.Color.Black;
            this.treKgKonto.Appearance.FooterPanel.Options.UseBackColor = true;
            this.treKgKonto.Appearance.FooterPanel.Options.UseFont = true;
            this.treKgKonto.Appearance.FooterPanel.Options.UseForeColor = true;
            this.treKgKonto.Appearance.GroupButton.BackColor = System.Drawing.Color.Transparent;
            this.treKgKonto.Appearance.GroupButton.Font = new System.Drawing.Font("Microsoft Sans Serif", 9F, System.Drawing.FontStyle.Bold);
            this.treKgKonto.Appearance.GroupButton.ForeColor = System.Drawing.Color.Black;
            this.treKgKonto.Appearance.GroupButton.Options.UseBackColor = true;
            this.treKgKonto.Appearance.GroupButton.Options.UseFont = true;
            this.treKgKonto.Appearance.GroupButton.Options.UseForeColor = true;
            this.treKgKonto.Appearance.GroupFooter.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(240)))), ((int)(((byte)(226)))), ((int)(((byte)(184)))));
            this.treKgKonto.Appearance.GroupFooter.ForeColor = System.Drawing.Color.Black;
            this.treKgKonto.Appearance.GroupFooter.Options.UseBackColor = true;
            this.treKgKonto.Appearance.GroupFooter.Options.UseForeColor = true;
            this.treKgKonto.Appearance.HeaderPanel.BackColor = System.Drawing.Color.Tan;
            this.treKgKonto.Appearance.HeaderPanel.Font = new System.Drawing.Font("Microsoft Sans Serif", 8F, System.Drawing.FontStyle.Bold);
            this.treKgKonto.Appearance.HeaderPanel.ForeColor = System.Drawing.Color.Black;
            this.treKgKonto.Appearance.HeaderPanel.Options.UseBackColor = true;
            this.treKgKonto.Appearance.HeaderPanel.Options.UseFont = true;
            this.treKgKonto.Appearance.HeaderPanel.Options.UseForeColor = true;
            this.treKgKonto.Appearance.HideSelectionRow.BackColor = System.Drawing.Color.PowderBlue;
            this.treKgKonto.Appearance.HideSelectionRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.treKgKonto.Appearance.HideSelectionRow.ForeColor = System.Drawing.Color.Black;
            this.treKgKonto.Appearance.HideSelectionRow.Options.UseBackColor = true;
            this.treKgKonto.Appearance.HideSelectionRow.Options.UseFont = true;
            this.treKgKonto.Appearance.HideSelectionRow.Options.UseForeColor = true;
            this.treKgKonto.Appearance.HorzLine.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(230)))), ((int)(((byte)(216)))), ((int)(((byte)(174)))));
            this.treKgKonto.Appearance.HorzLine.ForeColor = System.Drawing.Color.Red;
            this.treKgKonto.Appearance.HorzLine.Options.UseBackColor = true;
            this.treKgKonto.Appearance.HorzLine.Options.UseForeColor = true;
            this.treKgKonto.Appearance.OddRow.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(236)))), ((int)(((byte)(227)))), ((int)(((byte)(215)))));
            this.treKgKonto.Appearance.OddRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.treKgKonto.Appearance.OddRow.ForeColor = System.Drawing.Color.Black;
            this.treKgKonto.Appearance.OddRow.Options.UseBackColor = true;
            this.treKgKonto.Appearance.OddRow.Options.UseFont = true;
            this.treKgKonto.Appearance.OddRow.Options.UseForeColor = true;
            this.treKgKonto.Appearance.Preview.BackColor = System.Drawing.Color.White;
            this.treKgKonto.Appearance.Preview.Font = new System.Drawing.Font("Microsoft Sans Serif", 11F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.treKgKonto.Appearance.Preview.ForeColor = System.Drawing.Color.Maroon;
            this.treKgKonto.Appearance.Preview.Options.UseBackColor = true;
            this.treKgKonto.Appearance.Preview.Options.UseFont = true;
            this.treKgKonto.Appearance.Preview.Options.UseForeColor = true;
            this.treKgKonto.Appearance.Row.BackColor = System.Drawing.Color.Transparent;
            this.treKgKonto.Appearance.Row.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.treKgKonto.Appearance.Row.ForeColor = System.Drawing.Color.Black;
            this.treKgKonto.Appearance.Row.Options.UseBackColor = true;
            this.treKgKonto.Appearance.Row.Options.UseFont = true;
            this.treKgKonto.Appearance.Row.Options.UseForeColor = true;
            this.treKgKonto.Appearance.SelectedRow.ForeColor = System.Drawing.Color.White;
            this.treKgKonto.Appearance.SelectedRow.Options.UseForeColor = true;
            this.treKgKonto.Appearance.TreeLine.BackColor = System.Drawing.Color.Gray;
            this.treKgKonto.Appearance.TreeLine.Options.UseBackColor = true;
            this.treKgKonto.Appearance.VertLine.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(230)))), ((int)(((byte)(216)))), ((int)(((byte)(174)))));
            this.treKgKonto.Appearance.VertLine.ForeColor = System.Drawing.Color.FromArgb(((int)(((byte)(198)))), ((int)(((byte)(166)))), ((int)(((byte)(70)))));
            this.treKgKonto.Appearance.VertLine.Options.UseBackColor = true;
            this.treKgKonto.Appearance.VertLine.Options.UseForeColor = true;
            this.treKgKonto.Appearance.VertLine.Options.UseTextOptions = true;
            this.treKgKonto.Appearance.VertLine.TextOptions.HAlignment = DevExpress.Utils.HorzAlignment.Near;
            this.treKgKonto.Columns.AddRange(new DevExpress.XtraTreeList.Columns.TreeListColumn[] {
            this.colKonto,
            this.colVorsaldo,
            this.colUebertragVermoegen,
            this.colKlasse,
            this.colKontoart});
            this.treKgKonto.DataSource = this.qryKgKonto;
            this.treKgKonto.ImageIndexFieldName = "IconIndex";
            this.treKgKonto.KeyFieldName = "KgKontoID";
            this.treKgKonto.Location = new System.Drawing.Point(5, 124);
            this.treKgKonto.Name = "treKgKonto";
            this.treKgKonto.OptionsBehavior.AutoSelectAllInEditor = false;
            this.treKgKonto.OptionsBehavior.CloseEditorOnLostFocus = false;
            this.treKgKonto.OptionsBehavior.Editable = false;
            this.treKgKonto.OptionsBehavior.KeepSelectedOnClick = false;
            this.treKgKonto.OptionsBehavior.MoveOnEdit = false;
            this.treKgKonto.OptionsMenu.EnableColumnMenu = false;
            this.treKgKonto.OptionsMenu.EnableFooterMenu = false;
            this.treKgKonto.OptionsSelection.EnableAppearanceFocusedCell = false;
            this.treKgKonto.OptionsView.AutoWidth = false;
            this.treKgKonto.OptionsView.EnableAppearanceEvenRow = true;
            this.treKgKonto.OptionsView.EnableAppearanceOddRow = true;
            this.treKgKonto.OptionsView.ShowIndicator = false;
            this.treKgKonto.ParentFieldName = "GruppeKontoID";
            this.treKgKonto.SelectImageList = this.imageList1;
            this.treKgKonto.Size = new System.Drawing.Size(745, 360);
            this.treKgKonto.TabIndex = 2;
            this.treKgKonto.FocusedNodeChanged += new DevExpress.XtraTreeList.FocusedNodeChangedEventHandler(this.treKgKonto_FocusedNodeChanged);
            //
            // colKonto
            //
            this.colKonto.Caption = "Konto";
            this.colKonto.FieldName = "Konto";
            this.colKonto.MinWidth = 27;
            this.colKonto.Name = "colKonto";
            this.colKonto.OptionsColumn.AllowSort = false;
            this.colKonto.SortOrder = System.Windows.Forms.SortOrder.Ascending;
            this.colKonto.VisibleIndex = 0;
            this.colKonto.Width = 302;
            //
            // colVorsaldo
            //
            this.colVorsaldo.AppearanceCell.Options.UseTextOptions = true;
            this.colVorsaldo.AppearanceCell.TextOptions.HAlignment = DevExpress.Utils.HorzAlignment.Far;
            this.colVorsaldo.Caption = "Vorsaldo";
            this.colVorsaldo.FieldName = "VorsaldoText";
            this.colVorsaldo.Name = "colVorsaldo";
            this.colVorsaldo.OptionsColumn.AllowSort = false;
            this.colVorsaldo.VisibleIndex = 1;
            this.colVorsaldo.Width = 94;
            //
            // colUebertragVermoegen
            //
            this.colUebertragVermoegen.AppearanceCell.Options.UseTextOptions = true;
            this.colUebertragVermoegen.AppearanceCell.TextOptions.HAlignment = DevExpress.Utils.HorzAlignment.Center;
            this.colUebertragVermoegen.Caption = "Üb.";
            this.colUebertragVermoegen.FieldName = "VorsaldoUebertrag";
            this.colUebertragVermoegen.Name = "colUebertragVermoegen";
            this.colUebertragVermoegen.OptionsColumn.AllowSort = false;
            this.colUebertragVermoegen.Width = 34;
            //
            // colKlasse
            //
            this.colKlasse.Caption = "Klasse";
            this.colKlasse.FieldName = "KgKontoklasseCode";
            this.colKlasse.Name = "colKlasse";
            this.colKlasse.OptionsColumn.AllowSort = false;
            this.colKlasse.VisibleIndex = 2;
            this.colKlasse.Width = 89;
            //
            // colKontoart
            //
            this.colKontoart.Caption = "Kontoart";
            this.colKontoart.FieldName = "KgKontoartCode";
            this.colKontoart.Name = "colKontoart";
            this.colKontoart.OptionsColumn.AllowSort = false;
            this.colKontoart.VisibleIndex = 3;
            this.colKontoart.Width = 142;
            //
            // qryKgKonto
            //
            this.qryKgKonto.CanDelete = true;
            this.qryKgKonto.CanInsert = true;
            this.qryKgKonto.CanUpdate = true;
            this.qryKgKonto.HostControl = this;
            this.qryKgKonto.SelectStatement = resources.GetString("qryKgKonto.SelectStatement");
            this.qryKgKonto.TableName = "KgKonto";
            this.qryKgKonto.AfterPost += new System.EventHandler(this.qryKgKonto_AfterPost);
            this.qryKgKonto.BeforePost += new System.EventHandler(this.qryKgKonto_BeforePost);
            this.qryKgKonto.PositionChanged += new System.EventHandler(this.qryKgKonto_PositionChanged);
            //
            // imageList1
            //
            this.imageList1.ImageStream = ((System.Windows.Forms.ImageListStreamer)(resources.GetObject("imageList1.ImageStream")));
            this.imageList1.TransparentColor = System.Drawing.Color.Transparent;
            this.imageList1.Images.SetKeyName(0, "");
            this.imageList1.Images.SetKeyName(1, "");
            //
            // edtKontoNr
            //
            this.edtKontoNr.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.edtKontoNr.DataMember = "KontoNr";
            this.edtKontoNr.DataSource = this.qryKgKonto;
            this.edtKontoNr.Location = new System.Drawing.Point(63, 490);
            this.edtKontoNr.Name = "edtKontoNr";
            this.edtKontoNr.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtKontoNr.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtKontoNr.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtKontoNr.Properties.Appearance.Options.UseBackColor = true;
            this.edtKontoNr.Properties.Appearance.Options.UseBorderColor = true;
            this.edtKontoNr.Properties.Appearance.Options.UseFont = true;
            this.edtKontoNr.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtKontoNr.Size = new System.Drawing.Size(84, 24);
            this.edtKontoNr.TabIndex = 3;
            //
            // edtKontoName
            //
            this.edtKontoName.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.edtKontoName.DataMember = "KontoName";
            this.edtKontoName.DataSource = this.qryKgKonto;
            this.edtKontoName.Location = new System.Drawing.Point(63, 520);
            this.edtKontoName.Name = "edtKontoName";
            this.edtKontoName.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtKontoName.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtKontoName.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtKontoName.Properties.Appearance.Options.UseBackColor = true;
            this.edtKontoName.Properties.Appearance.Options.UseBorderColor = true;
            this.edtKontoName.Properties.Appearance.Options.UseFont = true;
            this.edtKontoName.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtKontoName.Size = new System.Drawing.Size(437, 24);
            this.edtKontoName.TabIndex = 4;
            //
            // edtVorsaldo
            //
            this.edtVorsaldo.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.edtVorsaldo.DataMember = "Vorsaldo";
            this.edtVorsaldo.DataSource = this.qryKgKonto;
            this.edtVorsaldo.Location = new System.Drawing.Point(63, 550);
            this.edtVorsaldo.Name = "edtVorsaldo";
            this.edtVorsaldo.Properties.AllowNullInput = DevExpress.Utils.DefaultBoolean.True;
            this.edtVorsaldo.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtVorsaldo.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtVorsaldo.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtVorsaldo.Properties.Appearance.Options.UseBackColor = true;
            this.edtVorsaldo.Properties.Appearance.Options.UseBorderColor = true;
            this.edtVorsaldo.Properties.Appearance.Options.UseFont = true;
            this.edtVorsaldo.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtVorsaldo.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtVorsaldo.Properties.DisplayFormat.FormatString = "N2";
            this.edtVorsaldo.Properties.DisplayFormat.FormatType = DevExpress.Utils.FormatType.Numeric;
            this.edtVorsaldo.Properties.EditFormat.FormatString = "N2";
            this.edtVorsaldo.Properties.EditFormat.FormatType = DevExpress.Utils.FormatType.Numeric;
            this.edtVorsaldo.Size = new System.Drawing.Size(106, 24);
            this.edtVorsaldo.TabIndex = 5;
            //
            // edtKlasse
            //
            this.edtKlasse.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.edtKlasse.DataMember = "KgKontoklasseCode";
            this.edtKlasse.DataSource = this.qryKgKonto;
            this.edtKlasse.Location = new System.Drawing.Point(557, 490);
            this.edtKlasse.LOVName = "KgKontoklasse";
            this.edtKlasse.Name = "edtKlasse";
            this.edtKlasse.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtKlasse.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtKlasse.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtKlasse.Properties.Appearance.Options.UseBackColor = true;
            this.edtKlasse.Properties.Appearance.Options.UseBorderColor = true;
            this.edtKlasse.Properties.Appearance.Options.UseFont = true;
            this.edtKlasse.Properties.AppearanceDropDown.BackColor = System.Drawing.Color.BlanchedAlmond;
            this.edtKlasse.Properties.AppearanceDropDown.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.edtKlasse.Properties.AppearanceDropDown.Options.UseBackColor = true;
            this.edtKlasse.Properties.AppearanceDropDown.Options.UseFont = true;
            this.edtKlasse.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject3.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject3.Options.UseBackColor = true;
            this.edtKlasse.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, null, new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject3)});
            this.edtKlasse.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtKlasse.Properties.NullText = "";
            this.edtKlasse.Properties.ShowFooter = false;
            this.edtKlasse.Properties.ShowHeader = false;
            this.edtKlasse.Size = new System.Drawing.Size(156, 24);
            this.edtKlasse.TabIndex = 7;
            //
            // edtKontoart
            //
            this.edtKontoart.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.edtKontoart.DataMember = "KgKontoartCode";
            this.edtKontoart.DataSource = this.qryKgKonto;
            this.edtKontoart.Location = new System.Drawing.Point(557, 520);
            this.edtKontoart.LOVName = "KgKontoart";
            this.edtKontoart.Name = "edtKontoart";
            this.edtKontoart.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtKontoart.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtKontoart.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtKontoart.Properties.Appearance.Options.UseBackColor = true;
            this.edtKontoart.Properties.Appearance.Options.UseBorderColor = true;
            this.edtKontoart.Properties.Appearance.Options.UseFont = true;
            this.edtKontoart.Properties.AppearanceDropDown.BackColor = System.Drawing.Color.BlanchedAlmond;
            this.edtKontoart.Properties.AppearanceDropDown.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.edtKontoart.Properties.AppearanceDropDown.Options.UseBackColor = true;
            this.edtKontoart.Properties.AppearanceDropDown.Options.UseFont = true;
            this.edtKontoart.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject2.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject2.Options.UseBackColor = true;
            this.edtKontoart.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, null, new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject2)});
            this.edtKontoart.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtKontoart.Properties.NullText = "";
            this.edtKontoart.Properties.ShowFooter = false;
            this.edtKontoart.Properties.ShowHeader = false;
            this.edtKontoart.Size = new System.Drawing.Size(156, 24);
            this.edtKontoart.TabIndex = 8;
            //
            // btnVorsaldoausgleich
            //
            this.btnVorsaldoausgleich.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.btnVorsaldoausgleich.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.btnVorsaldoausgleich.Location = new System.Drawing.Point(576, 572);
            this.btnVorsaldoausgleich.Name = "btnVorsaldoausgleich";
            this.btnVorsaldoausgleich.Size = new System.Drawing.Size(137, 24);
            this.btnVorsaldoausgleich.TabIndex = 9;
            this.btnVorsaldoausgleich.Text = "Vorsaldi ausgleichen";
            this.btnVorsaldoausgleich.UseCompatibleTextRendering = true;
            this.btnVorsaldoausgleich.UseVisualStyleBackColor = false;
            this.btnVorsaldoausgleich.Click += new System.EventHandler(this.btnVorsaldoausgleich_Click);
            //
            // label40
            //
            this.label40.Location = new System.Drawing.Point(5, 30);
            this.label40.Name = "label40";
            this.label40.Size = new System.Drawing.Size(142, 24);
            this.label40.TabIndex = 262;
            this.label40.Text = "Person mit zivilr. Massn.";
            this.label40.UseCompatibleTextRendering = true;
            //
            // edtAdresse
            //
            this.edtAdresse.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtAdresse.Location = new System.Drawing.Point(153, 68);
            this.edtAdresse.Name = "edtAdresse";
            this.edtAdresse.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtAdresse.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtAdresse.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtAdresse.Properties.Appearance.Options.UseBackColor = true;
            this.edtAdresse.Properties.Appearance.Options.UseBorderColor = true;
            this.edtAdresse.Properties.Appearance.Options.UseFont = true;
            this.edtAdresse.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtAdresse.Properties.Name = "editPlzOrt.Properties";
            this.edtAdresse.Properties.ReadOnly = true;
            this.edtAdresse.Size = new System.Drawing.Size(279, 24);
            this.edtAdresse.TabIndex = 274;
            //
            // edtBaPersonID
            //
            this.edtBaPersonID.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtBaPersonID.Location = new System.Drawing.Point(373, 30);
            this.edtBaPersonID.Name = "edtBaPersonID";
            this.edtBaPersonID.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtBaPersonID.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtBaPersonID.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtBaPersonID.Properties.Appearance.Options.UseBackColor = true;
            this.edtBaPersonID.Properties.Appearance.Options.UseBorderColor = true;
            this.edtBaPersonID.Properties.Appearance.Options.UseFont = true;
            this.edtBaPersonID.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtBaPersonID.Properties.Name = "editMandantNr.Properties";
            this.edtBaPersonID.Properties.ReadOnly = true;
            this.edtBaPersonID.Size = new System.Drawing.Size(59, 24);
            this.edtBaPersonID.TabIndex = 283;
            //
            // edtMT
            //
            this.edtMT.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtMT.Location = new System.Drawing.Point(153, 91);
            this.edtMT.Name = "edtMT";
            this.edtMT.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtMT.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtMT.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtMT.Properties.Appearance.Options.UseBackColor = true;
            this.edtMT.Properties.Appearance.Options.UseBorderColor = true;
            this.edtMT.Properties.Appearance.Options.UseFont = true;
            this.edtMT.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtMT.Properties.Name = "editMT.Properties";
            this.edtMT.Properties.ReadOnly = true;
            this.edtMT.Size = new System.Drawing.Size(279, 24);
            this.edtMT.TabIndex = 285;
            //
            // label10
            //
            this.label10.Location = new System.Drawing.Point(5, 91);
            this.label10.Name = "label10";
            this.label10.Size = new System.Drawing.Size(100, 24);
            this.label10.TabIndex = 286;
            this.label10.Text = "Beist. oder Vorm.";
            this.label10.UseCompatibleTextRendering = true;
            //
            // label1
            //
            this.label1.Location = new System.Drawing.Point(5, 68);
            this.label1.Name = "label1";
            this.label1.Size = new System.Drawing.Size(52, 24);
            this.label1.TabIndex = 287;
            this.label1.Text = "Adresse";
            this.label1.UseCompatibleTextRendering = true;
            //
            // lblStandardKontenplan
            //
            this.lblStandardKontenplan.LabelStyle = KiSS4.Gui.LabelStyleType.TitleLabel;
            this.lblStandardKontenplan.Location = new System.Drawing.Point(505, 34);
            this.lblStandardKontenplan.Name = "lblStandardKontenplan";
            this.lblStandardKontenplan.Size = new System.Drawing.Size(164, 16);
            this.lblStandardKontenplan.TabIndex = 288;
            this.lblStandardKontenplan.Text = "Standard-Kontenplan";
            this.lblStandardKontenplan.UseCompatibleTextRendering = true;
            this.lblStandardKontenplan.Visible = false;
            //
            // lblKontoNr
            //
            this.lblKontoNr.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.lblKontoNr.Location = new System.Drawing.Point(8, 490);
            this.lblKontoNr.Name = "lblKontoNr";
            this.lblKontoNr.Size = new System.Drawing.Size(40, 24);
            this.lblKontoNr.TabIndex = 290;
            this.lblKontoNr.Text = "Nr";
            this.lblKontoNr.UseCompatibleTextRendering = true;
            //
            // kissLabel3
            //
            this.kissLabel3.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.kissLabel3.Location = new System.Drawing.Point(8, 550);
            this.kissLabel3.Name = "kissLabel3";
            this.kissLabel3.Size = new System.Drawing.Size(49, 24);
            this.kissLabel3.TabIndex = 292;
            this.kissLabel3.Text = "Vorsaldo";
            this.kissLabel3.UseCompatibleTextRendering = true;
            //
            // lblKontoart
            //
            this.lblKontoart.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.lblKontoart.Location = new System.Drawing.Point(506, 520);
            this.lblKontoart.Name = "lblKontoart";
            this.lblKontoart.Size = new System.Drawing.Size(50, 24);
            this.lblKontoart.TabIndex = 293;
            this.lblKontoart.Text = "Kontoart";
            this.lblKontoart.UseCompatibleTextRendering = true;
            //
            // lblKlasse
            //
            this.lblKlasse.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.lblKlasse.Location = new System.Drawing.Point(506, 490);
            this.lblKlasse.Name = "lblKlasse";
            this.lblKlasse.Size = new System.Drawing.Size(40, 24);
            this.lblKlasse.TabIndex = 294;
            this.lblKlasse.Text = "Klasse";
            this.lblKlasse.UseCompatibleTextRendering = true;
            //
            // btnRight
            //
            this.btnRight.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Right)));
            this.btnRight.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.btnRight.IconID = 13;
            this.btnRight.Location = new System.Drawing.Point(756, 258);
            this.btnRight.Name = "btnRight";
            this.btnRight.Size = new System.Drawing.Size(24, 24);
            this.btnRight.TabIndex = 307;
            this.btnRight.UseCompatibleTextRendering = true;
            this.btnRight.UseVisualStyleBackColor = false;
            this.btnRight.Visible = false;
            //
            // btnLeft
            //
            this.btnLeft.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Right)));
            this.btnLeft.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.btnLeft.IconID = 11;
            this.btnLeft.Location = new System.Drawing.Point(756, 288);
            this.btnLeft.Name = "btnLeft";
            this.btnLeft.Size = new System.Drawing.Size(24, 24);
            this.btnLeft.TabIndex = 308;
            this.btnLeft.UseCompatibleTextRendering = true;
            this.btnLeft.UseVisualStyleBackColor = false;
            this.btnLeft.Visible = false;
            //
            // btnUp
            //
            this.btnUp.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Right)));
            this.btnUp.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.btnUp.IconID = 16;
            this.btnUp.Location = new System.Drawing.Point(756, 198);
            this.btnUp.Name = "btnUp";
            this.btnUp.Size = new System.Drawing.Size(24, 24);
            this.btnUp.TabIndex = 309;
            this.btnUp.UseCompatibleTextRendering = true;
            this.btnUp.UseVisualStyleBackColor = false;
            this.btnUp.Visible = false;
            //
            // btnDown
            //
            this.btnDown.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Right)));
            this.btnDown.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.btnDown.IconID = 17;
            this.btnDown.Location = new System.Drawing.Point(756, 228);
            this.btnDown.Name = "btnDown";
            this.btnDown.Size = new System.Drawing.Size(24, 24);
            this.btnDown.TabIndex = 310;
            this.btnDown.UseCompatibleTextRendering = true;
            this.btnDown.UseVisualStyleBackColor = false;
            this.btnDown.Visible = false;
            //
            // btnExpand
            //
            this.btnExpand.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Right)));
            this.btnExpand.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.btnExpand.Image = ((System.Drawing.Image)(resources.GetObject("btnExpand.Image")));
            this.btnExpand.Location = new System.Drawing.Point(756, 124);
            this.btnExpand.Name = "btnExpand";
            this.btnExpand.Size = new System.Drawing.Size(24, 24);
            this.btnExpand.TabIndex = 311;
            this.btnExpand.UseCompatibleTextRendering = true;
            this.btnExpand.UseVisualStyleBackColor = false;
            this.btnExpand.Click += new System.EventHandler(this.btnExpand_Click);
            //
            // btnCollapse
            //
            this.btnCollapse.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Right)));
            this.btnCollapse.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.btnCollapse.Image = ((System.Drawing.Image)(resources.GetObject("btnCollapse.Image")));
            this.btnCollapse.Location = new System.Drawing.Point(756, 154);
            this.btnCollapse.Name = "btnCollapse";
            this.btnCollapse.Size = new System.Drawing.Size(24, 24);
            this.btnCollapse.TabIndex = 312;
            this.btnCollapse.UseCompatibleTextRendering = true;
            this.btnCollapse.UseVisualStyleBackColor = false;
            this.btnCollapse.Click += new System.EventHandler(this.btnCollapse_Click);
            //
            // panel1
            //
            this.panel1.Controls.Add(this.picTitel);
            this.panel1.Controls.Add(this.lblTitel);
            this.panel1.Dock = System.Windows.Forms.DockStyle.Top;
            this.panel1.Location = new System.Drawing.Point(0, 0);
            this.panel1.Name = "panel1";
            this.panel1.Size = new System.Drawing.Size(783, 24);
            this.panel1.TabIndex = 313;
            //
            // picTitel
            //
            this.picTitel.Image = ((System.Drawing.Image)(resources.GetObject("picTitel.Image")));
            this.picTitel.Location = new System.Drawing.Point(5, 5);
            this.picTitel.Name = "picTitel";
            this.picTitel.Size = new System.Drawing.Size(16, 16);
            this.picTitel.TabIndex = 293;
            this.picTitel.TabStop = false;
            //
            // lblTitel
            //
            this.lblTitel.LabelStyle = KiSS4.Gui.LabelStyleType.TitleLabel;
            this.lblTitel.Location = new System.Drawing.Point(25, 5);
            this.lblTitel.Name = "lblTitel";
            this.lblTitel.Size = new System.Drawing.Size(542, 15);
            this.lblTitel.TabIndex = 0;
            this.lblTitel.Text = "Kontenplan";
            this.lblTitel.UseCompatibleTextRendering = true;
            //
            // lblKontoName
            //
            this.lblKontoName.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.lblKontoName.Location = new System.Drawing.Point(8, 520);
            this.lblKontoName.Name = "lblKontoName";
            this.lblKontoName.Size = new System.Drawing.Size(40, 24);
            this.lblKontoName.TabIndex = 314;
            this.lblKontoName.Text = "Name";
            this.lblKontoName.UseCompatibleTextRendering = true;
            //
            // kissLabel2
            //
            this.kissLabel2.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.kissLabel2.Location = new System.Drawing.Point(178, 550);
            this.kissLabel2.Name = "kissLabel2";
            this.kissLabel2.Size = new System.Drawing.Size(35, 24);
            this.kissLabel2.TabIndex = 316;
            this.kissLabel2.Text = "CHF";
            this.kissLabel2.UseCompatibleTextRendering = true;
            //
            // CtlKgKonto
            //
            this.ActiveSQLQuery = this.qryKgKonto;
            this.Controls.Add(this.kissLabel2);
            this.Controls.Add(this.lblKontoName);
            this.Controls.Add(this.panel1);
            this.Controls.Add(this.btnCollapse);
            this.Controls.Add(this.btnExpand);
            this.Controls.Add(this.btnDown);
            this.Controls.Add(this.btnUp);
            this.Controls.Add(this.btnLeft);
            this.Controls.Add(this.btnRight);
            this.Controls.Add(this.lblKlasse);
            this.Controls.Add(this.lblKontoart);
            this.Controls.Add(this.kissLabel3);
            this.Controls.Add(this.lblKontoNr);
            this.Controls.Add(this.lblStandardKontenplan);
            this.Controls.Add(this.label1);
            this.Controls.Add(this.label10);
            this.Controls.Add(this.edtMT);
            this.Controls.Add(this.edtBaPersonID);
            this.Controls.Add(this.edtAdresse);
            this.Controls.Add(this.label40);
            this.Controls.Add(this.btnVorsaldoausgleich);
            this.Controls.Add(this.edtKontoart);
            this.Controls.Add(this.edtKlasse);
            this.Controls.Add(this.edtVorsaldo);
            this.Controls.Add(this.edtKontoName);
            this.Controls.Add(this.edtKontoNr);
            this.Controls.Add(this.treKgKonto);
            this.Controls.Add(this.grdPeriode);
            this.Controls.Add(this.edtMandant);
            this.Name = "CtlKgKonto";
            this.Size = new System.Drawing.Size(783, 599);
            this.Load += new System.EventHandler(this.CtlKgKonto_Load);
            ((System.ComponentModel.ISupportInitialize)(this.edtMandant.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.grdPeriode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryPeriode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.gridView2)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.treKgKonto)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryKgKonto)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoNr.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoName.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtVorsaldo.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKlasse.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKlasse)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoart.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoart)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.label40)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtAdresse.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBaPersonID.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtMT.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.label10)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.label1)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblStandardKontenplan)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKontoNr)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.kissLabel3)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKontoart)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKlasse)).EndInit();
            this.panel1.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.picTitel)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblTitel)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKontoName)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.kissLabel2)).EndInit();
            this.ResumeLayout(false);
        }

        #endregion

        #region Dispose

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                if ((components != null))
                {
                    components.Dispose();
                }
            }
            base.Dispose(disposing);
        }

        #endregion

        #region Public Methods

        public override string GetContextName()
        {
            return "KgFibu";
        }

        public void Init(string Name, Image TitleImage, int FaLeistungID, int BaPersonID)
        {
            lblTitel.Text = Name;
            picTitel.Image = TitleImage;
            faLeistungID = FaLeistungID;
            baPersonID = BaPersonID;
        }

        //BeforeFocusNodeEventHandler
        public override bool OnAddData()
        {
            // avoid crash in case of too fast user
            if (this.treKgKonto.DataSource == null)
            {
                throw new KissCancelException();
            }

            if (!qryKgKonto.Post()) return false;

            int NewKontoNr = 0;

            // Nach dem Öffnen der Maske ist noch kein Node fokussiert
            if (this.treKgKonto.FocusedNode == null)
            {
                throw new KissCancelException();
            }

            if ((bool)qryKgKonto["KontoGruppe"])
            {
                this.gruppeKontoID = (int)this.treKgKonto.FocusedNode.GetValue("KgKontoID");
            }
            else
            {
                this.gruppeKontoID = (int)this.treKgKonto.FocusedNode.GetValue("GruppeKontoID");
            }

            NewKontoNr = (int)DBUtil.ExecuteScalarSQL(@"
                SELECT isNull(MAX(convert(int,KontoNr))+1,0)
                               FROM   KgKonto
                               WHERE  GruppeKontoID = {0}", this.gruppeKontoID);

            // create a new row and imediately save it to database because of problems with tree

            // calc next sortkey
            this.sortKey = (int)DBUtil.ExecuteScalarSQL(@"
                SELECT isNull(MAX(SortKey)+10,0)
                        FROM   KgKonto
                        WHERE  GruppeKontoID = {0}", this.gruppeKontoID);

            int KgKontoklasseCode = (int)this.treKgKonto.FocusedNode.GetValue("KgKontoklasseCode");
            bool VorsaldoUebertrag = (bool)this.treKgKonto.FocusedNode.GetValue("VorsaldoUebertrag");

            treKgKonto.DataSource = null;

            // apply values to new row
            qryKgKonto.Insert();

            qryKgKonto["GruppeKontoID"] = gruppeKontoID;
            qryKgKonto["SortKey"] = sortKey;
            qryKgKonto["KontoGruppe"] = false;
            qryKgKonto["KontoNr"] = NewKontoNr.ToString();
            qryKgKonto["KontoName"] = "Neues Konto";
            qryKgKonto["KgPeriodeID"] = (baPersonID == 0) ? DBNull.Value : qryPeriode["KgPeriodeID"];
            qryKgKonto["KgKontoklasseCode"] = KgKontoklasseCode;
            qryKgKonto["KgKontoartCode"] = DBNull.Value; // leer
            qryKgKonto["Vorsaldo"] = 0F;
            qryKgKonto["VorsaldoUebertrag"] = VorsaldoUebertrag;
            qryKgKonto.Post();

            ShowKonten((int)qryKgKonto["KgKontoID"]);
            edtKontoNr.Focus();

            // reset properties
            gruppeKontoID = -1;
            sortKey = -1;

            // handle controls
            //this.RefreshEnabledStates();

            return true;
        }

        public override bool OnDeleteData()
        {
            if (qryKgKonto.Row.RowState == DataRowState.Added)
            {
                return qryKgKonto.Delete();
            }

            try
            {
                CheckPeriodeActiv();

                bool standard = (bool)qryKgKonto["standard"];
                bool addon = (bool)qryKgKonto["addon"];
                bool gruppe = (bool)qryKgKonto["KontoGruppe"];

                if (standard)
                {
                    if (!DBUtil.UserHasRight("CtlKgKonto_Standardkontenplan"))
                        throw new KissInfoException("Fehlende Berechtigung, um einen Eintrag im Standardkontoplans zu löschen!");
                }
                else
                {
                    if (((int)qryPeriode["KgPeriodeStatusCode"] != 1))
                        throw new KissInfoException("Konto kann nicht gelöscht werden, da die Buchungsperiode nicht aktiv ist");

                    if (gruppe)
                        throw new KissInfoException("In einem Individual-Kontenplan können keine Kontogruppen oder -klassen gelöscht werden!");

                    if (!addon)
                        throw new KissInfoException("Kopierte Konten aus dem Standardkontenplan können nicht gelöscht werden");
                }
            }
            catch (Exception ex)
            {
                KissMsg.ShowInfo(ex.Message);
                return false;
            }
            return qryKgKonto.Delete();
        }

        public override void OnMoveFirst()
        {
            return;
        }

        public override void OnMoveLast()
        {
            return;
        }

        public override void OnMoveNext()
        {
            return;
        }

        public override void OnMovePrevious()
        {
            return;
        }

        #endregion

        #region Private Methods

        private void btnCollapse_Click(object sender, System.EventArgs e)
        {
            treKgKonto.CollapseAll();
        }

        private void btnExpand_Click(object sender, System.EventArgs e)
        {
            treKgKonto.ExpandAll();
        }

        private void btnVorsaldoausgleich_Click(object sender, System.EventArgs e)
        {
            if (!qryKgKonto.Post()) return;
            if (qryPeriode.Count == 0) return;

            if (!KissMsg.ShowQuestion("Soll das Total der Vorsaldi mit dem Vorsaldo des Kontos 'Kapital Klient' ausgeglichen werden?")) return;

            SqlQuery qry = DBUtil.OpenSQL(@"
                select KgKontoID
                from   KgKonto
                where  KgPeriodeID = {0} and
                       KgKontoartCode = 4",
                qryPeriode["KgPeriodeID"]);

            if (qry.Count == 0)
            {
                KissMsg.ShowInfo("Im Kontenplan ist kein Konto vom Typ 'Kapital Klient' erfasst!");
                return;
            }

            if (qry.Count > 1)
            {
                KissMsg.ShowInfo("Im Kontenplan sind mehrere Konti vom Typ 'Kapital Klient' erfasst!");
                return;
            }

            int KgKontoID = (int)qry["KgKontoID"];

            DBUtil.ExecSQL(@"
                update KgKonto
                set    Vorsaldo = (select -sum(Vorsaldo)
                                   from   KgKonto
                                   where  KgPeriodeID = {0} and
                                          KgKontoID <> {1})
                where  KgKontoID = {1}",
                qryPeriode["KgPeriodeID"],
                KgKontoID);

            qryPeriode["SaldoTotal"] = 0;
            qryPeriode.RowModified = false;
            qryPeriode.DataTable.AcceptChanges();
            ShowKonten((int)qryKgKonto["KgKontoID"]);

            KissMsg.ShowInfo("Die Vorsaldi sind ausgeglichen.");
        }

        private void CheckPeriodeActiv()
        {
            if (DBUtil.IsEmpty(qryPeriode["KgPeriodeID"])) return;

            //Periodenstatus könnte geändert haben: Deshalb nochmals prüfen ob Periode aktiv
            int status = 1;
            try
            {
                status = (int)DBUtil.ExecuteScalarSQL(
                    "select KgPeriodeStatusCode from KgPeriode where KgPeriodeID = {0}",
                    qryPeriode["KgPeriodeID"]);
            }
            catch { }

            if (status != 1)
            {
                KissMsg.ShowInfo("Die Periode ist nicht (mehr) aktiv. Deshalb ist keine Veränderung am Kontenplan möglich!");
                throw new Exception();
            }
        }

        private void CtlKgKonto_Load(object sender, System.EventArgs e)
        {
            lblStandardKontenplan.Visible = (faLeistungID <= 0);
            grdPeriode.Visible = (faLeistungID > 0);

            colKlasse.ColumnEdit = GetLOVLookUpEdit((SqlQuery)edtKlasse.Properties.DataSource);
            colKontoart.ColumnEdit = GetLOVLookUpEdit((SqlQuery)edtKontoart.Properties.DataSource);

            this.treKgKonto.BeforeFocusNode += new DevExpress.XtraTreeList.BeforeFocusNodeEventHandler(this.treKgKonto_BeforeFocusNode);

            if (baPersonID > 0)
            {
                SqlQuery qry = DBUtil.OpenSQL(@"
                SELECT Name    = PRS.NameVorname,
                       Adresse = PRS.Wohnsitz,
                       [Beist. oder Vorm.] = dbo.fnVmGetMTName(PRS.BaPersonID)
                FROM   vwPerson PRS
                WHERE  PRS.BaPersonID = {0}",
                  baPersonID);

                edtBaPersonID.EditValue = baPersonID;
                edtMandant.EditValue = qry["Name"];
                edtAdresse.EditValue = qry["Adresse"];
                edtMT.EditValue = qry["Beist. oder Vorm."];

                edtMandant.EditMode = EditModeType.ReadOnly;
            }
            else
            {
                edtMandant.EditMode = EditModeType.Normal;
            }

            ShowPerioden();
        }

        private void DisplayPerioden()
        {
            qryPeriode.Fill(baPersonID);
            try
            {
                while (!((DateTime)qryPeriode["PeriodeVon"] <= DateTime.Today && (DateTime)qryPeriode["PeriodeBis"] >= DateTime.Today))
                    if (!qryPeriode.Next()) break;
            }
            catch { }
        }

        private void edtMandant_UserModifiedFld(object sender, KiSS4.Gui.UserModifiedFldEventArgs e)
        {
            string SearchString = edtMandant.EditValue.ToString().Replace("*", "%").Replace("?", "_").Replace(" ", "%");

            if (DBUtil.IsEmpty(SearchString))
            {
                if (e.ButtonClicked)
                {
                    KissMsg.ShowInfo("Bitte zuerst einen Suchbegriff eingeben!");
                }
                else
                {
                    baPersonID = -1;
                    edtMandant.EditValue = null;
                    edtBaPersonID.EditValue = null;
                    edtAdresse.EditValue = null;
                    edtMT.EditValue = null;
                    baPersonID = 0;
                    ShowPerioden();
                }
                return;
            }

            KissLookupDialog dlg = new KissLookupDialog();
            e.Cancel = !dlg.SearchData(@"
              SELECT distinct
                     BaPersonID$  = PRS.BaPersonID,
                     [Person-Nr.] = PRS.BaPersonID,
                     Name         = PRS.NameVorname,
                     Geburtsdatum = PRS.Geburtsdatum,
                     [Alter]      = PRS.[Alter],
                     Adresse      = PRS.Wohnsitz,
                     [Beist. oder Vorm.] = '' -- dbo.fnVmGetMT(PRS.BaPersonID)
              FROM   vwPerson PRS
                     inner join FaLeistung LEI on LEI.BaPersonID = PRS.BaPersonID and
                                                  LEI.FaProzessCode = 500
              WHERE  PRS.NameVorname LIKE '%' + {0} + '%'
              ORDER BY PRS.NameVorname",
              SearchString,
              e.ButtonClicked, null, null, null);

            if (!e.Cancel)
            {
                baPersonID = (int)dlg["BaPersonID$"];
                edtMandant.EditValue = dlg["Name"];
                edtBaPersonID.EditValue = dlg["BaPersonID$"];
                edtAdresse.EditValue = dlg["Adresse"];
                edtMT.EditValue = dlg["Beist. oder Vorm."];
                ShowPerioden();
            }
        }

        /// <param name="KgKontoID">KgKontoID of current node</param>
        /// <param name="parentItemID">GruppeKontoID of current node</param>
        /// <returns>KgKontoID of previous node if we have any; GruppeKontoID if we are the first node of parent; -1 if node has no previous node</returns>
        private int GetKgKontoIDOfPreviousNode(int kgKontoID, object parentItemID)
        {
            if (kgKontoID < 1 || DBUtil.IsEmpty(parentItemID))
            {
                // invalid or no previous node
                return -1;
            }

            SqlQuery qry = new SqlQuery();
            //TODO    this.FillDataSource(qry);
            if (!qry.Find(string.Format("KgKontoID = {0}", kgKontoID)))
            {
                // node not found
                return -1;
            }

            // goto previous node
            qry.Previous();

            // validate
            if ((int)qry.Row["KgKontoID"] == kgKontoID)
            {
                // current node is the first --> root or is system KgKonto item (cannot have children due to its functionality)
                return -1;
            }
            if (qry.Row["GruppeKontoID"] == System.DBNull.Value || (int)qry.Row["GruppeKontoID"] != (int)parentItemID || (int)qry.Row["KgKontoID"] == (int)parentItemID)
            {
                // current node is the first of its parent node
                return (int)parentItemID;
            }

            //parent of current node is on same level
            return (int)qry.Row["KgKontoID"];
        }

        private RepositoryItemLookUpEdit GetLOVLookUpEdit(DB.SqlQuery qry, string ValueMember, string DisplayMember)
        {
            RepositoryItemLookUpEdit LOVLookUpEdit = null;

            LOVLookUpEdit = new DevExpress.XtraEditors.Repository.RepositoryItemLookUpEdit();
            treKgKonto.RepositoryItems.Add(LOVLookUpEdit);

            LOVLookUpEdit.AutoHeight = false;
            LOVLookUpEdit.Columns.AddRange(new DevExpress.XtraEditors.Controls.LookUpColumnInfo[] {
              new DevExpress.XtraEditors.Controls.LookUpColumnInfo(DisplayMember)});

            LOVLookUpEdit.AppearanceDropDown.BackColor = System.Drawing.Color.BlanchedAlmond;
            LOVLookUpEdit.AppearanceDropDown.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            LOVLookUpEdit.AppearanceDropDown.Options.UseBackColor = true;
            LOVLookUpEdit.AppearanceDropDown.Options.UseFont = true;

            LOVLookUpEdit.NullText = "";
            LOVLookUpEdit.ShowHeader = false;
            LOVLookUpEdit.ShowFooter = false;

            LOVLookUpEdit.DisplayMember = DisplayMember;
            LOVLookUpEdit.ValueMember = ValueMember;
            LOVLookUpEdit.DropDownRows = Math.Min(qry.Count, 7);
            LOVLookUpEdit.DataSource = qry;

            return LOVLookUpEdit;
        }

        private RepositoryItemLookUpEdit GetLOVLookUpEdit(DB.SqlQuery qry)
        {
            return GetLOVLookUpEdit(qry, "Code", "Text");
        }

        private RepositoryItemLookUpEdit GetLOVLookUpEdit(string LOVName)
        {
            return GetLOVLookUpEdit(LOVName, false);
        }

        private RepositoryItemLookUpEdit GetLOVLookUpEdit(string LOVName, bool allowNull)
        {
            string sql = @"
                SELECT Code, Text, SortKey
                FROM   XLOVCode
                WHERE  LOVName = CONVERT(varchar(100), {0})
                ORDER BY SortKey";

            if (allowNull) sql = @"
                SELECT NULL AS Code, '' AS Text, -1 AS SortKey
                UNION ALL " + sql;

            return this.GetLOVLookUpEdit(DB.DBUtil.OpenSQL(sql, LOVName));
        }

        /// <param name="compareMinimum">True if comparing for minimum, false if compareing for maximum</param>
        /// <param name="parentItemID">Current gruppeKontoID of KgKonto</param>
        /// <param name="currentSortKey">Current SortKey of KgKonto</param>
        /// <returns>True if KgKonto is min/max, false if KgKontoitem is not min/max</returns>
        private bool IsMinMaxSortKey(bool compareMinimum, int parentItemID, object currentSortKey)
        {
            // validate
            if (parentItemID < 1 || DBUtil.IsEmpty(currentSortKey) || !Utils.IsNatural(currentSortKey.ToString()))
            {
                return false;
            }

            // get min/max id
            int minMaxSortKey = (int)DBUtil.ExecuteScalarSQL(string.Format(@"SELECT IsNull({0}(SortKey), -1) AS MinMaxSortKey
                                                                               FROM KgKonto
                                                                               WHERE IsNull(GruppeKontoID, 0) = IsNull({1}, 0)", compareMinimum ? "MIN" : "MAX", parentItemID));

            // compare
            return Convert.ToInt32(currentSortKey) == minMaxSortKey;
        }

        private void qryKgKonto_AfterPost(object sender, System.EventArgs e)
        {
            if (baPersonID != 0)
            {
                SqlQuery qry = DBUtil.OpenSQL(@"
                    Select SaldoTotal = isNull(sum(isNull(Vorsaldo,0)),0) from KgKonto
                    where KgPeriodeID = {0}",
                    qryPeriode["KgPeriodeID"]);

                qryPeriode["SaldoTotal"] = qry["SaldoTotal"];
                qryPeriode.RowModified = false;
                qryPeriode.DataTable.AcceptChanges();
            }
        }

        private void qryKgKonto_BeforePost(object sender, System.EventArgs e)
        {
            CheckPeriodeActiv();

            DBUtil.CheckNotNullField(edtKontoNr, lblKontoNr.Text);
            DBUtil.CheckNotNullField(edtKontoName, lblKontoName.Text);
            DBUtil.CheckNotNullField(edtKlasse, lblKlasse.Text);
            //DBUtil.CheckNotNullField(edtKontoart, lblKontoart.Text);

            if (!(bool)qryKgKonto["KontoGruppe"])
            {
                int KontoNr = 0;
                try
                {
                    KontoNr = Convert.ToInt32(qryKgKonto["KontoNr"]);
                    qryKgKonto["SortKey"] = KontoNr;
                }
                catch
                {
                    throw new KissCancelException("Die Kontonummer muss eine ganze Zahl sein");
                }
            }

            if (edtKontoart.EditValue != DBNull.Value && edtKontoart.EditValue != null)
            {
                var sameKontoartKontos = qryKgKonto.DataTable.Select(string.Format("KgKontoartCode = {0}", edtKontoart.EditValue));
                if (sameKontoartKontos.Length > 1)
                {
                    var errorMsg = KissMsg.GetMLMessage(Name, "ErrorMehrereKontosGleicherKontoart", @"
Es gibt bereits ein Konto der Art {0}.
Bitte ändern Sie zuerst die Art des bestehenden {0} Kontos.", edtKontoart.Text);
                    KissMsg.ShowInfo(errorMsg);
                    throw new KissCancelException(errorMsg);
                }
            }

            qryKgKonto["Konto"] = qryKgKonto["KontoNr"].ToString() + " " + qryKgKonto["KontoName"].ToString();
            qryKgKonto["VorsaldoText"] = ((decimal)qryKgKonto["Vorsaldo"]).ToString("N2");
        }

        private void qryKgKonto_PositionChanged(object sender, System.EventArgs e)
        {
            SetEditMode();
        }

        private void qryPeriode_PositionChanged(object sender, System.EventArgs e)
        {
            ShowKonten(-1);
        }

        private void qryPeriode_PositionChanging(object sender, EventArgs e)
        {
            qryKgKonto.Post();
        }

        private void RefreshEnabledStates()
        {
            return;
        }

        private void SetEditMode()
        {
            if (qryKgKonto.Row.RowState == DataRowState.Added) return;

            bool standard = (bool)qryKgKonto["standard"];
            bool addon = (bool)qryKgKonto["addon"];
            bool gruppe = (bool)qryKgKonto["KontoGruppe"];

            if (standard && !DBUtil.UserHasRight("CtlKgKonto_Standardkontenplan"))
            {
                qryKgKonto.EnableBoundFields(false);
                return;
            }

            // Check if Periode is active
            if (!standard && ((int)qryPeriode["KgPeriodeStatusCode"] != 1))
            {
                qryKgKonto.EnableBoundFields(false);
                return;
            }

            bool hasRightToEditKontoart = DBUtil.UserHasRight("CtlKgKonto_KontoartAnpassen");

            edtKontoNr.EditMode = standard || (!gruppe && addon) ? EditModeType.Normal : EditModeType.ReadOnly;
            edtKontoName.EditMode = standard || !gruppe ? EditModeType.Normal : EditModeType.ReadOnly;
            edtVorsaldo.EditMode = !standard && !gruppe ? EditModeType.Normal : EditModeType.ReadOnly;
            //edtVorsaldoUebertrag.EditMode = standard              ? EditModeType.Normal:EditModeType.ReadOnly;
            edtKlasse.EditMode = standard ? EditModeType.Normal : EditModeType.ReadOnly;
            edtKontoart.EditMode = standard || hasRightToEditKontoart ? EditModeType.Normal : EditModeType.ReadOnly;
        }

        private void ShowKonten(int newKgKontoID)
        {
            try
            {
                //this.treKgKonto.SaveState();

                treKgKonto.DataSource = null;
                if (baPersonID > 0)
                {
                    if (DBUtil.IsEmpty(qryPeriode["KgPeriodeID"]))
                        qryKgKonto.Fill(-1);
                    else
                        qryKgKonto.Fill(qryPeriode["KgPeriodeID"]);
                }
                else
                {
                    qryKgKonto.Fill(DBNull.Value);
                }
                treKgKonto.DataSource = qryKgKonto;

                //this.treKgKonto.LoadState();

                treKgKonto.ExpandAll();
                treKgKonto.FocusedNode = treKgKonto.FindNodeByKeyID(newKgKontoID);

                this.RefreshEnabledStates();
            }
            finally
            {
                isRefreshingTree = false;
            }

            //Vorsaldo im Standardkontenplan nicht sichtbar
            if (baPersonID == 0)
            {
                colVorsaldo.VisibleIndex = -1;
                btnVorsaldoausgleich.Visible = false;
            }
            else
            {
                colVorsaldo.VisibleIndex = 1;
                btnVorsaldoausgleich.Visible = true;
            }

            //Editierrecht Standardkontenplan
            if (baPersonID <= 0)
            {
                /*
                    if (Session.User.IsUserAdmin)
                    {
                        gridKonten.GridStyle = KiSS4.Gui.GridStyleType.Editable;
                        qryKonto.CanInsert = true;
                        qryKonto.CanDelete  = true;
                        qryKonto.CanUpdate = true;
                    }
                    else
                    {
                        gridKonten.GridStyle = KiSS4.Gui.GridStyleType.ReadOnly;
                        qryKonto.CanInsert = false;
                        qryKonto.CanDelete  = false;
                        qryKonto.CanUpdate = false;
                    }
                */
            }
        }

        private void ShowPerioden()
        {
            if (baPersonID > 0)
            {
                //Mandant-Kontenplan
                grdPeriode.Visible = true;
                lblStandardKontenplan.Visible = false;
                btnLeft.Visible = false;
                btnRight.Visible = false;
                DisplayPerioden();
                if (qryPeriode.Count == 0) ShowKonten(-1);
            }
            else
            {
                //Standard-Kontenplan
                grdPeriode.Visible = false;
                lblStandardKontenplan.Visible = true;
                qryPeriode.DataTable.Rows.Clear();
                btnLeft.Visible = true;
                btnRight.Visible = true;
                ShowKonten(-1);
            }
        }

        private void treKgKonto_BeforeFocusNode(object sender, DevExpress.XtraTreeList.BeforeFocusNodeEventArgs e)
        {
            e.CanFocus = qryKgKonto.Post();
        }

        private void treKgKonto_FocusedNodeChanged(object sender, DevExpress.XtraTreeList.FocusedNodeChangedEventArgs e)
        {
            if (e.Node == null || isRefreshingTree) return;

            isRefreshingTree = true;
            if (this.qryKgKonto.Post())
            {
                // apply new selected node in query
                this.qryKgKonto.Find(string.Format("KgKontoID = {0}", e.Node.GetValue("KgKontoID")));
            }
            else
            {
                if (e.OldNode != null)
                {
                    // post failed, go back to old selected node
                    this.treKgKonto.FocusedNode = e.OldNode;
                }
            }
            isRefreshingTree = false;
        }

        #endregion
    }
}