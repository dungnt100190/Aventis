#region Header

//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:2.0.50727.3053
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#endregion

using System;
using System.Data;
using System.Drawing;
using System.Windows.Forms;
using Kiss.Infrastructure;
using Kiss.Interfaces.UI;
using KiSS4.Common;
using KiSS4.DB;
using KiSS4.Gui;

namespace KiSS4.Sozialhilfe.ZH
{
    public class CtlWhFinanzplan : KiSS4.Gui.KissUserControl
    {
        #region Fields

        private object BgBudgetID;
        private int BgFinanzplanID;
        private KiSS4.Gui.KissButton btnAufheben;
        private KiSS4.Gui.KissButton cmdAnfragen;
        private KiSS4.Gui.KissButton cmdAntworten;
        private KiSS4.Gui.KissButton cmdBeenden;
        private KiSS4.Gui.KissButton cmdReferentin;
        private KiSS4.Gui.KissButton cmdStatusRefresh;
        private KiSS4.Gui.KissButton cmdVerlauf;
        private System.ComponentModel.IContainer components;
        private Dokument.XDokument docKiJuAmbulant;
        private Dokument.XDokument docKlaerungsphase;
        private KiSS4.Dokument.XDokument docLeistungsentscheid;
        private KiSS4.Gui.KissLookUpEdit edtBgBewilligungStatusCode;
        private KiSS4.Gui.KissTextEdit edtBgFinanzplanID;
        private KiSS4.Gui.KissLookUpEdit edtBgGrundAbschlussCode;
        private KiSS4.Gui.KissDateEdit edtDatumBis;
        private KiSS4.Gui.KissDateEdit edtDatumVon;
        private KiSS4.Gui.KissDateEdit edtGeplantBis;
        private KiSS4.Gui.KissDateEdit edtGeplantVon;
        private KiSS4.Gui.KissTextEdit edtLogonName;
        private KiSS4.Gui.KissDateEdit edtUnterschriftAntrag;
        private KiSS4.Gui.KissLookUpEdit edtWhGrundbedarfTypCode;
        private KiSS4.Gui.KissLookUpEdit edtWhHilfeTypCode;
        private KiSS4.Gui.KissGroupBox groupBox1;
        private KiSS4.Gui.KissLabel kissLabel5;
        private KiSS4.Gui.KissLabel kissLabel6;
        private KiSS4.Gui.KissLabel lblAbschluss;
        private KiSS4.Gui.KissLabel lblBgBewilligungStatusCode;
        private KiSS4.Gui.KissLabel lblBgFinanzplanID;
        private KiSS4.Gui.KissLabel lblDatumBis;
        private KiSS4.Gui.KissLabel lblDatumVon;
        private KiSS4.Gui.KissLabel lblGeplantBis;
        private KiSS4.Gui.KissLabel lblGeplantVon;
        private KissLabel lblKiJuAmbulant;
        private KissLabel lblKlaerungsphase;
        private KiSS4.Gui.KissLabel lblLeistungsentscheid;
        private KiSS4.Gui.KissLabel lblTitel;
        private KiSS4.Gui.KissLabel lblUnterschriftAntrag;
        private KissLabel lblVorlageKiJuAbulant;
        private KissLabel lblVorlageKlaerungsphase;
        private KissLabel lblVorlageLeistungsentscheid;
        private KiSS4.Gui.KissLabel lblWhGrundbedarfTypCode;
        private KiSS4.Gui.KissLabel lblWhHilfeTypCode;
        private KiSS4.Gui.KissLabel lblZustSA;
        private System.Windows.Forms.PictureBox picTitel;
        private System.Windows.Forms.Panel pnTitle;
        private KiSS4.DB.SqlQuery qryBgFinanzplan;
        private KiSS4.DB.SqlQuery qryCheck;
        private KiSS4.DB.SqlQuery qryIstBewilligt;
        private KiSS4.DB.SqlQuery qryTextmarken;
        private SqlQuery qryWhGrundbedarfTyp;
        private bool transactionOpenBeforePost = false;
        private KiSS4.Gui.KissMemoEdit txtStatusInfo;
        private bool WhGrundbedarfTypCode_Changed = false;

        #endregion

        #region Constructors

        public CtlWhFinanzplan(Image titelImage, string titelText, int bgFinanzplanID, object bgBudgetID)
            : this()
        {
            this.picTitel.Image = titelImage;
            this.BgFinanzplanID = bgFinanzplanID;
            this.BgBudgetID = bgBudgetID;

            this.qryBgFinanzplan.Fill(bgFinanzplanID);
            this.lblTitel.Text = string.Format(this.lblTitel.Text, qryBgFinanzplan["FinanzPlanVon"], qryBgFinanzplan["FinanzPlanBis"], titelText);

            this.qryCheck.Fill(qryCheck.SelectStatement, bgFinanzplanID, Session.User.UserID);

            qryWhGrundbedarfTyp.Fill();
            edtWhGrundbedarfTypCode.LoadQuery(qryWhGrundbedarfTyp);

            // XDocument Modus setzen
            SetXDocumentMode();

            lblVorlageKiJuAbulant.DataBindings.Add(new Binding("Text", docKiJuAmbulant, "DocTemplateName"));
            lblVorlageKlaerungsphase.DataBindings.Add(new Binding("Text", docKlaerungsphase, "DocTemplateName"));
            lblVorlageLeistungsentscheid.DataBindings.Add(new Binding("Text", docLeistungsentscheid, "DocTemplateName"));
        }

        [Obsolete]
        public CtlWhFinanzplan(Image titelImage, string titelText, int bgFinanzplanID)
            : this(titelImage, titelText, bgFinanzplanID,
            DBUtil.ExecuteScalarSQL("SELECT BgBudgetID FROM BgBudget WHERE BgFinanzplanID = {0} AND MasterBudget = 1", bgFinanzplanID))
        {
        }

        public CtlWhFinanzplan()
        {
            this.InitializeComponent();
        }

        #endregion

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject21 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject20 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject19 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject18 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject17 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject16 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject15 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject14 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject13 = new DevExpress.Utils.SerializableAppearanceObject();
            System.ComponentModel.ComponentResourceManager resources = new System.ComponentModel.ComponentResourceManager(typeof(CtlWhFinanzplan));
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject1 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject2 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject3 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject4 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject5 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject6 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject7 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject8 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject9 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject10 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject11 = new DevExpress.Utils.SerializableAppearanceObject();
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject12 = new DevExpress.Utils.SerializableAppearanceObject();
            this.pnTitle = new System.Windows.Forms.Panel();
            this.picTitel = new System.Windows.Forms.PictureBox();
            this.lblTitel = new KiSS4.Gui.KissLabel();
            this.lblGeplantVon = new KiSS4.Gui.KissLabel();
            this.edtGeplantVon = new KiSS4.Gui.KissDateEdit();
            this.qryBgFinanzplan = new KiSS4.DB.SqlQuery(this.components);
            this.lblGeplantBis = new KiSS4.Gui.KissLabel();
            this.edtGeplantBis = new KiSS4.Gui.KissDateEdit();
            this.lblDatumVon = new KiSS4.Gui.KissLabel();
            this.edtDatumVon = new KiSS4.Gui.KissDateEdit();
            this.lblDatumBis = new KiSS4.Gui.KissLabel();
            this.edtDatumBis = new KiSS4.Gui.KissDateEdit();
            this.lblAbschluss = new KiSS4.Gui.KissLabel();
            this.edtBgGrundAbschlussCode = new KiSS4.Gui.KissLookUpEdit();
            this.lblWhHilfeTypCode = new KiSS4.Gui.KissLabel();
            this.edtWhHilfeTypCode = new KiSS4.Gui.KissLookUpEdit();
            this.lblWhGrundbedarfTypCode = new KiSS4.Gui.KissLabel();
            this.edtWhGrundbedarfTypCode = new KiSS4.Gui.KissLookUpEdit();
            this.lblZustSA = new KiSS4.Gui.KissLabel();
            this.edtLogonName = new KiSS4.Gui.KissTextEdit();
            this.groupBox1 = new KiSS4.Gui.KissGroupBox();
            this.cmdReferentin = new KiSS4.Gui.KissButton();
            this.cmdVerlauf = new KiSS4.Gui.KissButton();
            this.cmdBeenden = new KiSS4.Gui.KissButton();
            this.kissLabel6 = new KiSS4.Gui.KissLabel();
            this.cmdAntworten = new KiSS4.Gui.KissButton();
            this.cmdAnfragen = new KiSS4.Gui.KissButton();
            this.btnAufheben = new KiSS4.Gui.KissButton();
            this.kissLabel5 = new KiSS4.Gui.KissLabel();
            this.edtBgBewilligungStatusCode = new KiSS4.Gui.KissLookUpEdit();
            this.lblBgBewilligungStatusCode = new KiSS4.Gui.KissLabel();
            this.txtStatusInfo = new KiSS4.Gui.KissMemoEdit();
            this.cmdStatusRefresh = new KiSS4.Gui.KissButton();
            this.edtBgFinanzplanID = new KiSS4.Gui.KissTextEdit();
            this.lblBgFinanzplanID = new KiSS4.Gui.KissLabel();
            this.lblUnterschriftAntrag = new KiSS4.Gui.KissLabel();
            this.edtUnterschriftAntrag = new KiSS4.Gui.KissDateEdit();
            this.lblLeistungsentscheid = new KiSS4.Gui.KissLabel();
            this.qryCheck = new KiSS4.DB.SqlQuery(this.components);
            this.qryIstBewilligt = new KiSS4.DB.SqlQuery(this.components);
            this.qryTextmarken = new KiSS4.DB.SqlQuery(this.components);
            this.lblKlaerungsphase = new KiSS4.Gui.KissLabel();
            this.lblKiJuAmbulant = new KiSS4.Gui.KissLabel();
            this.lblVorlageKiJuAbulant = new KiSS4.Gui.KissLabel();
            this.lblVorlageKlaerungsphase = new KiSS4.Gui.KissLabel();
            this.lblVorlageLeistungsentscheid = new KiSS4.Gui.KissLabel();
            this.docKiJuAmbulant = new KiSS4.Dokument.XDokument();
            this.docKlaerungsphase = new KiSS4.Dokument.XDokument();
            this.docLeistungsentscheid = new KiSS4.Dokument.XDokument();
            this.qryWhGrundbedarfTyp = new KiSS4.DB.SqlQuery(this.components);
            this.pnTitle.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.picTitel)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblTitel)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblGeplantVon)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtGeplantVon.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryBgFinanzplan)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblGeplantBis)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtGeplantBis.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblDatumVon)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtDatumVon.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblDatumBis)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtDatumBis.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblAbschluss)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgGrundAbschlussCode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgGrundAbschlussCode.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblWhHilfeTypCode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtWhHilfeTypCode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtWhHilfeTypCode.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblWhGrundbedarfTypCode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtWhGrundbedarfTypCode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtWhGrundbedarfTypCode.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblZustSA)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtLogonName.Properties)).BeginInit();
            this.groupBox1.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.kissLabel6)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.kissLabel5)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgBewilligungStatusCode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgBewilligungStatusCode.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblBgBewilligungStatusCode)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.txtStatusInfo.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgFinanzplanID.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblBgFinanzplanID)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblUnterschriftAntrag)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtUnterschriftAntrag.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblLeistungsentscheid)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryCheck)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryIstBewilligt)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryTextmarken)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKlaerungsphase)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKiJuAmbulant)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblVorlageKiJuAbulant)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblVorlageKlaerungsphase)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblVorlageLeistungsentscheid)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.docKiJuAmbulant.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.docKlaerungsphase.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.docLeistungsentscheid.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryWhGrundbedarfTyp)).BeginInit();
            this.SuspendLayout();
            //
            // pnTitle
            //
            this.pnTitle.Controls.Add(this.picTitel);
            this.pnTitle.Controls.Add(this.lblTitel);
            this.pnTitle.Dock = System.Windows.Forms.DockStyle.Top;
            this.pnTitle.Location = new System.Drawing.Point(0, 0);
            this.pnTitle.Name = "pnTitle";
            this.pnTitle.Size = new System.Drawing.Size(724, 40);
            this.pnTitle.TabIndex = 0;
            //
            // picTitel
            //
            this.picTitel.Location = new System.Drawing.Point(10, 9);
            this.picTitel.Name = "picTitel";
            this.picTitel.Size = new System.Drawing.Size(25, 20);
            this.picTitel.TabIndex = 1;
            this.picTitel.TabStop = false;
            //
            // lblTitel
            //
            this.lblTitel.LabelStyle = KiSS4.Gui.LabelStyleType.TitleLabel;
            this.lblTitel.Location = new System.Drawing.Point(35, 10);
            this.lblTitel.Name = "lblTitel";
            this.lblTitel.Size = new System.Drawing.Size(500, 20);
            this.lblTitel.TabIndex = 0;
            this.lblTitel.Text = "{2}";
            this.lblTitel.UseCompatibleTextRendering = true;
            //
            // lblGeplantVon
            //
            this.lblGeplantVon.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblGeplantVon.Location = new System.Drawing.Point(12, 42);
            this.lblGeplantVon.Name = "lblGeplantVon";
            this.lblGeplantVon.Size = new System.Drawing.Size(100, 16);
            this.lblGeplantVon.TabIndex = 1;
            this.lblGeplantVon.Text = "Geplant ab";
            this.lblGeplantVon.UseCompatibleTextRendering = true;
            //
            // edtGeplantVon
            //
            this.edtGeplantVon.DataMember = "GeplantVon";
            this.edtGeplantVon.DataSource = this.qryBgFinanzplan;
            this.edtGeplantVon.EditValue = null;
            this.edtGeplantVon.Location = new System.Drawing.Point(11, 60);
            this.edtGeplantVon.Name = "edtGeplantVon";
            this.edtGeplantVon.Properties.AllowNullInput = DevExpress.Utils.DefaultBoolean.True;
            this.edtGeplantVon.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtGeplantVon.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtGeplantVon.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtGeplantVon.Properties.Appearance.Options.UseBackColor = true;
            this.edtGeplantVon.Properties.Appearance.Options.UseBorderColor = true;
            this.edtGeplantVon.Properties.Appearance.Options.UseFont = true;
            this.edtGeplantVon.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject21.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject21.Options.UseBackColor = true;
            this.edtGeplantVon.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", 8, true, true, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("edtGeplantVon.Properties.Buttons"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject21)});
            this.edtGeplantVon.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtGeplantVon.Properties.ShowToday = false;
            this.edtGeplantVon.Size = new System.Drawing.Size(100, 24);
            this.edtGeplantVon.TabIndex = 2;
            //
            // qryBgFinanzplan
            //
            this.qryBgFinanzplan.CanUpdate = true;
            this.qryBgFinanzplan.HostControl = this;
            this.qryBgFinanzplan.IsIdentityInsert = false;
            this.qryBgFinanzplan.SelectStatement = resources.GetString("qryBgFinanzplan.SelectStatement");
            this.qryBgFinanzplan.TableName = "BgFinanzplan";
            this.qryBgFinanzplan.AfterPost += new System.EventHandler(this.qryBgFinanzplan_AfterPost);
            this.qryBgFinanzplan.BeforePost += new System.EventHandler(this.qryBgFinanzplan_BeforePost);
            this.qryBgFinanzplan.PositionChanged += new System.EventHandler(this.qryBgFinanzplan_PositionChanged);
            this.qryBgFinanzplan.PostCompleted += new System.EventHandler(this.qryBgFinanzplan_PostCompleted);
            this.qryBgFinanzplan.PostError += new System.UnhandledExceptionEventHandler(this.qryBgFinanzplan_PostError);
            //
            // lblGeplantBis
            //
            this.lblGeplantBis.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblGeplantBis.Location = new System.Drawing.Point(10, 86);
            this.lblGeplantBis.Name = "lblGeplantBis";
            this.lblGeplantBis.Size = new System.Drawing.Size(100, 16);
            this.lblGeplantBis.TabIndex = 3;
            this.lblGeplantBis.Text = "Geplant bis";
            this.lblGeplantBis.UseCompatibleTextRendering = true;
            //
            // edtGeplantBis
            //
            this.edtGeplantBis.DataMember = "GeplantBis";
            this.edtGeplantBis.DataSource = this.qryBgFinanzplan;
            this.edtGeplantBis.EditValue = null;
            this.edtGeplantBis.Location = new System.Drawing.Point(11, 105);
            this.edtGeplantBis.Name = "edtGeplantBis";
            this.edtGeplantBis.Properties.AllowNullInput = DevExpress.Utils.DefaultBoolean.True;
            this.edtGeplantBis.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtGeplantBis.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtGeplantBis.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtGeplantBis.Properties.Appearance.Options.UseBackColor = true;
            this.edtGeplantBis.Properties.Appearance.Options.UseBorderColor = true;
            this.edtGeplantBis.Properties.Appearance.Options.UseFont = true;
            this.edtGeplantBis.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject20.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject20.Options.UseBackColor = true;
            this.edtGeplantBis.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", 8, true, true, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("edtGeplantBis.Properties.Buttons"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject20)});
            this.edtGeplantBis.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtGeplantBis.Properties.ShowToday = false;
            this.edtGeplantBis.Size = new System.Drawing.Size(100, 24);
            this.edtGeplantBis.TabIndex = 4;
            //
            // lblDatumVon
            //
            this.lblDatumVon.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblDatumVon.Location = new System.Drawing.Point(121, 42);
            this.lblDatumVon.Name = "lblDatumVon";
            this.lblDatumVon.Size = new System.Drawing.Size(100, 16);
            this.lblDatumVon.TabIndex = 5;
            this.lblDatumVon.Text = "Gültig ab";
            this.lblDatumVon.UseCompatibleTextRendering = true;
            //
            // edtDatumVon
            //
            this.edtDatumVon.DataMember = "DatumVon";
            this.edtDatumVon.DataSource = this.qryBgFinanzplan;
            this.edtDatumVon.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtDatumVon.EditValue = null;
            this.edtDatumVon.Location = new System.Drawing.Point(118, 60);
            this.edtDatumVon.Name = "edtDatumVon";
            this.edtDatumVon.Properties.AllowNullInput = DevExpress.Utils.DefaultBoolean.True;
            this.edtDatumVon.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtDatumVon.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtDatumVon.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtDatumVon.Properties.Appearance.Options.UseBackColor = true;
            this.edtDatumVon.Properties.Appearance.Options.UseBorderColor = true;
            this.edtDatumVon.Properties.Appearance.Options.UseFont = true;
            this.edtDatumVon.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject19.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject19.Options.UseBackColor = true;
            this.edtDatumVon.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", 8, true, true, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("edtDatumVon.Properties.Buttons"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject19)});
            this.edtDatumVon.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtDatumVon.Properties.ReadOnly = true;
            this.edtDatumVon.Properties.ShowToday = false;
            this.edtDatumVon.Size = new System.Drawing.Size(100, 24);
            this.edtDatumVon.TabIndex = 6;
            this.edtDatumVon.TabStop = false;
            //
            // lblDatumBis
            //
            this.lblDatumBis.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblDatumBis.Location = new System.Drawing.Point(121, 86);
            this.lblDatumBis.Name = "lblDatumBis";
            this.lblDatumBis.Size = new System.Drawing.Size(100, 16);
            this.lblDatumBis.TabIndex = 7;
            this.lblDatumBis.Text = "Gültig bis";
            this.lblDatumBis.UseCompatibleTextRendering = true;
            //
            // edtDatumBis
            //
            this.edtDatumBis.DataMember = "DatumBis";
            this.edtDatumBis.DataSource = this.qryBgFinanzplan;
            this.edtDatumBis.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtDatumBis.EditValue = null;
            this.edtDatumBis.Location = new System.Drawing.Point(118, 105);
            this.edtDatumBis.Name = "edtDatumBis";
            this.edtDatumBis.Properties.AllowNullInput = DevExpress.Utils.DefaultBoolean.True;
            this.edtDatumBis.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtDatumBis.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtDatumBis.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtDatumBis.Properties.Appearance.Options.UseBackColor = true;
            this.edtDatumBis.Properties.Appearance.Options.UseBorderColor = true;
            this.edtDatumBis.Properties.Appearance.Options.UseFont = true;
            this.edtDatumBis.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject18.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject18.Options.UseBackColor = true;
            this.edtDatumBis.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", 8, true, true, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("edtDatumBis.Properties.Buttons"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject18)});
            this.edtDatumBis.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtDatumBis.Properties.ReadOnly = true;
            this.edtDatumBis.Properties.ShowToday = false;
            this.edtDatumBis.Size = new System.Drawing.Size(100, 24);
            this.edtDatumBis.TabIndex = 8;
            this.edtDatumBis.TabStop = false;
            //
            // lblAbschluss
            //
            this.lblAbschluss.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblAbschluss.Location = new System.Drawing.Point(227, 86);
            this.lblAbschluss.Name = "lblAbschluss";
            this.lblAbschluss.Size = new System.Drawing.Size(148, 16);
            this.lblAbschluss.TabIndex = 9;
            this.lblAbschluss.Text = "Abschlussgrund Finanzplan";
            this.lblAbschluss.UseCompatibleTextRendering = true;
            //
            // edtBgGrundAbschlussCode
            //
            this.edtBgGrundAbschlussCode.DataMember = "BgGrundAbschlussCode";
            this.edtBgGrundAbschlussCode.DataSource = this.qryBgFinanzplan;
            this.edtBgGrundAbschlussCode.Location = new System.Drawing.Point(225, 105);
            this.edtBgGrundAbschlussCode.LOVName = "BgFPGrundAbschluss";
            this.edtBgGrundAbschlussCode.Name = "edtBgGrundAbschlussCode";
            this.edtBgGrundAbschlussCode.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtBgGrundAbschlussCode.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtBgGrundAbschlussCode.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtBgGrundAbschlussCode.Properties.Appearance.Options.UseBackColor = true;
            this.edtBgGrundAbschlussCode.Properties.Appearance.Options.UseBorderColor = true;
            this.edtBgGrundAbschlussCode.Properties.Appearance.Options.UseFont = true;
            this.edtBgGrundAbschlussCode.Properties.AppearanceDropDown.BackColor = System.Drawing.Color.BlanchedAlmond;
            this.edtBgGrundAbschlussCode.Properties.AppearanceDropDown.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.edtBgGrundAbschlussCode.Properties.AppearanceDropDown.Options.UseBackColor = true;
            this.edtBgGrundAbschlussCode.Properties.AppearanceDropDown.Options.UseFont = true;
            this.edtBgGrundAbschlussCode.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject17.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject17.Options.UseBackColor = true;
            this.edtBgGrundAbschlussCode.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, null, new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject17)});
            this.edtBgGrundAbschlussCode.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtBgGrundAbschlussCode.Properties.Columns.AddRange(new DevExpress.XtraEditors.Controls.LookUpColumnInfo[] {
            new DevExpress.XtraEditors.Controls.LookUpColumnInfo("Text", null, 75)});
            this.edtBgGrundAbschlussCode.Properties.DisplayMember = "Text";
            this.edtBgGrundAbschlussCode.Properties.DropDownRows = 1;
            this.edtBgGrundAbschlussCode.Properties.NullText = "";
            this.edtBgGrundAbschlussCode.Properties.ShowFooter = false;
            this.edtBgGrundAbschlussCode.Properties.ShowHeader = false;
            this.edtBgGrundAbschlussCode.Properties.ValueMember = "Code";
            this.edtBgGrundAbschlussCode.Size = new System.Drawing.Size(481, 24);
            this.edtBgGrundAbschlussCode.TabIndex = 10;
            //
            // lblWhHilfeTypCode
            //
            this.lblWhHilfeTypCode.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblWhHilfeTypCode.Location = new System.Drawing.Point(12, 132);
            this.lblWhHilfeTypCode.Name = "lblWhHilfeTypCode";
            this.lblWhHilfeTypCode.Size = new System.Drawing.Size(100, 16);
            this.lblWhHilfeTypCode.TabIndex = 11;
            this.lblWhHilfeTypCode.Text = "Typ";
            this.lblWhHilfeTypCode.UseCompatibleTextRendering = true;
            //
            // edtWhHilfeTypCode
            //
            this.edtWhHilfeTypCode.DataMember = "WhHilfeTypCode";
            this.edtWhHilfeTypCode.DataSource = this.qryBgFinanzplan;
            this.edtWhHilfeTypCode.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtWhHilfeTypCode.Location = new System.Drawing.Point(12, 150);
            this.edtWhHilfeTypCode.LOVName = "WhHilfeTyp";
            this.edtWhHilfeTypCode.Name = "edtWhHilfeTypCode";
            this.edtWhHilfeTypCode.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtWhHilfeTypCode.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtWhHilfeTypCode.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtWhHilfeTypCode.Properties.Appearance.Options.UseBackColor = true;
            this.edtWhHilfeTypCode.Properties.Appearance.Options.UseBorderColor = true;
            this.edtWhHilfeTypCode.Properties.Appearance.Options.UseFont = true;
            this.edtWhHilfeTypCode.Properties.AppearanceDropDown.BackColor = System.Drawing.Color.BlanchedAlmond;
            this.edtWhHilfeTypCode.Properties.AppearanceDropDown.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.edtWhHilfeTypCode.Properties.AppearanceDropDown.Options.UseBackColor = true;
            this.edtWhHilfeTypCode.Properties.AppearanceDropDown.Options.UseFont = true;
            this.edtWhHilfeTypCode.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject16.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject16.Options.UseBackColor = true;
            this.edtWhHilfeTypCode.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, null, new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject16)});
            this.edtWhHilfeTypCode.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtWhHilfeTypCode.Properties.Columns.AddRange(new DevExpress.XtraEditors.Controls.LookUpColumnInfo[] {
            new DevExpress.XtraEditors.Controls.LookUpColumnInfo("Text", null, 75)});
            this.edtWhHilfeTypCode.Properties.DisplayMember = "Text";
            this.edtWhHilfeTypCode.Properties.DropDownRows = 1;
            this.edtWhHilfeTypCode.Properties.NullText = "";
            this.edtWhHilfeTypCode.Properties.ReadOnly = true;
            this.edtWhHilfeTypCode.Properties.ShowFooter = false;
            this.edtWhHilfeTypCode.Properties.ShowHeader = false;
            this.edtWhHilfeTypCode.Properties.ValueMember = "Code";
            this.edtWhHilfeTypCode.Size = new System.Drawing.Size(206, 24);
            this.edtWhHilfeTypCode.TabIndex = 12;
            this.edtWhHilfeTypCode.TabStop = false;
            //
            // lblWhGrundbedarfTypCode
            //
            this.lblWhGrundbedarfTypCode.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblWhGrundbedarfTypCode.Location = new System.Drawing.Point(225, 132);
            this.lblWhGrundbedarfTypCode.Name = "lblWhGrundbedarfTypCode";
            this.lblWhGrundbedarfTypCode.Size = new System.Drawing.Size(128, 16);
            this.lblWhGrundbedarfTypCode.TabIndex = 13;
            this.lblWhGrundbedarfTypCode.Text = "Berechnungsgrundlage";
            this.lblWhGrundbedarfTypCode.UseCompatibleTextRendering = true;
            //
            // edtWhGrundbedarfTypCode
            //
            this.edtWhGrundbedarfTypCode.AllowNull = false;
            this.edtWhGrundbedarfTypCode.DataMember = "WhGrundbedarfTypCode";
            this.edtWhGrundbedarfTypCode.DataSource = this.qryBgFinanzplan;
            this.edtWhGrundbedarfTypCode.Location = new System.Drawing.Point(225, 150);
            this.edtWhGrundbedarfTypCode.Name = "edtWhGrundbedarfTypCode";
            this.edtWhGrundbedarfTypCode.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtWhGrundbedarfTypCode.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtWhGrundbedarfTypCode.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtWhGrundbedarfTypCode.Properties.Appearance.Options.UseBackColor = true;
            this.edtWhGrundbedarfTypCode.Properties.Appearance.Options.UseBorderColor = true;
            this.edtWhGrundbedarfTypCode.Properties.Appearance.Options.UseFont = true;
            this.edtWhGrundbedarfTypCode.Properties.AppearanceDropDown.BackColor = System.Drawing.Color.BlanchedAlmond;
            this.edtWhGrundbedarfTypCode.Properties.AppearanceDropDown.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.edtWhGrundbedarfTypCode.Properties.AppearanceDropDown.Options.UseBackColor = true;
            this.edtWhGrundbedarfTypCode.Properties.AppearanceDropDown.Options.UseFont = true;
            this.edtWhGrundbedarfTypCode.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject15.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject15.Options.UseBackColor = true;
            this.edtWhGrundbedarfTypCode.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, null, new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject15)});
            this.edtWhGrundbedarfTypCode.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtWhGrundbedarfTypCode.Properties.NullText = "";
            this.edtWhGrundbedarfTypCode.Properties.ShowFooter = false;
            this.edtWhGrundbedarfTypCode.Properties.ShowHeader = false;
            this.edtWhGrundbedarfTypCode.Size = new System.Drawing.Size(481, 24);
            this.edtWhGrundbedarfTypCode.TabIndex = 14;
            //
            // lblZustSA
            //
            this.lblZustSA.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblZustSA.Location = new System.Drawing.Point(12, 177);
            this.lblZustSA.Name = "lblZustSA";
            this.lblZustSA.Size = new System.Drawing.Size(100, 16);
            this.lblZustSA.TabIndex = 15;
            this.lblZustSA.Text = "zuständige/r SA";
            this.lblZustSA.UseCompatibleTextRendering = true;
            //
            // edtLogonName
            //
            this.edtLogonName.DataMember = "LogonName";
            this.edtLogonName.DataSource = this.qryBgFinanzplan;
            this.edtLogonName.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtLogonName.Location = new System.Drawing.Point(12, 195);
            this.edtLogonName.Name = "edtLogonName";
            this.edtLogonName.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtLogonName.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtLogonName.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtLogonName.Properties.Appearance.Options.UseBackColor = true;
            this.edtLogonName.Properties.Appearance.Options.UseBorderColor = true;
            this.edtLogonName.Properties.Appearance.Options.UseFont = true;
            this.edtLogonName.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtLogonName.Properties.ReadOnly = true;
            this.edtLogonName.Size = new System.Drawing.Size(100, 24);
            this.edtLogonName.TabIndex = 16;
            //
            // groupBox1
            //
            this.groupBox1.Anchor = ((System.Windows.Forms.AnchorStyles)(((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Bottom)
            | System.Windows.Forms.AnchorStyles.Left)));
            this.groupBox1.Controls.Add(this.cmdReferentin);
            this.groupBox1.Controls.Add(this.cmdVerlauf);
            this.groupBox1.Controls.Add(this.cmdBeenden);
            this.groupBox1.Controls.Add(this.kissLabel6);
            this.groupBox1.Controls.Add(this.cmdAntworten);
            this.groupBox1.Controls.Add(this.cmdAnfragen);
            this.groupBox1.Controls.Add(this.btnAufheben);
            this.groupBox1.Controls.Add(this.kissLabel5);
            this.groupBox1.Controls.Add(this.edtBgBewilligungStatusCode);
            this.groupBox1.Controls.Add(this.lblBgBewilligungStatusCode);
            this.groupBox1.Controls.Add(this.txtStatusInfo);
            this.groupBox1.Controls.Add(this.cmdStatusRefresh);
            this.groupBox1.Controls.Add(this.edtBgFinanzplanID);
            this.groupBox1.Controls.Add(this.lblBgFinanzplanID);
            this.groupBox1.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.groupBox1.Location = new System.Drawing.Point(10, 269);
            this.groupBox1.Name = "groupBox1";
            this.groupBox1.Size = new System.Drawing.Size(705, 265);
            this.groupBox1.TabIndex = 17;
            this.groupBox1.TabStop = false;
            this.groupBox1.Text = "Statusinformationen";
            this.groupBox1.UseCompatibleTextRendering = true;
            //
            // cmdReferentin
            //
            this.cmdReferentin.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.cmdReferentin.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.cmdReferentin.Location = new System.Drawing.Point(576, 235);
            this.cmdReferentin.Name = "cmdReferentin";
            this.cmdReferentin.Size = new System.Drawing.Size(120, 24);
            this.cmdReferentin.TabIndex = 12;
            this.cmdReferentin.Text = "Referent/in";
            this.cmdReferentin.UseCompatibleTextRendering = true;
            this.cmdReferentin.UseVisualStyleBackColor = false;
            this.cmdReferentin.Click += new System.EventHandler(this.cmdReferentin_Click);
            //
            // cmdVerlauf
            //
            this.cmdVerlauf.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.cmdVerlauf.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.cmdVerlauf.Location = new System.Drawing.Point(421, 235);
            this.cmdVerlauf.Name = "cmdVerlauf";
            this.cmdVerlauf.Size = new System.Drawing.Size(88, 24);
            this.cmdVerlauf.TabIndex = 11;
            this.cmdVerlauf.Text = "Verlauf...";
            this.cmdVerlauf.UseCompatibleTextRendering = true;
            this.cmdVerlauf.UseVisualStyleBackColor = false;
            this.cmdVerlauf.Click += new System.EventHandler(this.cmdVerlauf_Click);
            //
            // cmdBeenden
            //
            this.cmdBeenden.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.cmdBeenden.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.cmdBeenden.Location = new System.Drawing.Point(327, 235);
            this.cmdBeenden.Name = "cmdBeenden";
            this.cmdBeenden.Size = new System.Drawing.Size(88, 24);
            this.cmdBeenden.TabIndex = 10;
            this.cmdBeenden.Text = "Beenden...";
            this.cmdBeenden.UseCompatibleTextRendering = true;
            this.cmdBeenden.UseVisualStyleBackColor = false;
            this.cmdBeenden.Click += new System.EventHandler(this.cmdBeenden_Click);
            //
            // kissLabel6
            //
            this.kissLabel6.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.kissLabel6.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.kissLabel6.Location = new System.Drawing.Point(389, 219);
            this.kissLabel6.Name = "kissLabel6";
            this.kissLabel6.Size = new System.Drawing.Size(64, 16);
            this.kissLabel6.TabIndex = 9;
            this.kissLabel6.Text = "Finanzplan";
            this.kissLabel6.UseCompatibleTextRendering = true;
            //
            // cmdAntworten
            //
            this.cmdAntworten.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.cmdAntworten.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.cmdAntworten.Location = new System.Drawing.Point(208, 235);
            this.cmdAntworten.Name = "cmdAntworten";
            this.cmdAntworten.Size = new System.Drawing.Size(88, 24);
            this.cmdAntworten.TabIndex = 9;
            this.cmdAntworten.Text = "Antworten...";
            this.cmdAntworten.UseCompatibleTextRendering = true;
            this.cmdAntworten.UseVisualStyleBackColor = false;
            this.cmdAntworten.Click += new System.EventHandler(this.cmdAntworten_Click);
            //
            // cmdAnfragen
            //
            this.cmdAnfragen.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.cmdAnfragen.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.cmdAnfragen.Location = new System.Drawing.Point(112, 235);
            this.cmdAnfragen.Name = "cmdAnfragen";
            this.cmdAnfragen.Size = new System.Drawing.Size(88, 24);
            this.cmdAnfragen.TabIndex = 8;
            this.cmdAnfragen.Text = "Anfragen...";
            this.cmdAnfragen.UseCompatibleTextRendering = true;
            this.cmdAnfragen.UseVisualStyleBackColor = false;
            this.cmdAnfragen.Click += new System.EventHandler(this.cmdAnfragen_Click);
            //
            // btnAufheben
            //
            this.btnAufheben.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.btnAufheben.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.btnAufheben.Location = new System.Drawing.Point(16, 235);
            this.btnAufheben.Name = "btnAufheben";
            this.btnAufheben.Size = new System.Drawing.Size(88, 24);
            this.btnAufheben.TabIndex = 7;
            this.btnAufheben.Text = "Aufheben";
            this.btnAufheben.UseCompatibleTextRendering = true;
            this.btnAufheben.UseVisualStyleBackColor = false;
            this.btnAufheben.Click += new System.EventHandler(this.btnAufheben_Click);
            //
            // kissLabel5
            //
            this.kissLabel5.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.kissLabel5.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.kissLabel5.Location = new System.Drawing.Point(175, 219);
            this.kissLabel5.Name = "kissLabel5";
            this.kissLabel5.Size = new System.Drawing.Size(64, 16);
            this.kissLabel5.TabIndex = 6;
            this.kissLabel5.Text = "Bewilligung";
            this.kissLabel5.UseCompatibleTextRendering = true;
            //
            // edtBgBewilligungStatusCode
            //
            this.edtBgBewilligungStatusCode.AllowNull = false;
            this.edtBgBewilligungStatusCode.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.edtBgBewilligungStatusCode.DataMember = "BgBewilligungStatusCode";
            this.edtBgBewilligungStatusCode.DataSource = this.qryBgFinanzplan;
            this.edtBgBewilligungStatusCode.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtBgBewilligungStatusCode.Location = new System.Drawing.Point(112, 193);
            this.edtBgBewilligungStatusCode.LOVName = "BgBewilligungStatus";
            this.edtBgBewilligungStatusCode.Name = "edtBgBewilligungStatusCode";
            this.edtBgBewilligungStatusCode.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtBgBewilligungStatusCode.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtBgBewilligungStatusCode.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtBgBewilligungStatusCode.Properties.Appearance.Options.UseBackColor = true;
            this.edtBgBewilligungStatusCode.Properties.Appearance.Options.UseBorderColor = true;
            this.edtBgBewilligungStatusCode.Properties.Appearance.Options.UseFont = true;
            this.edtBgBewilligungStatusCode.Properties.AppearanceDropDown.BackColor = System.Drawing.Color.BlanchedAlmond;
            this.edtBgBewilligungStatusCode.Properties.AppearanceDropDown.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.edtBgBewilligungStatusCode.Properties.AppearanceDropDown.Options.UseBackColor = true;
            this.edtBgBewilligungStatusCode.Properties.AppearanceDropDown.Options.UseFont = true;
            this.edtBgBewilligungStatusCode.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject14.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject14.Options.UseBackColor = true;
            this.edtBgBewilligungStatusCode.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Combo, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, null, new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject14)});
            this.edtBgBewilligungStatusCode.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtBgBewilligungStatusCode.Properties.Columns.AddRange(new DevExpress.XtraEditors.Controls.LookUpColumnInfo[] {
            new DevExpress.XtraEditors.Controls.LookUpColumnInfo("Text", null, 75)});
            this.edtBgBewilligungStatusCode.Properties.DisplayMember = "Text";
            this.edtBgBewilligungStatusCode.Properties.DropDownRows = 1;
            this.edtBgBewilligungStatusCode.Properties.NullText = "";
            this.edtBgBewilligungStatusCode.Properties.ReadOnly = true;
            this.edtBgBewilligungStatusCode.Properties.ShowFooter = false;
            this.edtBgBewilligungStatusCode.Properties.ShowHeader = false;
            this.edtBgBewilligungStatusCode.Properties.ValueMember = "Code";
            this.edtBgBewilligungStatusCode.Size = new System.Drawing.Size(584, 24);
            this.edtBgBewilligungStatusCode.TabIndex = 5;
            this.edtBgBewilligungStatusCode.TabStop = false;
            //
            // lblBgBewilligungStatusCode
            //
            this.lblBgBewilligungStatusCode.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Bottom | System.Windows.Forms.AnchorStyles.Left)));
            this.lblBgBewilligungStatusCode.Location = new System.Drawing.Point(8, 193);
            this.lblBgBewilligungStatusCode.Name = "lblBgBewilligungStatusCode";
            this.lblBgBewilligungStatusCode.Size = new System.Drawing.Size(100, 24);
            this.lblBgBewilligungStatusCode.TabIndex = 4;
            this.lblBgBewilligungStatusCode.Text = "Status";
            this.lblBgBewilligungStatusCode.UseCompatibleTextRendering = true;
            //
            // txtStatusInfo
            //
            this.txtStatusInfo.Anchor = ((System.Windows.Forms.AnchorStyles)((((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Bottom)
            | System.Windows.Forms.AnchorStyles.Left)
            | System.Windows.Forms.AnchorStyles.Right)));
            this.txtStatusInfo.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.txtStatusInfo.Location = new System.Drawing.Point(112, 21);
            this.txtStatusInfo.Name = "txtStatusInfo";
            this.txtStatusInfo.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.txtStatusInfo.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.txtStatusInfo.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.txtStatusInfo.Properties.Appearance.Options.UseBackColor = true;
            this.txtStatusInfo.Properties.Appearance.Options.UseBorderColor = true;
            this.txtStatusInfo.Properties.Appearance.Options.UseFont = true;
            this.txtStatusInfo.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.txtStatusInfo.Properties.ReadOnly = true;
            this.txtStatusInfo.Size = new System.Drawing.Size(584, 173);
            this.txtStatusInfo.TabIndex = 3;
            this.txtStatusInfo.TabStop = false;
            //
            // cmdStatusRefresh
            //
            this.cmdStatusRefresh.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
            this.cmdStatusRefresh.Location = new System.Drawing.Point(8, 63);
            this.cmdStatusRefresh.Name = "cmdStatusRefresh";
            this.cmdStatusRefresh.Size = new System.Drawing.Size(88, 24);
            this.cmdStatusRefresh.TabIndex = 2;
            this.cmdStatusRefresh.Text = "Aktualisieren";
            this.cmdStatusRefresh.UseCompatibleTextRendering = true;
            this.cmdStatusRefresh.UseVisualStyleBackColor = false;
            this.cmdStatusRefresh.Click += new System.EventHandler(this.cmdStatusRefresh_Click);
            //
            // edtBgFinanzplanID
            //
            this.edtBgFinanzplanID.DataMember = "BgFinanzplanID";
            this.edtBgFinanzplanID.DataSource = this.qryBgFinanzplan;
            this.edtBgFinanzplanID.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtBgFinanzplanID.Location = new System.Drawing.Point(8, 35);
            this.edtBgFinanzplanID.Name = "edtBgFinanzplanID";
            this.edtBgFinanzplanID.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtBgFinanzplanID.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtBgFinanzplanID.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtBgFinanzplanID.Properties.Appearance.Options.UseBackColor = true;
            this.edtBgFinanzplanID.Properties.Appearance.Options.UseBorderColor = true;
            this.edtBgFinanzplanID.Properties.Appearance.Options.UseFont = true;
            this.edtBgFinanzplanID.Properties.Appearance.Options.UseTextOptions = true;
            this.edtBgFinanzplanID.Properties.Appearance.TextOptions.HAlignment = DevExpress.Utils.HorzAlignment.Center;
            this.edtBgFinanzplanID.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtBgFinanzplanID.Properties.ReadOnly = true;
            this.edtBgFinanzplanID.Size = new System.Drawing.Size(88, 24);
            this.edtBgFinanzplanID.TabIndex = 1;
            this.edtBgFinanzplanID.TabStop = false;
            //
            // lblBgFinanzplanID
            //
            this.lblBgFinanzplanID.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblBgFinanzplanID.Location = new System.Drawing.Point(8, 19);
            this.lblBgFinanzplanID.Name = "lblBgFinanzplanID";
            this.lblBgFinanzplanID.Size = new System.Drawing.Size(80, 16);
            this.lblBgFinanzplanID.TabIndex = 0;
            this.lblBgFinanzplanID.Text = "Finanzplan-ID";
            this.lblBgFinanzplanID.UseCompatibleTextRendering = true;
            //
            // lblUnterschriftAntrag
            //
            this.lblUnterschriftAntrag.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblUnterschriftAntrag.Location = new System.Drawing.Point(225, 42);
            this.lblUnterschriftAntrag.Name = "lblUnterschriftAntrag";
            this.lblUnterschriftAntrag.Size = new System.Drawing.Size(100, 16);
            this.lblUnterschriftAntrag.TabIndex = 18;
            this.lblUnterschriftAntrag.Text = "Unterschrift Antrag";
            this.lblUnterschriftAntrag.UseCompatibleTextRendering = true;
            //
            // edtUnterschriftAntrag
            //
            this.edtUnterschriftAntrag.DataMember = "UnterschriftAntrag";
            this.edtUnterschriftAntrag.DataSource = this.qryBgFinanzplan;
            this.edtUnterschriftAntrag.EditValue = null;
            this.edtUnterschriftAntrag.Location = new System.Drawing.Point(225, 60);
            this.edtUnterschriftAntrag.Name = "edtUnterschriftAntrag";
            this.edtUnterschriftAntrag.Properties.AllowNullInput = DevExpress.Utils.DefaultBoolean.True;
            this.edtUnterschriftAntrag.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtUnterschriftAntrag.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtUnterschriftAntrag.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtUnterschriftAntrag.Properties.Appearance.Options.UseBackColor = true;
            this.edtUnterschriftAntrag.Properties.Appearance.Options.UseBorderColor = true;
            this.edtUnterschriftAntrag.Properties.Appearance.Options.UseFont = true;
            this.edtUnterschriftAntrag.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject13.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject13.Options.UseBackColor = true;
            this.edtUnterschriftAntrag.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", 8, true, true, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("edtUnterschriftAntrag.Properties.Buttons"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject13)});
            this.edtUnterschriftAntrag.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtUnterschriftAntrag.Properties.ShowToday = false;
            this.edtUnterschriftAntrag.Size = new System.Drawing.Size(100, 24);
            this.edtUnterschriftAntrag.TabIndex = 19;
            this.edtUnterschriftAntrag.TabStop = false;
            //
            // lblLeistungsentscheid
            //
            this.lblLeistungsentscheid.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblLeistungsentscheid.Location = new System.Drawing.Point(586, 178);
            this.lblLeistungsentscheid.Name = "lblLeistungsentscheid";
            this.lblLeistungsentscheid.Size = new System.Drawing.Size(120, 16);
            this.lblLeistungsentscheid.TabIndex = 36;
            this.lblLeistungsentscheid.Text = "Leistungsentscheid";
            this.lblLeistungsentscheid.UseCompatibleTextRendering = true;
            //
            // qryCheck
            //
            this.qryCheck.HostControl = this;
            this.qryCheck.IsIdentityInsert = false;
            this.qryCheck.SelectStatement = "EXECUTE spWhFinanzPlan_Check {0}, {1}";
            this.qryCheck.AfterFill += new System.EventHandler(this.qryCheck_AfterFill);
            //
            // qryIstBewilligt
            //
            this.qryIstBewilligt.HostControl = this;
            this.qryIstBewilligt.IsIdentityInsert = false;
            this.qryIstBewilligt.SelectStatement = resources.GetString("qryIstBewilligt.SelectStatement");
            //
            // qryTextmarken
            //
            this.qryTextmarken.HostControl = this;
            this.qryTextmarken.IsIdentityInsert = false;
            this.qryTextmarken.SelectStatement = resources.GetString("qryTextmarken.SelectStatement");
            //
            // lblKlaerungsphase
            //
            this.lblKlaerungsphase.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblKlaerungsphase.Location = new System.Drawing.Point(405, 176);
            this.lblKlaerungsphase.Name = "lblKlaerungsphase";
            this.lblKlaerungsphase.Size = new System.Drawing.Size(120, 16);
            this.lblKlaerungsphase.TabIndex = 38;
            this.lblKlaerungsphase.Text = "Klärungsphase";
            this.lblKlaerungsphase.UseCompatibleTextRendering = true;
            //
            // lblKiJuAmbulant
            //
            this.lblKiJuAmbulant.LabelStyle = KiSS4.Gui.LabelStyleType.DataViewLabel;
            this.lblKiJuAmbulant.Location = new System.Drawing.Point(225, 178);
            this.lblKiJuAmbulant.Name = "lblKiJuAmbulant";
            this.lblKiJuAmbulant.Size = new System.Drawing.Size(118, 16);
            this.lblKiJuAmbulant.TabIndex = 40;
            this.lblKiJuAmbulant.Text = "Ki/Ju amb./stationär";
            this.lblKiJuAmbulant.UseCompatibleTextRendering = true;
            //
            // lblVorlageKiJuAbulant
            //
            this.lblVorlageKiJuAbulant.Font = new System.Drawing.Font("Arial", 11F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.lblVorlageKiJuAbulant.LabelStyle = KiSS4.Gui.LabelStyleType.Custom;
            this.lblVorlageKiJuAbulant.Location = new System.Drawing.Point(225, 223);
            this.lblVorlageKiJuAbulant.Name = "lblVorlageKiJuAbulant";
            this.lblVorlageKiJuAbulant.Size = new System.Drawing.Size(120, 44);
            this.lblVorlageKiJuAbulant.TabIndex = 41;
            this.lblVorlageKiJuAbulant.Text = "Placeholder";
            this.lblVorlageKiJuAbulant.UseCompatibleTextRendering = true;
            //
            // lblVorlageKlaerungsphase
            //
            this.lblVorlageKlaerungsphase.Font = new System.Drawing.Font("Arial", 11F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.lblVorlageKlaerungsphase.LabelStyle = KiSS4.Gui.LabelStyleType.Custom;
            this.lblVorlageKlaerungsphase.Location = new System.Drawing.Point(405, 222);
            this.lblVorlageKlaerungsphase.Name = "lblVorlageKlaerungsphase";
            this.lblVorlageKlaerungsphase.Size = new System.Drawing.Size(120, 44);
            this.lblVorlageKlaerungsphase.TabIndex = 42;
            this.lblVorlageKlaerungsphase.Text = "Placeholder";
            this.lblVorlageKlaerungsphase.UseCompatibleTextRendering = true;
            //
            // lblVorlageLeistungsentscheid
            //
            this.lblVorlageLeistungsentscheid.Font = new System.Drawing.Font("Arial", 11F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.lblVorlageLeistungsentscheid.LabelStyle = KiSS4.Gui.LabelStyleType.Custom;
            this.lblVorlageLeistungsentscheid.Location = new System.Drawing.Point(586, 223);
            this.lblVorlageLeistungsentscheid.Name = "lblVorlageLeistungsentscheid";
            this.lblVorlageLeistungsentscheid.Size = new System.Drawing.Size(120, 44);
            this.lblVorlageLeistungsentscheid.TabIndex = 43;
            this.lblVorlageLeistungsentscheid.Text = "Placeholder";
            this.lblVorlageLeistungsentscheid.UseCompatibleTextRendering = true;
            //
            // docKiJuAmbulant
            //
            this.docKiJuAmbulant.AllowDrop = false;
            this.docKiJuAmbulant.CanImportDocument = false;
            this.docKiJuAmbulant.Context = "WhFinanzplanKiJu";
            this.docKiJuAmbulant.DataMember = "XDocumentID_KiJuAmbulant";
            this.docKiJuAmbulant.DataSource = this.qryBgFinanzplan;
            this.docKiJuAmbulant.Location = new System.Drawing.Point(225, 196);
            this.docKiJuAmbulant.Name = "docKiJuAmbulant";
            this.docKiJuAmbulant.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.docKiJuAmbulant.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.docKiJuAmbulant.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.docKiJuAmbulant.Properties.Appearance.Options.UseBackColor = true;
            this.docKiJuAmbulant.Properties.Appearance.Options.UseBorderColor = true;
            this.docKiJuAmbulant.Properties.Appearance.Options.UseFont = true;
            this.docKiJuAmbulant.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject1.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject1.Options.UseBackColor = true;
            serializableAppearanceObject2.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject2.Options.UseBackColor = true;
            serializableAppearanceObject3.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject3.Options.UseBackColor = true;
            serializableAppearanceObject4.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject4.Options.UseBackColor = true;
            this.docKiJuAmbulant.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docKiJuAmbulant.Properties.Buttons"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject1, "Dokument öffnen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docKiJuAmbulant.Properties.Buttons1"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject2, "Dokument löschen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docKiJuAmbulant.Properties.Buttons2"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject3, "Neues Dokument erstellen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docKiJuAmbulant.Properties.Buttons3"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject4, "Dokument importieren")});
            this.docKiJuAmbulant.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.docKiJuAmbulant.Properties.ReadOnly = true;
            this.docKiJuAmbulant.SearchStringWhitelist = new string[] {
        ".",
        "*",
        "%"};
            this.docKiJuAmbulant.Size = new System.Drawing.Size(120, 24);
            this.docKiJuAmbulant.TabIndex = 39;
            //
            // docKlaerungsphase
            //
            this.docKlaerungsphase.AllowDrop = false;
            this.docKlaerungsphase.CanImportDocument = false;
            this.docKlaerungsphase.Context = "WhFinanzplanKlaerungsphase";
            this.docKlaerungsphase.DataMember = "XDocumentID_Klaerungsphase";
            this.docKlaerungsphase.DataSource = this.qryBgFinanzplan;
            this.docKlaerungsphase.Location = new System.Drawing.Point(405, 195);
            this.docKlaerungsphase.Name = "docKlaerungsphase";
            this.docKlaerungsphase.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.docKlaerungsphase.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.docKlaerungsphase.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.docKlaerungsphase.Properties.Appearance.Options.UseBackColor = true;
            this.docKlaerungsphase.Properties.Appearance.Options.UseBorderColor = true;
            this.docKlaerungsphase.Properties.Appearance.Options.UseFont = true;
            this.docKlaerungsphase.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject5.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject5.Options.UseBackColor = true;
            serializableAppearanceObject6.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject6.Options.UseBackColor = true;
            serializableAppearanceObject7.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject7.Options.UseBackColor = true;
            serializableAppearanceObject8.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject8.Options.UseBackColor = true;
            this.docKlaerungsphase.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docKlaerungsphase.Properties.Buttons"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject5, "Dokument öffnen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docKlaerungsphase.Properties.Buttons1"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject6, "Dokument löschen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docKlaerungsphase.Properties.Buttons2"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject7, "Neues Dokument erstellen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docKlaerungsphase.Properties.Buttons3"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject8, "Dokument importieren")});
            this.docKlaerungsphase.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.docKlaerungsphase.Properties.ReadOnly = true;
            this.docKlaerungsphase.SearchStringWhitelist = new string[] {
        ".",
        "*",
        "%"};
            this.docKlaerungsphase.Size = new System.Drawing.Size(120, 24);
            this.docKlaerungsphase.TabIndex = 37;
            this.docKlaerungsphase.DocumentCreated += new System.EventHandler(this.docKlaerungsphase_DocumentCreated);
            this.docKlaerungsphase.DocumentDeleted += new System.EventHandler(this.docKlaerungsphase_DocumentDeleted);
            //
            // docLeistungsentscheid
            //
            this.docLeistungsentscheid.AllowDrop = false;
            this.docLeistungsentscheid.CanImportDocument = false;
            this.docLeistungsentscheid.Context = "WhFinanzplanLeistungsentscheid";
            this.docLeistungsentscheid.DataMember = "XDocumentID_Leistungsentscheid";
            this.docLeistungsentscheid.DataSource = this.qryBgFinanzplan;
            this.docLeistungsentscheid.Location = new System.Drawing.Point(586, 195);
            this.docLeistungsentscheid.Name = "docLeistungsentscheid";
            this.docLeistungsentscheid.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.docLeistungsentscheid.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.docLeistungsentscheid.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.docLeistungsentscheid.Properties.Appearance.Options.UseBackColor = true;
            this.docLeistungsentscheid.Properties.Appearance.Options.UseBorderColor = true;
            this.docLeistungsentscheid.Properties.Appearance.Options.UseFont = true;
            this.docLeistungsentscheid.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject9.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject9.Options.UseBackColor = true;
            serializableAppearanceObject10.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject10.Options.UseBackColor = true;
            serializableAppearanceObject11.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject11.Options.UseBackColor = true;
            serializableAppearanceObject12.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject12.Options.UseBackColor = true;
            this.docLeistungsentscheid.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docLeistungsentscheid.Properties.Buttons"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject9, "Dokument öffnen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docLeistungsentscheid.Properties.Buttons1"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject10, "Dokument löschen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docLeistungsentscheid.Properties.Buttons2"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject11, "Neues Dokument erstellen"),
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph, "", -1, true, false, false, DevExpress.Utils.HorzAlignment.Center, ((System.Drawing.Image)(resources.GetObject("docLeistungsentscheid.Properties.Buttons3"))), new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject12, "Dokument importieren")});
            this.docLeistungsentscheid.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.docLeistungsentscheid.Properties.ReadOnly = true;
            this.docLeistungsentscheid.SearchStringWhitelist = new string[] {
        ".",
        "*",
        "%"};
            this.docLeistungsentscheid.Size = new System.Drawing.Size(120, 24);
            this.docLeistungsentscheid.TabIndex = 35;
            this.docLeistungsentscheid.DocumentCreated += new System.EventHandler(this.docLeistungsentscheid_DocumentCreated);
            this.docLeistungsentscheid.DocumentDeleted += new System.EventHandler(this.docLeistungsentscheid_DocumentDeleted);
            //
            // qryWhGrundbedarfTyp
            //
            this.qryWhGrundbedarfTyp.HostControl = this;
            this.qryWhGrundbedarfTyp.IsIdentityInsert = false;
            this.qryWhGrundbedarfTyp.SelectStatement = resources.GetString("qryWhGrundbedarfTyp.SelectStatement");
            //
            // CtlWhFinanzplan
            //
            this.ActiveSQLQuery = this.qryBgFinanzplan;
            this.Controls.Add(this.lblVorlageLeistungsentscheid);
            this.Controls.Add(this.lblVorlageKlaerungsphase);
            this.Controls.Add(this.lblVorlageKiJuAbulant);
            this.Controls.Add(this.docKiJuAmbulant);
            this.Controls.Add(this.lblKiJuAmbulant);
            this.Controls.Add(this.lblKlaerungsphase);
            this.Controls.Add(this.docKlaerungsphase);
            this.Controls.Add(this.lblLeistungsentscheid);
            this.Controls.Add(this.docLeistungsentscheid);
            this.Controls.Add(this.edtUnterschriftAntrag);
            this.Controls.Add(this.lblUnterschriftAntrag);
            this.Controls.Add(this.groupBox1);
            this.Controls.Add(this.edtLogonName);
            this.Controls.Add(this.lblZustSA);
            this.Controls.Add(this.edtWhGrundbedarfTypCode);
            this.Controls.Add(this.lblWhGrundbedarfTypCode);
            this.Controls.Add(this.edtWhHilfeTypCode);
            this.Controls.Add(this.lblWhHilfeTypCode);
            this.Controls.Add(this.edtBgGrundAbschlussCode);
            this.Controls.Add(this.lblAbschluss);
            this.Controls.Add(this.edtDatumBis);
            this.Controls.Add(this.lblDatumBis);
            this.Controls.Add(this.edtDatumVon);
            this.Controls.Add(this.lblDatumVon);
            this.Controls.Add(this.edtGeplantBis);
            this.Controls.Add(this.lblGeplantBis);
            this.Controls.Add(this.edtGeplantVon);
            this.Controls.Add(this.lblGeplantVon);
            this.Controls.Add(this.pnTitle);
            this.Name = "CtlWhFinanzplan";
            this.Size = new System.Drawing.Size(724, 552);
            this.pnTitle.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.picTitel)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblTitel)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblGeplantVon)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtGeplantVon.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryBgFinanzplan)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblGeplantBis)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtGeplantBis.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblDatumVon)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtDatumVon.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblDatumBis)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtDatumBis.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblAbschluss)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgGrundAbschlussCode.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgGrundAbschlussCode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblWhHilfeTypCode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtWhHilfeTypCode.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtWhHilfeTypCode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblWhGrundbedarfTypCode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtWhGrundbedarfTypCode.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtWhGrundbedarfTypCode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblZustSA)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtLogonName.Properties)).EndInit();
            this.groupBox1.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.kissLabel6)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.kissLabel5)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgBewilligungStatusCode.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgBewilligungStatusCode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblBgBewilligungStatusCode)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.txtStatusInfo.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBgFinanzplanID.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblBgFinanzplanID)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblUnterschriftAntrag)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtUnterschriftAntrag.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblLeistungsentscheid)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryCheck)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryIstBewilligt)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryTextmarken)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKlaerungsphase)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblKiJuAmbulant)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblVorlageKiJuAbulant)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblVorlageKlaerungsphase)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.lblVorlageLeistungsentscheid)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.docKiJuAmbulant.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.docKlaerungsphase.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.docLeistungsentscheid.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryWhGrundbedarfTyp)).EndInit();
            this.ResumeLayout(false);
        }

        #endregion

        #region Dispose

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                if ((components != null))
                {
                    components.Dispose();
                }
            }
            base.Dispose(disposing);
        }

        #endregion

        #region Public Methods

        public override string GetContextName()
        {
            string WhGrundbedarfTyp = DBUtil.ExecuteScalarSQL(@"
                SELECT IsNull(',%' + XLC.ShortText, '')
                FROM BgBudget            BBG
                  INNER JOIN BgPosition  BPO ON BPO.BgBudgetID = BBG.BgBudgetID
                  INNER JOIN XLOVCode    XLC ON XLC.LOVName = 'WhGrundbedarfTyp' AND XLC.Code = BPO.BgPositionsartID
                WHERE BBG.BgFinanzplanID = {0} AND BBG.MasterBudget = 1"
                , this.qryBgFinanzplan["BgFinanzplanID"]) as string;

            return "BgFinanzplan" + WhGrundbedarfTyp;
        }

        public override object GetContextValue(string FieldName)
        {
            switch (FieldName.ToUpper())
            {
                case "BGFINANZPLANID":
                    return this.qryBgFinanzplan["BgFinanzplanID"];

                case "FAFALLID":
                    return this.qryBgFinanzplan["FaFallID$"];

                case "ABSENDER":
                    return this.qryBgFinanzplan["UserID$"];

                case "FALLUSERID":
                    return this.qryBgFinanzplan["UserID$"];
            }

            //KissMsg.ShowInfo("Feldname = " + FieldName);

            return base.GetContextValue(FieldName);
        }

        public override void OnRefreshData()
        {
            base.OnRefreshData();
            FormController.SendMessage("FrmFall", "Action", "RefreshTree");
        }

        #endregion

        #region Private Methods

        private void btnAufheben_Click(object sender, System.EventArgs e)
        {
            if (KissMsg.ShowQuestion("Soll die Bewilligung für diesen Finanzplan aufgehoben werden?"))
            {
                Cursor = Cursors.WaitCursor;
                ApplicationFacade.DoEvents();

                try
                {
                    DBUtil.ThrowExceptionOnOpenTransaction();
                    DBUtil.ExecSQLThrowingException(@"
                        exec spWhFinanzplan_BewilligungReset {0},{1}",
                        this.BgFinanzplanID,
                        Session.User.UserID);
                }
                catch (Exception ex)
                {
                    KissMsg.ShowInfo(ex.Message);
                    Cursor = Cursors.Default;
                    return;
                }

                InsertFVProtokoll_Aufheben();
                qryBgFinanzplan.Refresh();
                FormController.SendMessage("FrmFall", "Action", "RefreshTree");
                Cursor = Cursors.Default;

                // XDocument Modus setzen
                SetXDocumentMode();
            }
        }

        private void cmdAnfragen_Click(object sender, System.EventArgs e)
        {
            this.qryBgFinanzplan.RowModified = true;
            if (this.qryBgFinanzplan.Post())
            {
                this.qryCheck.Refresh();

                if (this.qryCheck.DataTable.Select("Typ = 0").Length > 0)
                {
                    KissMsg.ShowInfo("CtlWhFinanzplan", "FinanzplanUnvollstaendig", "Der Finanzplan ist unvollständig erfasst");
                    return;
                }

                // Notfallzahlung Zürich
                if ((int)qryBgFinanzplan["WhHilfeTypCode"] == 1)
                {
                    try
                    {
                        DBUtil.ExecSQLThrowingException(@"
                            DECLARE @BgBudgetID  int

                            SELECT @BgBudgetID = BgBudgetID
                            FROM BgBudget
                            WHERE BgFinanzplanID = {0}

                            EXECUTE spWhBudget_CreateKbBuchung @BgBudgetID, {1}, 1", this.BgFinanzplanID, Session.User.UserID);
                    }
                    catch (KissCancelException ex)
                    {
                        KissMsg.ShowInfo("cmdAnfrage in NotfallCancelException");
                        ex.ShowMessage();
                        return;
                    }
                }

                DlgBewilligungAnfragen dlg = new DlgPositionBewilligungAnfragen(this.BgFinanzplanID, true);

                try
                {
                    // Der Dialog kann eine Transaktion öffnen
                    dlg.ShowDialog(this);

                    if (!dlg.UserCancel)
                    {
                        this.qryBgFinanzplan.Refresh();
                        this.qryBgFinanzplan["BgBewilligungStatusCode"] = (int)BgBewilligungStatus.Angefragt;
                        this.qryBgFinanzplan.Post();
                        this.qryBgFinanzplan.Refresh();
                        Session.Commit();
                    }
                    else if (Session.Transaction != null)
                    {
                        Session.Rollback();
                    }

                    FormController.SendMessage("FrmFall", "Action", "RefreshTree");
                }
                catch (Exception ex)
                {
                    if (Session.Transaction != null)
                        Session.Rollback();
                    this.qryBgFinanzplan.DataSet.RejectChanges();
                    KissMsg.ShowError(ex.Message);
                }
            }
        }

        private void cmdAntworten_Click(object sender, System.EventArgs e)
        {
            this.qryBgFinanzplan.RowModified = true;
            if (this.qryBgFinanzplan.Post())
            {
                this.qryCheck.Refresh();

                if (this.qryCheck.DataTable.Select("Typ = 0").Length > 0)
                {
                    KissMsg.ShowInfo("CtlWhFinanzplan", "FinanzplanUnvollstaendig", "Der Finanzplan ist unvollständig erfasst");
                    return;
                }
                else if (this.qryCheck.DataTable.Select("Typ = 1").Length > 0)
                {
                    KissMsg.ShowInfo("CtlWhFinanzplan", "KeineKompetenz", "Sie haben nicht die Kompetenz diesen Finanzplan zu bewilligen");
                    return;
                }

                DlgWhFinanzplanVisieren dlg = new DlgWhFinanzplanVisieren(this.BgFinanzplanID);

                //untermonatiges "Datum von" anpassen auf 1. des Monats
                dlg.Datum = Utils.firstDayOfMonth((DateTime)qryBgFinanzplan["GeplantVon"]);

                bool checkWV = false;

                try
                {
                    DBUtil.ThrowExceptionOnOpenTransaction();
                    // ShowDialog öffnet evt. eine neue Transaktion
                    dlg.ShowDialog(this);

                    if (!dlg.UserCancel)
                    {
                        this.qryBgFinanzplan.Refresh();

                        if (dlg.UserYes)
                        {
                            DBUtil.ExecSQLThrowingException("EXECUTE spWhFinanzplan_Bewilligen {0}, {1}"
                                , this.BgFinanzplanID
                                , dlg.Datum);

                            this.qryBgFinanzplan["BgBewilligungStatusCode"] = (int)BgBewilligungStatus.Erteilt;

                            DBUtil.ExecSQLThrowingException(@"
                                UPDATE BgBudget
                                  SET BgBewilligungStatusCode = {1}
                                WHERE BgFinanzplanID = {0} AND MasterBudget = 1"
                                , this.BgFinanzplanID, qryBgFinanzplan["BgBewilligungStatusCode"]);

                            this.qryBgFinanzplan["DatumVon"] = dlg.Datum;

                            //untermonatiges "Datum bis" anpassen auf den letzten des Monats
                            this.qryBgFinanzplan["DatumBis"] = Utils.lastDayOfMonth((DateTime)qryBgFinanzplan["GeplantBis"]);

                            // Notfallzahlung Zürich
                            if ((int)qryBgFinanzplan["WhHilfeTypCode"] == 1)
                            {
                                int bgBudgetID = (int)DBUtil.ExecuteScalarSQL("SELECT BgBudgetID FROM BgBudget WHERE BgFinanzplanID = {0}", this.BgFinanzplanID);

                                DBUtil.ExecSQLThrowingException(@"
                                    EXECUTE spWhBudget_CreateKbBuchung {0}, {1}, 0"
                                    , bgBudgetID, Session.User.UserID);

                                DBUtil.ExecSQLThrowingException(@"
                                    UPDATE BgBudget
                                      SET BgBewilligungStatusCode = 5
                                    WHERE BgbudgetID = {0}"
                                    , bgBudgetID, Session.User.UserID);

                                DBUtil.ExecSQLThrowingException(@"
                                    INSERT INTO BgSpezkonto (FaLeistungID, BgSpezkontoTypCode, NameSpezkonto, StartSaldo, OhneEinzelzahlung, BetragProMonat, BgKostenartID, DatumVon, DatumBis)
                                      SELECT BFP.FaLeistungID, 3, BPO.Buchungstext, BPO.Betrag, 1, BPO.Betrag, BPA.BgKostenartID, dbo.fnDateSerial(BBG.Jahr, BBG.Monat, 1), dbo.fnLastDayOf(dbo.fnDateSerial(BBG.Jahr, BBG.Monat, 1))
                                      FROM BgPosition              BPO
                                        INNER JOIN BgPositionsart  BPA ON BPA.BgPositionsartID = BPO.BgPositionsartID
                                        INNER JOIN BgBudget        BBG ON BBG.BgBudgetID = BPO.BgBudgetID
                                        INNER JOIN BgFinanzplan    BFP ON BFP.BgFinanzplanID = BBG.BgFinanzplanID
                                      WHERE BPO.BgBudgetID = {0}",
                                    bgBudgetID);
                            }

                            this.qryBgFinanzplan.Post();
                            InsertFVProtokoll_Visum(BgBewilligungStatus.Erteilt);

                            // WV-Einheiten anpassen
                            // Dies muss im Code erfolgen, da der BgBewilligungStatusCode im Code gesetzt wird
                            checkWV = true; // Dies passiert nach der Transaktion
                        }
                        else
                        {
                            this.qryBgFinanzplan["BgBewilligungStatusCode"] = (int)BgBewilligungStatus.Abgelehnt;

                            this.qryBgFinanzplan.Post();
                            InsertFVProtokoll_Visum(BgBewilligungStatus.Abgelehnt);
                        }
                        this.qryBgFinanzplan.Refresh();

                        // Enddatum der Spezialkonti neu berechnen
                        DBUtil.ExecSQLThrowingException(@"
                          UPDATE BgSpezkonto
                          SET DatumBis = dbo.[fnWhBudget_GetSpezkontoEnddatum](BgSpezkontoID,DatumVon,StartSaldo,BetragProMonat,Inaktiv)
                          WHERE FaLeistungID = {0}", qryBgFinanzplan["FaLeistungID"]);
                        Session.Commit();
                    }
                    else if (Session.Transaction != null)
                    {
                        Session.Rollback();
                    }

                    // WV-Einheiten anpassen
                    // Dies muss im Code erfolgen, da der BgBewilligungStatusCode im Code gesetzt wird
                    if (checkWV)
                    {
                        int faFallID = (int)qryBgFinanzplan["FaFallID$"];
                        SqlQuery qryBefore = DBUtil.OpenSQL(@"SELECT DISTINCT BaPersonID
                                                                  FROM dbo.WhWVEinheit
                                                                  WHERE FaFallID = {0} AND Ungueltig = 0", faFallID);
                        DBUtil.ExecSQLThrowingException(@"EXECUTE spWhWVModifyUnits {0}", faFallID);
                        SqlQuery qryAfter = DBUtil.OpenSQL(@"SELECT DISTINCT BaPersonID
                                                                 FROM dbo.WhWVEinheit
                                                                 WHERE FaFallID = {0} AND Ungueltig = 0", faFallID);
                        bool pruefen = false;
                        foreach (DataRow treagerAfterRow in qryAfter.DataTable.Rows)
                        {
                            int tragerAfter = (int)treagerAfterRow["BaPersonID"];
                            pruefen |= qryBefore.DataTable.Select(string.Format("BaPersonID = {0}", tragerAfter)).Length == 0;
                        }

                        // Hinweis nur anzeigen, wenn die unterstützten Personen nicht nur ?-E-Codes während der Dauer des FP haben
                        pruefen &= (int)DBUtil.ExecuteScalarSQLThrowingException(@"
                          SELECT COUNT(*)
                          FROM BgFinanzplan_BaPerson FPP
                            INNER JOIN BgFinanzplan  BFP ON BFP.BgFinanzplanID = FPP.BgFinanzplanID
                            INNER JOIN BaWVCode      WVC ON WVC.BaPersonID = FPP.BaPersonID AND
                                                            WVC.BaWVStatusCode = 1 AND
                                                            dbo.fnDatumUeberschneidung(WVC.DatumVon, ISNULL(WVC.DatumBis,'9999-12-31'), BFP.GeplantVon, ISNULL(BFP.GeplantBis,'9999-12-31')) = 1
                            INNER JOIN XLOVCode      LOV ON LOV.LOVName = 'BaWVCode' AND LOV.Code = WVC.WVCode
                          WHERE FPP.BgFinanzplanID = {0} AND
                                FPP.IstUnterstuetzt = 1 AND
                                LOV.ShortText NOT LIKE '_-E'", qryBgFinanzplan["BgFinanzplanID"]) > 0;
                        if (pruefen)
                        {
                            KissMsg.ShowInfo("CtlWhFinanzplan", "WVEPruefen", "Hinweis: Automatisches Erstellen der WV-Einheit: Bitte Träger/in, KSA-Nr. und Notwendigkeit einer Nachtragsmeldung prüfen.");
                        }
                    }

                    FormController.SendMessage("FrmFall", "Action", "RefreshTree");

                    // XDocument Modus setzen
                    SetXDocumentMode();
                }
                catch (KissCancelException ex)
                {
                    if (Session.Transaction != null)
                        Session.Rollback();
                    this.qryBgFinanzplan.DataSet.RejectChanges();
                    ex.ShowMessage();
                }
                catch (Exception ex)
                {
                    if (Session.Transaction != null)
                        Session.Rollback();
                    this.qryBgFinanzplan.DataSet.RejectChanges();
                    KissMsg.ShowError(ex.Message);
                }
            }
        }

        private void cmdBeenden_Click(object sender, System.EventArgs e)
        {
            if (this.qryBgFinanzplan.Post())
            {
                DlgWhFinanzplanBeenden dlg = new DlgWhFinanzplanBeenden(this.BgFinanzplanID);

                dlg.Datum = this.qryBgFinanzplan["DatumBis"];
                dlg.MinDatum = DBUtil.ExecuteScalarSQL(@"
                    select	max(dbo.fnLastDayOf(dbo.fnDateSerial(Jahr,Monat,1)))
                    from	BgBudget
                    where	BgFinanzplanID = {0} and
                            MasterBudget = 0 AND BgBewilligungStatusCode >= 5",
                    BgFinanzplanID);

                if (dlg.MinDatum == null)
                {
                    dlg.MinDatum = this.qryBgFinanzplan["DatumVon"];
                }
                dlg.GrundEnde = this.qryBgFinanzplan["BgGrundAbschlussCode"];

                int anzahlLaufendeVerrechnungen = 0;
                DateTime geplantVon = DateTime.Now;

                DBUtil.ThrowExceptionOnOpenTransaction();
                dlg.ShowDialog(this);

                if (!dlg.UserCancel)
                {
                    Session.BeginTransaction();
                    try
                    {
                        if (!dlg.ActiveSQLQuery.Post())
                            throw new KissCancelException();

                        DBUtil.ExecSQL(@"
                            DECLARE @BgBudgetID  int

                            DECLARE cBudget CURSOR FOR
                              SELECT BgBudgetID
                              FROM BgBudget   BBG
                              WHERE BBG.BgFinanzplanID = {0} AND BBG.MasterBudget = 0 AND BBG.BgBewilligungStatusCode < 5
                                AND dbo.fnDateSerial(BBG.Jahr, BBG.Monat, 1) > {1}

                            OPEN cBudget
                            WHILE 1 = 1 BEGIN
                              FETCH NEXT FROM cBudget INTO @BgBudgetID
                              IF @@FETCH_STATUS != 0 BREAK

                              EXECUTE spWhBudget_Delete @BgBudgetID
                              DELETE FROM BgBudget WHERE BgBudgetID = @BgBudgetID
                            END
                            CLOSE cBudget
                            DEALLOCATE cBudget"
                            , this.BgFinanzplanID
                            , dlg.Datum);
                        this.qryBgFinanzplan.Refresh();

                        if ((DateTime)dlg.Datum <= DateTime.Today)
                            this.qryBgFinanzplan["BgBewilligungStatusCode"] = (int)BgBewilligungStatus.Gesperrt;

                        if ((bool)dlg.FinanzPlanNeu)
                        {
                            geplantVon = ((DateTime)dlg.Datum).AddDays(1);
                            DBUtil.ExecSQL("EXECUTE spWhFinanzPlan_Create {0}, {1}, {2}, {3}",
                                qryBgFinanzplan["FaLeistungID"],
                                geplantVon,
                                qryBgFinanzplan["GeplantBis"],
                                (int)qryBgFinanzplan["WhHilfeTypCode"] == 2 ? 4 : qryBgFinanzplan["WhHilfeTypCode"]);

                            anzahlLaufendeVerrechnungen = (int)DBUtil.ExecuteScalarSQL(@"
                              SELECT Count(*)
                              FROM BgSpezkonto SSK
                              WHERE SSK.FaLeistungID = {0}
                                AND SSK.BgSpezkontoTypCode = 3 /*Verrechnung*/
                                AND {1} BETWEEN SSK.DatumVon AND IsNull(SSK.DatumBis,'9999-12-31')
                                AND dbo.fnBgSpezkonto(SSK.BgSpezkontoID, 3, default, default) > 0
                                AND EXISTS (SELECT TOP 1 1   --Nur Verrechnungen auf aktiven Ausgabe-Positionsarten ausweisen
                                            FROM BgPositionsart
                                            WHERE BgKostenartID = SSK.BgKostenartID
                                              AND BgKategorieCode IN (2, 3))",
                                qryBgFinanzplan["FaLeistungID"],
                                geplantVon);
                        }

                        this.qryBgFinanzplan["DatumBis"] = dlg.Datum;
                        this.qryBgFinanzplan["BgGrundAbschlussCode"] = dlg.GrundEnde;

                        this.qryBgFinanzplan.Post();
                        InsertFVProtokoll_Beenden();
                        this.qryBgFinanzplan.Refresh();
                        Session.Commit();
                    }
                    catch (Exception ex)
                    {
                        this.qryBgFinanzplan.DataSet.RejectChanges();
                        Session.Rollback();

                        if (ex is KissCancelException)
                        {
                            ((KissCancelException)ex).ShowMessage();
                        }
                        else
                        {
                            KissMsg.ShowError(ex.Message);
                        }
                    }

                    FormController.SendMessage("FrmFall", "Action", "RefreshTree");
                }

                if (anzahlLaufendeVerrechnungen > 0)
                {
                    string text = string.Format("Per geplantem Startdatum des neuen Finanzplans ({0}) besteht eine Verrechnung", geplantVon.ToShortDateString());
                    if (anzahlLaufendeVerrechnungen > 1)
                        text = string.Format("Per geplantem Startdatum des neuen Finanzplans ({0}) bestehen {1} Verrechnungen", geplantVon.ToShortDateString(), anzahlLaufendeVerrechnungen);

                    KissMsg.ShowInfo(text);
                }
            }
        }

        private void cmdReferentin_Click(object sender, System.EventArgs e)
        {
            DlgWhFinanzplanReferentin dlg = new DlgWhFinanzplanReferentin(this.BgFinanzplanID);
            dlg.ShowDialog(this);

            if (!dlg.UserCancel)
            {
                if (dlg.UserYes)
                    InsertFVProtokoll_ReferentinVisum();
                else
                    InsertFVProtokoll_ReferentinAblehnung();
            }
        }

        private void cmdStatusRefresh_Click(object sender, System.EventArgs e)
        {
            qryBgFinanzplan.Post();
            qryCheck.Refresh();
        }

        private void cmdVerlauf_Click(object sender, System.EventArgs e)
        {
            DlgWhFinanzplanVerlauf dlg = new DlgWhFinanzplanVerlauf(BgFinanzplanID);
            dlg.ShowDialog(this);
        }

        private void docKlaerungsphase_DocumentCreated(object sender, EventArgs e)
        {
            // Check Query erneut ausführen
            qryCheck.Refresh();
        }

        private void docKlaerungsphase_DocumentDeleted(object sender, EventArgs e)
        {
            //sicherstellen, dass das Query die aktuellen Daten hat -> innerhalb von qry.Refresh() wird dann bereits SetXDocumentMode aufgerufen
            qryBgFinanzplan.Refresh();
        }

        // ControlName: docLeistungsentscheid
        private void docLeistungsentscheid_DocumentCreated(object sender, System.EventArgs e)
        {
            // Check Query erneut ausführen
            qryCheck.Refresh();
        }

        private void docLeistungsentscheid_DocumentDeleted(object sender, EventArgs e)
        {
            //sicherstellen, dass das Query die aktuellen Daten hat -> innerhalb von qry.Refresh() wird dann bereits SetXDocumentMode aufgerufen
            qryBgFinanzplan.Refresh();
        }

        // Werte in die Datenbank in FaJournal einfügen
        private bool InsertFVProtokoll_Aufheben()
        {
            // Einen neuen Eintrag im Fallverlaufsprotokoll einfügen
            // -----------------------------------------------------
            // Parameter der sp:  {0}=FaFallID, {1}=FaLeistungID, {2}=BaPersonID, {3}=UserID, {4}=FaJournalCode, {5}=Text
            // Info:              Wenn FaFallID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via BaPersonID die FaFallID zu setzen.
            //                    Wenn BaPersonID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via FaFallID die BaPersonID zu setzen.
            // Rückgabewert:      Eingefügte FaJournalID des neuen Eintrags - zum Ändern von zusätzlichen Werten verwendbar
            int faJournalID = Convert.ToInt32(DBUtil.ExecuteScalarSQL(@"
                EXEC spFaInsertFVProtokoll {0}, {1}, {2}, {3}, {4}, {5}",
                DBNull.Value, //FaFallID,
                qryBgFinanzplan["FaLeistungID"],
                DBNull.Value, //BaPersonID,
                Session.User.UserID,
                1, //FaJournalCode
                string.Format("Aufhebung der Bewilligung für Finanzplan #{0}, {1:d} - {2:d}", qryBgFinanzplan["BgFinanzplanID"], qryBgFinanzplan["DatumVon"], qryBgFinanzplan["DatumBis"])));

            // return if valid new id (< 1 = invalid)
            return faJournalID > 0;
        }

        // Werte in die Datenbank in FaJournal einfügen
        private bool InsertFVProtokoll_Beenden()
        {
            // Einen neuen Eintrag im Fallverlaufsprotokoll einfügen
            // -----------------------------------------------------
            // Parameter der sp:  {0}=FaFallID, {1}=FaLeistungID, {2}=BaPersonID, {3}=UserID, {4}=FaJournalCode, {5}=Text
            // Info:              Wenn FaFallID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via BaPersonID die FaFallID zu setzen.
            //                    Wenn BaPersonID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via FaFallID die BaPersonID zu setzen.
            // Rückgabewert:      Eingefügte FaJournalID des neuen Eintrags - zum Ändern von zusätzlichen Werten verwendbar
            int faJournalID = Convert.ToInt32(DBUtil.ExecuteScalarSQL(@"
                EXEC spFaInsertFVProtokoll {0}, {1}, {2}, {3}, {4}, {5}",
                DBNull.Value, //FaFallID,
                qryBgFinanzplan["FaLeistungID"],
                DBNull.Value, //BaPersonID,
                Session.User.UserID,
                1, //FaJournalCode
                string.Format("Finanzplan beendet #{0}, {1:d}, Grund: {2}",
                    qryBgFinanzplan["BgFinanzplanID"], qryBgFinanzplan["DatumBis"],
                    edtBgGrundAbschlussCode.GetDisplayText(qryBgFinanzplan[edtBgGrundAbschlussCode.DataMember]))));

            // return if valid new id (< 1 = invalid)
            return faJournalID > 0;
        }

        // Werte in die Datenbank in FaJournal einfügen
        private bool InsertFVProtokoll_ReferentinAblehnung()
        {
            // Einen neuen Eintrag im Fallverlaufsprotokoll einfügen
            // -----------------------------------------------------
            // Parameter der sp:  {0}=FaFallID, {1}=FaLeistungID, {2}=BaPersonID, {3}=UserID, {4}=FaJournalCode, {5}=Text
            // Info:              Wenn FaFallID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via BaPersonID die FaFallID zu setzen.
            //                    Wenn BaPersonID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via FaFallID die BaPersonID zu setzen.
            // Rückgabewert:      Eingefügte FaJournalID des neuen Eintrags - zum Ändern von zusätzlichen Werten verwendbar
            int faJournalID = Convert.ToInt32(DBUtil.ExecuteScalarSQL(@"
                EXEC spFaInsertFVProtokoll {0}, {1}, {2}, {3}, {4}, {5}",
                DBNull.Value, //FaFallID,
                qryBgFinanzplan["FaLeistungID"],
                DBNull.Value, //BaPersonID,
                Session.User.UserID,
                1, //FaJournalCode
                string.Format("Finanzplan #{0}: Rückfrage durch Referentin", qryBgFinanzplan["BgFinanzplanID"])));

            // return if valid new id (< 1 = invalid)
            return faJournalID > 0;
        }

        // Werte in die Datenbank in FaJournal einfügen
        private bool InsertFVProtokoll_ReferentinVisum()
        {
            // Einen neuen Eintrag im Fallverlaufsprotokoll einfügen
            // -----------------------------------------------------
            // Parameter der sp:  {0}=FaFallID, {1}=FaLeistungID, {2}=BaPersonID, {3}=UserID, {4}=FaJournalCode, {5}=Text
            // Info:              Wenn FaFallID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via BaPersonID die FaFallID zu setzen.
            //                    Wenn BaPersonID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via FaFallID die BaPersonID zu setzen.
            // Rückgabewert:      Eingefügte FaJournalID des neuen Eintrags - zum Ändern von zusätzlichen Werten verwendbar
            int faJournalID = Convert.ToInt32(DBUtil.ExecuteScalarSQL(@"
                EXEC spFaInsertFVProtokoll {0}, {1}, {2}, {3}, {4}, {5}",
                DBNull.Value, //FaFallID,
                qryBgFinanzplan["FaLeistungID"],
                DBNull.Value, //BaPersonID,
                Session.User.UserID,
                1, //FaJournalCode
                string.Format("Finanzplan #{0} visiert durch Referentin", qryBgFinanzplan["BgFinanzplanID"])));

            // return if valid new id (< 1 = invalid)
            return faJournalID > 0;
        }

        // Werte in die Datenbank in FaJournal einfügen
        private bool InsertFVProtokoll_Visum(BgBewilligungStatus status)
        {
            // Einen neuen Eintrag im Fallverlaufsprotokoll einfügen
            // -----------------------------------------------------
            // Parameter der sp:  {0}=FaFallID, {1}=FaLeistungID, {2}=BaPersonID, {3}=UserID, {4}=FaJournalCode, {5}=Text
            // Info:              Wenn FaFallID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via BaPersonID die FaFallID zu setzen.
            //                    Wenn BaPersonID NULL ist, wird versucht (1.) via FaLeistungID oder (2.) via FaFallID die BaPersonID zu setzen.
            // Rückgabewert:      Eingefügte FaJournalID des neuen Eintrags - zum Ändern von zusätzlichen Werten verwendbar

            string eintrag = "";

            if (status == BgBewilligungStatus.Erteilt)
            {
                eintrag = string.Format("Finanzplan genehmigt #{0}, {1:d} - {2:d}", qryBgFinanzplan["BgFinanzplanID"], qryBgFinanzplan["DatumVon"], qryBgFinanzplan["DatumBis"]);
            }
            else
            {
                eintrag = string.Format("Finanzplan abgelehnt #{0}, {1:d} - {2:d}", qryBgFinanzplan["BgFinanzplanID"], qryBgFinanzplan["DatumVon"], qryBgFinanzplan["DatumBis"]);
            }

            int faJournalID = Convert.ToInt32(DBUtil.ExecuteScalarSQL(@"
                EXEC spFaInsertFVProtokoll {0}, {1}, {2}, {3}, {4}, {5}",
                DBNull.Value, //FaFallID,
                qryBgFinanzplan["FaLeistungID"],
                DBNull.Value, //BaPersonID,
                Session.User.UserID,
                1, //FaJournalCode
                     eintrag));

            // return if valid new id (< 1 = invalid)
            return faJournalID > 0;
        }

        private bool IstAusgabePositionsartAktiv(int? bgPositionsartID)
        {
            var bgkategorieCode = DBUtil.ExecuteScalarSQL(@"SELECT TOP 1 BgKategorieCode
                                                  FROM dbo.BgPositionsart
                                                  WHERE BgPositionsartID = {0}", bgPositionsartID) as int?;
            return bgkategorieCode != null && bgkategorieCode.Value < 10000;
        }

        private void qryBgFinanzplan_AfterPost(object sender, System.EventArgs e)
        {
            try
            {
                if (WhGrundbedarfTypCode_Changed && this.BgBudgetID is int)
                {
                    DBUtil.ExecSQLThrowingException("EXECUTE spWhFinanzplan_Update {0}", BgFinanzplanID);
                    if (!transactionOpenBeforePost)
                        Session.Commit();
                    FormController.SendMessage("FrmFall", "Action", "RefreshTree");
                }
            }
            catch (Exception ex)
            {
                if (Session.Transaction != null)
                    Session.Rollback();
                throw ex;
            }
            finally
            {
                transactionOpenBeforePost = false;
            }
        }

        private void qryBgFinanzplan_BeforePost(object sender, System.EventArgs e)
        {
            DBUtil.CheckNotNullField(edtGeplantBis, lblGeplantBis.Text);

            DBUtil.CheckNotNullField(edtGeplantVon, lblGeplantVon.Text);

            DBUtil.CheckNotNullField(edtWhGrundbedarfTypCode, lblWhGrundbedarfTypCode.Text);

            if (Utils.firstDayOfMonth((DateTime)qryBgFinanzplan["FallDatumVon"]) > ((DateTime)this.qryBgFinanzplan["GeplantVon"]).Date)
                throw new KissInfoException(KissMsg.GetMLMessage("CtlWhFinanzplan", "BeginnAusserhalbSozhilfe", "Der Beginn liegt ausserhalb der Sozialhilfe", KissMsgCode.MsgInfo), this.edtGeplantVon);

            if (!DBUtil.IsEmpty(qryBgFinanzplan["FallDatumBis"]) && Utils.lastDayOfMonth((DateTime)qryBgFinanzplan["FallDatumBis"]) < ((DateTime)this.qryBgFinanzplan["GeplantBis"]).Date)
                throw new KissInfoException(KissMsg.GetMLMessage("CtlWhFinanzplan", "EndeAusserhalbSozhilfe", "Das Ende liegt ausserhalb der Sozialhilfe", KissMsgCode.MsgInfo), this.edtGeplantBis);

            if (((DateTime)this.qryBgFinanzplan["GeplantVon"]).Date > ((DateTime)this.qryBgFinanzplan["GeplantBis"]).Date)
                throw new KissInfoException(KissMsg.GetMLMessage("CtlWhFinanzplan", "BeginnNachEnde", "Der Beginn liegt nach dem Ende", KissMsgCode.MsgInfo));

            if ((int)this.qryBgFinanzplan["BgBewilligungStatusCode"] < (int)BgBewilligungStatus.Erteilt)
            {
                if (0 != (int)DBUtil.ExecuteScalarSQL(@"
                    SELECT Count(*)
                    FROM BgFinanzplan  BFP
                    WHERE BFP.FaLeistungID = {0} AND BFP.BgFinanzplanID <> IsNull({1}, 0)
                      AND EXISTS (SELECT * FROM BgBudget WHERE BgFinanzplanID = BFP.BgFinanzplanID AND MasterBudget = 1)
                      AND dbo.fnDateOf({2})                     <= dbo.fnDateOf(COALESCE(DatumBis, GeplantBis, '99991231'))
                      AND dbo.fnDateOf(IsNull({3}, '99991231')) >= dbo.fnDateOf(COALESCE(DatumVon, GeplantVon))"
                    , this.qryBgFinanzplan["FaLeistungID"], this.qryBgFinanzplan["BgFinanzplanID"]
                    , this.qryBgFinanzplan["GeplantVon"], this.qryBgFinanzplan["GeplantBis"]))
                {
                    throw new KissInfoException(KissMsg.GetMLMessage("CtlWhFinanzplan", "UeberschneidungDatum", "Überschneidung der Datumsbereiche", KissMsgCode.MsgInfo), this.edtDatumVon);
                }

                /* ZH: Notfallzahlung immer möglich
                    if ((int)this.qryBgFinanzplan["WhHilfeTypCode"] == 1 && 0 != (int)DBUtil.ExecuteScalarSQL(@"
                        SELECT Count(*) FROM BgFinanzplan
                        WHERE FaLeistungID = {0} AND BgFinanzplanID != IsNull({1}, 0)
                          AND dbo.fnDateOf(IsNull(DatumVon, GeplantVon)) < dbo.fnDateOf({2})"
                        , this.qryBgFinanzplan["FaLeistungID"], this.qryBgFinanzplan["BgFinanzplanID"]
                        , this.qryBgFinanzplan["GeplantVon"]))
                    {
                        throw new KissInfoException(KissMsg.GetMLMessage("CtlWhFinanzplan", "NurErsterFinanzplanUeberbrueckung", "Nur der erste Finanzplan kann eine Überbrückung sein", KissMsgCode.MsgInfo), this.edtDatumVon);
                    }
                */
            }

            //Datumskorrektur, falls Gültig ab/bis untermonatig
            qryBgFinanzplan["GeplantVon"] = Utils.firstDayOfMonth((DateTime)qryBgFinanzplan["GeplantVon"]);
            qryBgFinanzplan["GeplantBis"] = Utils.lastDayOfMonth((DateTime)qryBgFinanzplan["GeplantBis"]);

            WhGrundbedarfTypCode_Changed = qryBgFinanzplan.ColumnModified("WhGrundbedarfTypCode");
            transactionOpenBeforePost = (Session.Transaction != null);
            if (WhGrundbedarfTypCode_Changed && this.BgBudgetID is int)
            {
                try
                {
                    if (!transactionOpenBeforePost)
                        Session.BeginTransaction();

                    DBUtil.ExecSQLThrowingException(@"
                    DELETE BPO
                    FROM BgPosition        BPO
                      INNER JOIN XLOVCode  XLC ON XLC.LOVName = CONVERT(varchar, {2}) AND XLC.Code = BPO.BgPositionsArtID
                    WHERE BgBudgetID = {0} AND BPO.BgPositionsArtID <> {1}

                    IF NOT EXISTS (SELECT * FROM BgPosition WHERE BgBudgetID = {0} AND BgPositionsartID = {1}) BEGIN
                      INSERT INTO BgPosition (BgBudgetID, BgKategorieCode, BgPositionsartID, Buchungstext)
                        VALUES ({0}, 2, {1}, 'GBL Lebensunterhalt')
                    END",
                        this.BgBudgetID, qryBgFinanzplan["WhGrundbedarfTypCode"], "WhGrundbedarfTyp");

                    switch ((int)qryBgFinanzplan["WhGrundbedarfTypCode"])
                    {
                        case 32011:
                            // Grundbedarf 1 Zuschlag
                            DBUtil.ExecSQLThrowingException(@"
                            IF NOT EXISTS (SELECT * FROM BgPosition WHERE BgBudgetID = {0} AND BgPositionsartID = 32012) BEGIN
                              INSERT INTO BgPosition (BgBudgetID, BgKategorieCode, BgPositionsartID)
                                VALUES ({0}, 2, 32012)
                            END"
                                , this.BgBudgetID);

                            // Grundbedarf 2
                            DBUtil.ExecSQLThrowingException(@"
                            IF NOT EXISTS (SELECT * FROM BgPosition WHERE BgBudgetID = {0} AND BgPositionsartID IN (32013, 32014)) BEGIN
                              INSERT INTO BgPosition (BgBudgetID, BgKategorieCode, BgPositionsartID)
                                VALUES ({0}, 2, 32013)
                            END"
                                , this.BgBudgetID);
                            break;

                        default:
                            DBUtil.ExecSQLThrowingException(
                                "DELETE FROM BgPosition WHERE BgBudgetID = {0} AND BgPositionsartID IN (32012, 32013, 32014)"
                                , this.BgBudgetID);
                            break;
                    }
                }
                catch (Exception ex)
                {
                    if (Session.Transaction != null)
                        Session.Rollback();
                    throw ex;
                }
            }
        }

        private void qryBgFinanzplan_PositionChanged(object sender, System.EventArgs e)
        {
            switch ((BgBewilligungStatus)this.qryBgFinanzplan["BgBewilligungStatusCode"])
            {
                case BgBewilligungStatus.InVorbereitung:
                case BgBewilligungStatus.Angefragt:
                case BgBewilligungStatus.Abgelehnt:
                    this.edtGeplantVon.EditMode = EditModeType.Normal;
                    this.edtGeplantBis.EditMode = EditModeType.Normal;

                    this.edtUnterschriftAntrag.EditMode = EditModeType.Normal;

                    //		this.edtBgGrundEroeffnenCode.EditMode = EditModeType.Normal;
                    this.edtBgGrundAbschlussCode.EditMode = EditModeType.Normal;

                    this.edtWhGrundbedarfTypCode.EditMode = EditModeType.Normal;
                    //		this.edtBemerkung.EditMode = EditModeType.Normal;

                    this.cmdAnfragen.Enabled = true;
                    this.cmdAntworten.Enabled = true;
                    //		this.cmdAufheben.Enabled = false;

                    this.cmdBeenden.Enabled = false;
                    //		this.cmdEntsperren.Enabled = false;
                    this.cmdReferentin.Enabled = false;
                    break;

                case BgBewilligungStatus.Erteilt:
                case BgBewilligungStatus.Gesperrt:
                    this.edtGeplantVon.EditMode = EditModeType.ReadOnly;
                    this.edtGeplantBis.EditMode = EditModeType.ReadOnly;

                    this.edtUnterschriftAntrag.EditMode = EditModeType.ReadOnly;

                    //		this.edtBgGrundEroeffnenCode.EditMode = EditModeType.ReadOnly;
                    this.edtBgGrundAbschlussCode.EditMode = EditModeType.ReadOnly;

                    this.edtWhGrundbedarfTypCode.EditMode = EditModeType.ReadOnly;
                    //		this.edtBemerkung.EditMode = EditModeType.ReadOnly;

                    this.cmdAnfragen.Enabled = false;
                    this.cmdAntworten.Enabled = false;
                    //		this.cmdAufheben.Enabled = true;

                    this.cmdBeenden.Enabled = true;
                    //		this.cmdEntsperren.Enabled = false;
                    this.cmdReferentin.Enabled = DBUtil.UserHasRight("CtlWhFinanzplan_Referentin");
                    break;
            }

            btnAufheben.Visible = DBUtil.UserHasRight("CtlWhFinanzplan_BewilligungAufheben");
            btnAufheben.Enabled = ((int)qryBgFinanzplan["BgBewilligungStatusCode"]) == 5;

            if ((int)qryBgFinanzplan["WhHilfeTypCode"] == 4)
            {
                this.edtGeplantBis.EditMode = EditModeType.ReadOnly;

                //Readonly setzen nur wenn die Berechnungsgrundlage/GBL immer noch aktiv ist:
                if (IstAusgabePositionsartAktiv(qryBgFinanzplan["WhGrundbedarfTypCode"] as int?))
                {
                    this.edtWhGrundbedarfTypCode.EditMode = EditModeType.ReadOnly;
                }
            }
        }

        private void qryBgFinanzplan_PostCompleted(object sender, EventArgs e)
        {
            SetXDocumentMode();
        }

        private void qryBgFinanzplan_PostError(object sender, UnhandledExceptionEventArgs e)
        {
            transactionOpenBeforePost = false;
            if (Session.Transaction != null)
                Session.Rollback();
        }

        private void qryCheck_AfterFill(object sender, System.EventArgs e)
        {
            if (this.qryCheck.DataTable.Select("Typ = 0").Length == 0)
            {
                this.txtStatusInfo.Text = "Daten sind vollständig erfasst";
            }
            else
            {
                this.txtStatusInfo.Text = "Die folgenden Daten müssen noch ergänzt/korrigiert werden:";
            }

            foreach (System.Data.DataRow row in this.qryCheck.DataTable.Select("Typ <= 1"))
            {
                this.txtStatusInfo.Text += "\r\n - " + (string)row[1];
            }

            if (this.qryCheck.DataTable.Select("Typ = 2").Length > 0)
            {
                this.txtStatusInfo.Text += "\r\nWarnung:";
                foreach (System.Data.DataRow row in this.qryCheck.DataTable.Select("Typ = 2"))
                {
                    this.txtStatusInfo.Text += "\r\n - " + (string)row[1];
                }
            }

            if (!DBUtil.IsEmpty(qryBgFinanzplan["Bemerkung"]))
            {
                this.txtStatusInfo.Text += "\r\n\r\nBemerkung: " + (string)qryBgFinanzplan["Bemerkung"];
            }
        }

        private void SetXDocumentMode()
        {
            try
            {
                // Änderungen im Finanzplan abspeichern
                if (qryBgFinanzplan.RowModified)
                    qryBgFinanzplan.Post();

                this.qryIstBewilligt.Fill(this.BgFinanzplanID);

                bool canCreateDeleteDocument;

                bool leistungsentscheidDocExistiert = !DBUtil.IsEmpty(qryBgFinanzplan["XDocumentID_Leistungsentscheid"]);
                bool klaerungsphaseDocExistiert = !DBUtil.IsEmpty(qryBgFinanzplan["XDocumentID_Klaerungsphase"]);

                if (qryIstBewilligt.DataTable.Rows.Count > 0)
                {
                    // Wenn der Leistungsentscheid bewilligt ist, dann dürfen Leistungsentscheid und Klärungsphase nicht mehr geändert werden
                    canCreateDeleteDocument = false;

                    // Falls es jedoch noch keine Leistungsentscheid-/Klärungsphase-DocumentID gibt, oder der Benutzer das Spezialrecht zum Löschen eines LE hat,
                    // dann darf ein Leistungsentscheid erstellt oder gelöscht werden
                    if ((!leistungsentscheidDocExistiert && !klaerungsphaseDocExistiert)
                        || (DBUtil.UserHasRight("CtlWhFinanzplan_BewilligungLELoeschen")))
                    {
                        canCreateDeleteDocument = true;
                    }
                }
                else
                {
                    canCreateDeleteDocument = true;
                }

                docLeistungsentscheid.CanDeleteDocument = canCreateDeleteDocument;
                docLeistungsentscheid.CanCreateDocument = canCreateDeleteDocument && !klaerungsphaseDocExistiert;
                docLeistungsentscheid.EditMode = canCreateDeleteDocument && !klaerungsphaseDocExistiert ? EditModeType.Normal : EditModeType.ReadOnly;
                docKlaerungsphase.CanDeleteDocument = canCreateDeleteDocument;
                docKlaerungsphase.CanCreateDocument = canCreateDeleteDocument && !leistungsentscheidDocExistiert;
                docKlaerungsphase.EditMode = canCreateDeleteDocument && !leistungsentscheidDocExistiert ? EditModeType.Normal : EditModeType.ReadOnly;
            }
            catch (Exception e)
            {
                KissMsg.ShowInfo(e.Message);
            }
        }

        #endregion
    }
}