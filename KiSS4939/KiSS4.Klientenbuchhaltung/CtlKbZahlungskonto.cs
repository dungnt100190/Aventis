#region Header

//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:2.0.50727.1433
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

#endregion

using System;
using System.Linq;

using DevExpress.XtraEditors.Controls;

using Kiss.Interfaces.UI;
using KiSS4.Common;
using KiSS4.DB;
using KiSS4.Schnittstellen.DTA_EZAG;

namespace KiSS4.Klientenbuchhaltung
{
    public class CtlKbZahlungskonto : KiSS4.Gui.KissUserControl
    {
        #region Fields

        private bool _edtZahlungsformat_EditValueChanging;
        private int? _postfinanceBaBankID;
        private string _postfinanceBezeichnung;
        private DevExpress.XtraGrid.Columns.GridColumn colBank;
        private DevExpress.XtraGrid.Columns.GridColumn colKontoNr;
        private DevExpress.XtraGrid.Columns.GridColumn colName;
        private DevExpress.XtraGrid.Columns.GridColumn colVertragNr;
        private DevExpress.XtraGrid.Columns.GridColumn colZahlungsformat;
        private System.ComponentModel.IContainer components;
        private KiSS4.Gui.KissButtonEdit edtBank;
        private KiSS4.Gui.KissTextEdit edtKontoNr;
        private KiSS4.Gui.KissTextEdit edtName;
        private KiSS4.Gui.KissTextEdit edtVertragNr;
        private KiSS4.Gui.KissRadioGroup edtZahlungsformat;
        private KiSS4.Gui.KissGrid gridDTAZugang;
        private DevExpress.XtraGrid.Views.Grid.GridView gridViewFields;
        private System.Windows.Forms.Label lblFinanzInstitut;
        private System.Windows.Forms.Label lblKontoNr;
        private System.Windows.Forms.Label lblName;
        private System.Windows.Forms.Label lblVertragNr;
        private System.Windows.Forms.Label lblZahlungsformat;
        private System.Windows.Forms.Panel panel1;
        private System.Windows.Forms.Panel panel2;
        private KiSS4.DB.SqlQuery qryKbZahlungskonten;

        #endregion

        #region Constructors

        public CtlKbZahlungskonto()
        {
            this.InitializeComponent();

            GetPostfinanceData(out _postfinanceBaBankID, out _postfinanceBezeichnung);
            PrepareEdtZahlungsformat();
        }

        #endregion

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            System.ComponentModel.ComponentResourceManager resources = new System.ComponentModel.ComponentResourceManager(typeof(CtlKbZahlungskonto));
            DevExpress.Utils.SerializableAppearanceObject serializableAppearanceObject1 = new DevExpress.Utils.SerializableAppearanceObject();
            this.panel1 = new System.Windows.Forms.Panel();
            this.edtZahlungsformat = new KiSS4.Gui.KissRadioGroup(this.components);
            this.qryKbZahlungskonten = new KiSS4.DB.SqlQuery(this.components);
            this.lblZahlungsformat = new System.Windows.Forms.Label();
            this.lblKontoNr = new System.Windows.Forms.Label();
            this.lblFinanzInstitut = new System.Windows.Forms.Label();
            this.edtVertragNr = new KiSS4.Gui.KissTextEdit();
            this.edtKontoNr = new KiSS4.Gui.KissTextEdit();
            this.edtBank = new KiSS4.Gui.KissButtonEdit();
            this.lblVertragNr = new System.Windows.Forms.Label();
            this.edtName = new KiSS4.Gui.KissTextEdit();
            this.lblName = new System.Windows.Forms.Label();
            this.panel2 = new System.Windows.Forms.Panel();
            this.gridDTAZugang = new KiSS4.Gui.KissGrid();
            this.gridViewFields = new DevExpress.XtraGrid.Views.Grid.GridView();
            this.colKontoNr = new DevExpress.XtraGrid.Columns.GridColumn();
            this.colName = new DevExpress.XtraGrid.Columns.GridColumn();
            this.colVertragNr = new DevExpress.XtraGrid.Columns.GridColumn();
            this.colBank = new DevExpress.XtraGrid.Columns.GridColumn();
            this.colZahlungsformat = new DevExpress.XtraGrid.Columns.GridColumn();
            this.panel1.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.edtZahlungsformat)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtZahlungsformat.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryKbZahlungskonten)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtVertragNr.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoNr.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBank.Properties)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtName.Properties)).BeginInit();
            this.panel2.SuspendLayout();
            ((System.ComponentModel.ISupportInitialize)(this.gridDTAZugang)).BeginInit();
            ((System.ComponentModel.ISupportInitialize)(this.gridViewFields)).BeginInit();
            this.SuspendLayout();
            //
            // panel1
            //
            this.panel1.Controls.Add(this.edtZahlungsformat);
            this.panel1.Controls.Add(this.lblZahlungsformat);
            this.panel1.Controls.Add(this.lblKontoNr);
            this.panel1.Controls.Add(this.lblFinanzInstitut);
            this.panel1.Controls.Add(this.edtVertragNr);
            this.panel1.Controls.Add(this.edtKontoNr);
            this.panel1.Controls.Add(this.edtBank);
            this.panel1.Controls.Add(this.lblVertragNr);
            this.panel1.Controls.Add(this.edtName);
            this.panel1.Controls.Add(this.lblName);
            this.panel1.Dock = System.Windows.Forms.DockStyle.Bottom;
            this.panel1.Location = new System.Drawing.Point(0, 340);
            this.panel1.Name = "panel1";
            this.panel1.Size = new System.Drawing.Size(825, 195);
            this.panel1.TabIndex = 1;
            //
            // edtZahlungsformat
            //
            this.edtZahlungsformat.DataMember = "KbFinanzInstitutCode";
            this.edtZahlungsformat.DataSource = this.qryKbZahlungskonten;
            this.edtZahlungsformat.EditValue = "1";
            this.edtZahlungsformat.Location = new System.Drawing.Point(132, 34);
            this.edtZahlungsformat.LookupSQL = null;
            this.edtZahlungsformat.LOVFilter = null;
            this.edtZahlungsformat.LOVName = null;
            this.edtZahlungsformat.Name = "edtZahlungsformat";
            this.edtZahlungsformat.Properties.Appearance.BackColor = System.Drawing.Color.Transparent;
            this.edtZahlungsformat.Properties.Appearance.Options.UseBackColor = true;
            this.edtZahlungsformat.Properties.AppearanceDisabled.BackColor = System.Drawing.Color.Transparent;
            this.edtZahlungsformat.Properties.AppearanceDisabled.Options.UseBackColor = true;
            this.edtZahlungsformat.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.NoBorder;
            this.edtZahlungsformat.Properties.Items.AddRange(new DevExpress.XtraEditors.Controls.RadioGroupItem[] {
            new DevExpress.XtraEditors.Controls.RadioGroupItem(2, "ISO 20022"),
            new DevExpress.XtraEditors.Controls.RadioGroupItem(0, "EZAG"),
            new DevExpress.XtraEditors.Controls.RadioGroupItem(1, "DTA")});
            this.edtZahlungsformat.Size = new System.Drawing.Size(250, 30);
            this.edtZahlungsformat.TabIndex = 3;
            this.edtZahlungsformat.EditValueChanged += new System.EventHandler(this.edtZahlungsformat_EditValueChanged);
            //
            // qryKbZahlungskonten
            //
            this.qryKbZahlungskonten.CanDelete = true;
            this.qryKbZahlungskonten.CanInsert = true;
            this.qryKbZahlungskonten.CanUpdate = true;
            this.qryKbZahlungskonten.HostControl = this;
            this.qryKbZahlungskonten.IsIdentityInsert = false;
            this.qryKbZahlungskonten.SelectStatement = resources.GetString("qryKbZahlungskonten.SelectStatement");
            this.qryKbZahlungskonten.TableName = "KbZahlungskonto";
            this.qryKbZahlungskonten.AfterInsert += new System.EventHandler(this.qryKbZahlungskonten_AfterInsert);
            this.qryKbZahlungskonten.BeforePost += new System.EventHandler(this.qryKbZahlungskonten_BeforePost);
            //
            // lblZahlungsformat
            //
            this.lblZahlungsformat.Location = new System.Drawing.Point(15, 41);
            this.lblZahlungsformat.Name = "lblZahlungsformat";
            this.lblZahlungsformat.Size = new System.Drawing.Size(111, 20);
            this.lblZahlungsformat.TabIndex = 2;
            this.lblZahlungsformat.Text = "Zahlungsformat";
            this.lblZahlungsformat.UseCompatibleTextRendering = true;
            //
            // lblKontoNr
            //
            this.lblKontoNr.Location = new System.Drawing.Point(15, 98);
            this.lblKontoNr.Name = "lblKontoNr";
            this.lblKontoNr.Size = new System.Drawing.Size(111, 20);
            this.lblKontoNr.TabIndex = 6;
            this.lblKontoNr.Text = "Konto Nr";
            this.lblKontoNr.UseCompatibleTextRendering = true;
            //
            // lblFinanzInstitut
            //
            this.lblFinanzInstitut.Location = new System.Drawing.Point(15, 71);
            this.lblFinanzInstitut.Name = "lblFinanzInstitut";
            this.lblFinanzInstitut.Size = new System.Drawing.Size(111, 20);
            this.lblFinanzInstitut.TabIndex = 4;
            this.lblFinanzInstitut.Text = "Finanzinstitut";
            this.lblFinanzInstitut.UseCompatibleTextRendering = true;
            //
            // edtVertragNr
            //
            this.edtVertragNr.DataMember = "VertragNr";
            this.edtVertragNr.DataSource = this.qryKbZahlungskonten;
            this.edtVertragNr.Location = new System.Drawing.Point(132, 119);
            this.edtVertragNr.Name = "edtVertragNr";
            this.edtVertragNr.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtVertragNr.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtVertragNr.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtVertragNr.Properties.Appearance.Options.UseBackColor = true;
            this.edtVertragNr.Properties.Appearance.Options.UseBorderColor = true;
            this.edtVertragNr.Properties.Appearance.Options.UseFont = true;
            this.edtVertragNr.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtVertragNr.Size = new System.Drawing.Size(250, 24);
            this.edtVertragNr.TabIndex = 9;
            //
            // edtKontoNr
            //
            this.edtKontoNr.DataMember = "KontoNr";
            this.edtKontoNr.DataSource = this.qryKbZahlungskonten;
            this.edtKontoNr.Location = new System.Drawing.Point(132, 92);
            this.edtKontoNr.Name = "edtKontoNr";
            this.edtKontoNr.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtKontoNr.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtKontoNr.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtKontoNr.Properties.Appearance.Options.UseBackColor = true;
            this.edtKontoNr.Properties.Appearance.Options.UseBorderColor = true;
            this.edtKontoNr.Properties.Appearance.Options.UseFont = true;
            this.edtKontoNr.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtKontoNr.Size = new System.Drawing.Size(250, 24);
            this.edtKontoNr.TabIndex = 7;
            //
            // edtBank
            //
            this.edtBank.DataMember = "FinanzInstitut";
            this.edtBank.DataSource = this.qryKbZahlungskonten;
            this.edtBank.EditMode = Kiss.Interfaces.UI.EditModeType.ReadOnly;
            this.edtBank.Location = new System.Drawing.Point(132, 65);
            this.edtBank.Name = "edtBank";
            this.edtBank.Properties.Appearance.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.edtBank.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtBank.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtBank.Properties.Appearance.Options.UseBackColor = true;
            this.edtBank.Properties.Appearance.Options.UseBorderColor = true;
            this.edtBank.Properties.Appearance.Options.UseFont = true;
            this.edtBank.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            serializableAppearanceObject1.BackColor = System.Drawing.Color.Bisque;
            serializableAppearanceObject1.Options.UseBackColor = true;
            this.edtBank.Properties.Buttons.AddRange(new DevExpress.XtraEditors.Controls.EditorButton[] {
            new DevExpress.XtraEditors.Controls.EditorButton(DevExpress.XtraEditors.Controls.ButtonPredefines.Ellipsis, "", -1, true, true, false, DevExpress.Utils.HorzAlignment.Center, null, new DevExpress.Utils.KeyShortcut(System.Windows.Forms.Keys.None), serializableAppearanceObject1)});
            this.edtBank.Properties.ButtonsStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.edtBank.Properties.ReadOnly = true;
            this.edtBank.SearchStringWhitelist = new string[] {
        ".",
        "*",
        "%"};
            this.edtBank.Size = new System.Drawing.Size(250, 24);
            this.edtBank.TabIndex = 5;
            this.edtBank.UserModifiedFld += new KiSS4.Gui.UserModifiedFldEventHandler(this.edtBank_UserModifiedFld);
            //
            // lblVertragNr
            //
            this.lblVertragNr.Location = new System.Drawing.Point(15, 125);
            this.lblVertragNr.Name = "lblVertragNr";
            this.lblVertragNr.Size = new System.Drawing.Size(111, 20);
            this.lblVertragNr.TabIndex = 8;
            this.lblVertragNr.Text = "Vertrag Nr";
            this.lblVertragNr.UseCompatibleTextRendering = true;
            //
            // edtName
            //
            this.edtName.DataMember = "Name";
            this.edtName.DataSource = this.qryKbZahlungskonten;
            this.edtName.Location = new System.Drawing.Point(132, 10);
            this.edtName.Name = "edtName";
            this.edtName.Properties.Appearance.BackColor = System.Drawing.Color.AliceBlue;
            this.edtName.Properties.Appearance.BorderColor = System.Drawing.Color.Linen;
            this.edtName.Properties.Appearance.Font = new System.Drawing.Font("Arial", 13F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel);
            this.edtName.Properties.Appearance.Options.UseBackColor = true;
            this.edtName.Properties.Appearance.Options.UseBorderColor = true;
            this.edtName.Properties.Appearance.Options.UseFont = true;
            this.edtName.Properties.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            this.edtName.Size = new System.Drawing.Size(250, 24);
            this.edtName.TabIndex = 1;
            //
            // lblName
            //
            this.lblName.Location = new System.Drawing.Point(15, 16);
            this.lblName.Name = "lblName";
            this.lblName.Size = new System.Drawing.Size(111, 20);
            this.lblName.TabIndex = 0;
            this.lblName.Text = "Name";
            this.lblName.UseCompatibleTextRendering = true;
            //
            // panel2
            //
            this.panel2.Controls.Add(this.gridDTAZugang);
            this.panel2.Dock = System.Windows.Forms.DockStyle.Fill;
            this.panel2.Location = new System.Drawing.Point(0, 0);
            this.panel2.Name = "panel2";
            this.panel2.Size = new System.Drawing.Size(825, 340);
            this.panel2.TabIndex = 1;
            //
            // gridDTAZugang
            //
            this.gridDTAZugang.DataSource = this.qryKbZahlungskonten;
            this.gridDTAZugang.Dock = System.Windows.Forms.DockStyle.Fill;
            //
            //
            //
            this.gridDTAZugang.EmbeddedNavigator.Name = "";
            this.gridDTAZugang.GridStyle = KiSS4.Gui.GridStyleType.ReadOnly;
            this.gridDTAZugang.Location = new System.Drawing.Point(0, 0);
            this.gridDTAZugang.MainView = this.gridViewFields;
            this.gridDTAZugang.Name = "gridDTAZugang";
            this.gridDTAZugang.Size = new System.Drawing.Size(825, 340);
            this.gridDTAZugang.TabIndex = 0;
            this.gridDTAZugang.ViewCollection.AddRange(new DevExpress.XtraGrid.Views.Base.BaseView[] {
            this.gridViewFields});
            //
            // gridViewFields
            //
            this.gridViewFields.Appearance.Empty.BackColor = System.Drawing.Color.FromArgb(((int)(((byte)(247)))), ((int)(((byte)(239)))), ((int)(((byte)(231)))));
            this.gridViewFields.Appearance.Empty.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridViewFields.Appearance.Empty.Options.UseBackColor = true;
            this.gridViewFields.Appearance.Empty.Options.UseFont = true;
            this.gridViewFields.Appearance.EvenRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridViewFields.Appearance.EvenRow.Options.UseFont = true;
            this.gridViewFields.Appearance.FocusedCell.BackColor = System.Drawing.SystemColors.Highlight;
            this.gridViewFields.Appearance.FocusedCell.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridViewFields.Appearance.FocusedCell.ForeColor = System.Drawing.Color.White;
            this.gridViewFields.Appearance.FocusedCell.Options.UseBackColor = true;
            this.gridViewFields.Appearance.FocusedCell.Options.UseFont = true;
            this.gridViewFields.Appearance.FocusedCell.Options.UseForeColor = true;
            this.gridViewFields.Appearance.FocusedRow.BackColor = System.Drawing.SystemColors.Highlight;
            this.gridViewFields.Appearance.FocusedRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridViewFields.Appearance.FocusedRow.ForeColor = System.Drawing.Color.White;
            this.gridViewFields.Appearance.FocusedRow.Options.UseBackColor = true;
            this.gridViewFields.Appearance.FocusedRow.Options.UseFont = true;
            this.gridViewFields.Appearance.FocusedRow.Options.UseForeColor = true;
            this.gridViewFields.Appearance.GroupFooter.BackColor = System.Drawing.Color.PeachPuff;
            this.gridViewFields.Appearance.GroupFooter.BorderColor = System.Drawing.Color.BlanchedAlmond;
            this.gridViewFields.Appearance.GroupFooter.Options.UseBackColor = true;
            this.gridViewFields.Appearance.GroupFooter.Options.UseBorderColor = true;
            this.gridViewFields.Appearance.GroupPanel.BackColor = System.Drawing.Color.PeachPuff;
            this.gridViewFields.Appearance.GroupPanel.Options.UseBackColor = true;
            this.gridViewFields.Appearance.GroupRow.BackColor = System.Drawing.Color.PeachPuff;
            this.gridViewFields.Appearance.GroupRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel, ((byte)(0)));
            this.gridViewFields.Appearance.GroupRow.ForeColor = System.Drawing.SystemColors.WindowText;
            this.gridViewFields.Appearance.GroupRow.Options.UseBackColor = true;
            this.gridViewFields.Appearance.GroupRow.Options.UseFont = true;
            this.gridViewFields.Appearance.GroupRow.Options.UseForeColor = true;
            this.gridViewFields.Appearance.HeaderPanel.BackColor = System.Drawing.Color.Tan;
            this.gridViewFields.Appearance.HeaderPanel.BorderColor = System.Drawing.Color.Tan;
            this.gridViewFields.Appearance.HeaderPanel.Font = new System.Drawing.Font("Arial", 11F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Pixel, ((byte)(0)));
            this.gridViewFields.Appearance.HeaderPanel.Options.UseBackColor = true;
            this.gridViewFields.Appearance.HeaderPanel.Options.UseBorderColor = true;
            this.gridViewFields.Appearance.HeaderPanel.Options.UseFont = true;
            this.gridViewFields.Appearance.HideSelectionRow.BackColor = System.Drawing.Color.PowderBlue;
            this.gridViewFields.Appearance.HideSelectionRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridViewFields.Appearance.HideSelectionRow.ForeColor = System.Drawing.SystemColors.WindowText;
            this.gridViewFields.Appearance.HideSelectionRow.Options.UseBackColor = true;
            this.gridViewFields.Appearance.HideSelectionRow.Options.UseFont = true;
            this.gridViewFields.Appearance.HideSelectionRow.Options.UseForeColor = true;
            this.gridViewFields.Appearance.HorzLine.BackColor = System.Drawing.Color.Silver;
            this.gridViewFields.Appearance.HorzLine.Options.UseBackColor = true;
            this.gridViewFields.Appearance.OddRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridViewFields.Appearance.OddRow.Options.UseFont = true;
            this.gridViewFields.Appearance.Row.BackColor = System.Drawing.Color.BlanchedAlmond;
            this.gridViewFields.Appearance.Row.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridViewFields.Appearance.Row.Options.UseBackColor = true;
            this.gridViewFields.Appearance.Row.Options.UseFont = true;
            this.gridViewFields.Appearance.SelectedRow.Font = new System.Drawing.Font("Arial", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Pixel);
            this.gridViewFields.Appearance.SelectedRow.Options.UseFont = true;
            this.gridViewFields.Appearance.VertLine.BackColor = System.Drawing.Color.Silver;
            this.gridViewFields.Appearance.VertLine.Options.UseBackColor = true;
            this.gridViewFields.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.UltraFlat;
            this.gridViewFields.Columns.AddRange(new DevExpress.XtraGrid.Columns.GridColumn[] {
            this.colKontoNr,
            this.colName,
            this.colVertragNr,
            this.colBank,
            this.colZahlungsformat});
            this.gridViewFields.FocusRectStyle = DevExpress.XtraGrid.Views.Grid.DrawFocusRectStyle.None;
            this.gridViewFields.GridControl = this.gridDTAZugang;
            this.gridViewFields.Name = "gridViewFields";
            this.gridViewFields.OptionsBehavior.Editable = false;
            this.gridViewFields.OptionsCustomization.AllowFilter = false;
            this.gridViewFields.OptionsFilter.UseNewCustomFilterDialog = true;
            this.gridViewFields.OptionsNavigation.AutoFocusNewRow = true;
            this.gridViewFields.OptionsNavigation.UseTabKey = false;
            this.gridViewFields.OptionsView.ColumnAutoWidth = false;
            this.gridViewFields.OptionsView.ShowFilterPanelMode = DevExpress.XtraGrid.Views.Base.ShowFilterPanelMode.Never;
            this.gridViewFields.OptionsView.ShowGroupPanel = false;
            this.gridViewFields.OptionsView.ShowIndicator = false;
            //
            // colKontoNr
            //
            this.colKontoNr.Caption = "Konto Nr";
            this.colKontoNr.FieldName = "KontoNr";
            this.colKontoNr.Name = "colKontoNr";
            this.colKontoNr.Visible = true;
            this.colKontoNr.VisibleIndex = 0;
            this.colKontoNr.Width = 200;
            //
            // colName
            //
            this.colName.Caption = "Name";
            this.colName.FieldName = "Name";
            this.colName.Name = "colName";
            this.colName.Visible = true;
            this.colName.VisibleIndex = 1;
            this.colName.Width = 200;
            //
            // colVertragNr
            //
            this.colVertragNr.Caption = "Vertrag Nr";
            this.colVertragNr.FieldName = "VertragNr";
            this.colVertragNr.Name = "colVertragNr";
            this.colVertragNr.Visible = true;
            this.colVertragNr.VisibleIndex = 3;
            this.colVertragNr.Width = 130;
            //
            // colBank
            //
            this.colBank.Caption = "Finanz Institut";
            this.colBank.FieldName = "FinanzInstitut";
            this.colBank.Name = "colBank";
            this.colBank.Visible = true;
            this.colBank.VisibleIndex = 2;
            this.colBank.Width = 150;
            //
            // colZahlungsformat
            //
            this.colZahlungsformat.Caption = "Zahlungsformat";
            this.colZahlungsformat.FieldName = "KbFinanzInstitutCode";
            this.colZahlungsformat.Name = "colZahlungsformat";
            this.colZahlungsformat.Visible = true;
            this.colZahlungsformat.VisibleIndex = 4;
            this.colZahlungsformat.Width = 115;
            //
            // CtlKbZahlungskonto
            //
            this.ActiveSQLQuery = this.qryKbZahlungskonten;
            this.Controls.Add(this.panel2);
            this.Controls.Add(this.panel1);
            this.Name = "CtlKbZahlungskonto";
            this.Size = new System.Drawing.Size(825, 535);
            this.Load += new System.EventHandler(this.CtlKbZahlungskonto_Load);
            this.panel1.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.edtZahlungsformat.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtZahlungsformat)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.qryKbZahlungskonten)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtVertragNr.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtKontoNr.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtBank.Properties)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.edtName.Properties)).EndInit();
            this.panel2.ResumeLayout(false);
            ((System.ComponentModel.ISupportInitialize)(this.gridDTAZugang)).EndInit();
            ((System.ComponentModel.ISupportInitialize)(this.gridViewFields)).EndInit();
            this.ResumeLayout(false);
        }

        #endregion

        #region Dispose

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                if ((components != null))
                {
                    components.Dispose();
                }
            }
            base.Dispose(disposing);
        }

        #endregion

        #region Private Methods

        private void PrepareEdtZahlungsformat()
        {
            var query = DBUtil.GetLOVQuery("KbFinanzInstitut", false);
            var items = edtZahlungsformat.Properties.Items.Cast<RadioGroupItem>().ToDictionary(rgi => Convert.ToInt32(rgi.Value));
            RadioGroupItem item = null;

            if (!query.IsEmpty)
            {
                do
                {
                    bool isActive = Utils.ConvertToBool(query["IsActive"]);
                    int code = Utils.ConvertToInt(query["Code"]);
                    if (!isActive)
                    {
                        if (items.TryGetValue(code, out item))
                        {
                            edtZahlungsformat.Properties.Items.Remove(item);
                        }
                    }
                }
                while (query.Next());
            }
        }

        private void CtlKbZahlungskonto_Load(object sender, System.EventArgs e)
        {
            qryKbZahlungskonten.Fill();
            colZahlungsformat.ColumnEdit = gridDTAZugang.GetLOVLookUpEdit("KbFinanzInstitut");
        }

        private void edtBank_UserModifiedFld(object sender, KiSS4.Gui.UserModifiedFldEventArgs e)
        {
            DlgAuswahl dlg = new DlgAuswahl();

            if (dlg.SearchBank(edtBank.Text, e.ButtonClicked))
            {
                qryKbZahlungskonten["FinanzInstitut"] = dlg["Name"];
                qryKbZahlungskonten["BaBankID"] = dlg["BaBankID"];
            }

            dlg.Dispose();
        }

        private void edtZahlungsformat_EditValueChanged(object sender, EventArgs e)
        {
            if (_edtZahlungsformat_EditValueChanging)
            {
                return;
            }

            _edtZahlungsformat_EditValueChanging = true;

            try
            {
                var newValue = Utils.ConvertToInt(edtZahlungsformat.EditValue);
                qryKbZahlungskonten["KbFinanzInstitutCode"] = newValue;

                switch (newValue)
                {
                    case (int)Utilities.KbFinanzInstitutCode.Ezag:
                        this.edtBank.EditMode = EditModeType.ReadOnly;

                        //EZAG: Fix Postfinance auswählen, BaBankID leeren
                        qryKbZahlungskonten["BaBankID"] = DBNull.Value;
                        this.edtBank.EditValue = _postfinanceBezeichnung;
                        break;

                    case (int)Utilities.KbFinanzInstitutCode.Dta:
                        this.edtBank.EditMode = EditModeType.Normal;

                        if (edtBank.EditValue == _postfinanceBezeichnung)
                        {
                            //Wechsel -> DTA: sicherstellen, dass nicht Postfinance ausgewählt ist
                            qryKbZahlungskonten["BaBankID"] = DBNull.Value;
                            this.edtBank.EditValue = "";
                        }
                        break;

                    case (int)Utilities.KbFinanzInstitutCode.Iso20022:
                        this.edtBank.EditMode = EditModeType.Normal;

                        if (edtBank.EditValue == _postfinanceBezeichnung)
                        {
                            //Wechsel EZAG -> ISO20022, automatisch Postfinance in BaBankID auswählen
                            qryKbZahlungskonten["BaBankID"] = _postfinanceBaBankID;
                            this.edtBank.EditValue = _postfinanceBezeichnung;
                        }
                        break;
                }
            }
            finally
            {
                _edtZahlungsformat_EditValueChanging = false;
            }
        }

        private void GetPostfinanceData(out int? postfinanceBaBankId, out string postfinanceBezeichnung)
        {
            var qry = DBUtil.OpenSQL(@"SELECT TOP 1 BaBankID, Name
                                       FROM BaBank
                                       WHERE ClearingNr = 9000
                                       ORDER BY GueltigAb DESC");
            if (qry.IsEmpty)
            {
                postfinanceBaBankId = null;
                postfinanceBezeichnung = null;
                return;
            }

            postfinanceBaBankId = Utils.ConvertToInt(qry["BaBankID"]);
            postfinanceBezeichnung = Utils.ConvertToString(qry["Name"]);
        }

        private void qryKbZahlungskonten_AfterInsert(object sender, EventArgs e)
        {
            edtName.Focus();
            qryKbZahlungskonten["KbFinanzInstitutCode"] = (int)Utilities.KbFinanzInstitutCode.Iso20022;
        }

        private void qryKbZahlungskonten_BeforePost(object sender, System.EventArgs e)
        {
            DBUtil.CheckNotNullField(edtBank, lblFinanzInstitut.Text);
        }

        #endregion
    }
}